<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}



</style><title>PSDK_功能说明文档_230524</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='版本发布记录'><span>版本发布记录</span></h1><h2 id='psdk-版本支持信息'><span>PSDK 版本支持信息</span></h2><figure><table><thead><tr><th><span>机型</span></th><th><span>推荐的SDK版本</span></th><th><span>版本维护</span></th><th><span>新功能支持</span></th></tr></thead><tbody><tr><td><span>S400行业系列及后续机型</span></td><td><span>PSDK 3.0</span></td><td><span>√</span></td><td><span>√</span></td></tr></tbody></table></figure><h2 id='payload-sdk-v3016-发布记录'><span>Payload SDK v3.0.16 发布记录</span></h2><h3 id='发布日期'><span>发布日期</span></h3><p><span>2023.05.03</span></p><h3 id='发布功能列表'><span>发布功能列表</span></h3><p><span>-支持拍照录像功能</span>
<span>-支持云台控制</span>
<span>-支持消息订阅</span>
<span>-支持时间同步</span>
<span>-支持精准定位</span>
<span>-支持自定义控件</span>
<span>-支持云台控制</span>
<span>-支持电源管理</span>
<span>-支持飞行控制</span>
<span>-支持PPK功能</span>
<span>-支持航迹规划</span>
<span>-支持本地升级</span>
<span>-支持相机码流获取</span></p><h3 id='支持产品列表与固件版本'><span>支持产品列表与固件版本</span></h3><ul><li><span>S400 行业系列</span></li></ul><figure><table><thead><tr><th style='text-align:center;' ><span>产品</span></th><th style='text-align:center;' ><span>固件版本</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>GDU Flight II App</span></td><td style='text-align:center;' ><span>v1.0.060</span></td></tr><tr><td style='text-align:center;' ><span>S400 飞控</span></td><td style='text-align:center;' ><span>v0.0.39</span></td></tr></tbody></table></figure><h1 id='基本介绍'><span>基本介绍</span></h1><h2 id='什么是psdk'><span>什么是PSDK</span></h2><p><span>为方便您使用PSDK 提供的新功能开发出安全可靠的负载设备，请持续关注GDU PSDK 的版本发布信息，及时使用最新版本的PSDK 开发包开发负载设备。</span></p><blockquote><p><strong><span>本文所指</span></strong></p><ul><li><span>“移动端App” 为使用MSDK 开发的移动端App 或GDU Flight II</span></li><li><span>“负载设备” 为使用PSDK 开发的负载设备。</span></li><li><span>“机载计算机” 为运行了基于PSDK 开发的无人机控制程序的计算设备</span></li></ul></blockquote><h2 id='psdk介绍'><span>PSDK介绍</span></h2><p><span>GDU为了满足不同挂载能快速在GDU无人机上实现适配，开发了第三方通用开发平台payload sdk和airPort</span>
<span>转接环配件，方便开发者接入GDU无人机。开发者根据自身载荷应用场景，使用psdk提供的接口，可快速实现对应的功能</span></p><h2 id='主要优势'><span>主要优势</span></h2><ul><li><strong><span>功能丰富且完善</span></strong>
<span>通过使用PSDK 提供的如信息获取、数据传输和电源管理等基础功能，以及相机、云台、负载协同和精准定位等高级功能，开发者能够根据行业的应用需求，设计出</span><strong><span>功能完善</span></strong><span>的负载设备。并且PSDK 提供了丰富的接口，方便开发者使用第三方应用程序和算法框架，使用图像识别、自主巡航及SLAM 等技术开发出专业的应用软件，此外，还方便开发者接入第三方传感器、相机或检测设备，采集所需的数据信息，满足用户个性化的应用功能和控制需求。</span></li><li><strong><span>拓展应用自定义</span></strong>
<span>开发者除使用GDU Fight II 控制基于PSDK 开发的负载设备和控制无人机和负载设备</span><strong><span>自动执行任务</span></strong><span>的控制程序外，通过使用Mobile SDK 也能开发出控制负载设备执行指定动作的</span><strong><span>移动端App</span></strong></li><li><strong><span>兼容广泛的软硬件平台</span></strong>
<span>使用PSDK 开发的应用程序能够运行在主流的嵌入式硬件平台上，如STM32等，也可运行在主流的嵌入式操作系统和软件架构中，如Linux、ROS及RTOS，开发者按照跨平台移植中的步骤执行所需的工作后，即可在不同版本的软硬件平台上运行基于PSDK 开发的应用程序。</span></li><li><strong><span>支持服务有保障</span></strong>
<span>PSDK 不仅提供了用于开发GDU 无人机负载设备的API 接口和硬件平台，还提供了开发负载设备的</span><strong><span>设计标准</span></strong><span>，此外，还提供了包括但</span><strong><span>不限于</span></strong><span>技术支持、负载检测及市场推广等服务，服务开发者使用PSDK 开发出功能完善的无人机负载设备，探索行业应用的无限潜能。</span></li></ul><h2 id='负载应用'><span>负载应用</span></h2><p><span>使用PSDK 开发可挂载在GDU 无人机上的负载设备，能够满足不同行业多样化的应用需求：</span></p><figure><table><thead><tr><th><span>负载设备</span></th><th><span>安防</span></th><th><span>巡检</span></th><th><span>勘测</span></th><th><span>环保</span></th><th><span>更多行业</span></th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th></tr></thead><tbody><tr><td><span>治安管理</span></td><td><span>消防</span></td><td><span>应急救援</span></td><td><span>管网巡检</span></td><td><span>厂区巡检</span></td><td><span>地质测绘</span></td><td><span>空间规划</span></td><td><span>资源勘探</span></td><td><span>生态监测</span></td><td><span>生物保护</span></td><td><span>...</span></td><td>&nbsp;</td></tr><tr><td><span>可变焦相机</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>...</span></td></tr><tr><td><span>热成像相机</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>...</span></td></tr><tr><td><span>红外相机</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>...</span></td></tr><tr><td><span>多目相机</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>激光雷达</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>气体检测仪</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>...</span></td></tr><tr><td><span>辐射检测仪</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>水质检测仪</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>喊话器</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>探照灯</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>自动巡检系统</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>✓</span></td><td><span>✓</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>-</span></td><td><span>...</span></td></tr><tr><td><span>更多负载</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td><td><span>...</span></td></tr></tbody></table></figure><h2 id='使用msdk'><span>使用MSDK</span></h2><p><span>MSDK：使用MSDK 开发的移动端App 能够控制负载设备执行指定的动作和任务</span></p><h2 id='免责声明-1'><span>免责声明</span></h2><p><span>在使用PSDK 开发的应用程序前，请先查阅飞行地所在区域的法律和规定，</span><strong><span>因使用PSDK 而引发的安全问题或法律纠纷均与GDU 无关，GDU 不承担一切因使用PSDK 而导致的任何法律风险和责任</span></strong><span>。</span></p><p>&nbsp;</p><h2 id='psdk-功能概览'><span>PSDK 功能概览</span></h2><h3 id='日志管理-1'><span>日志管理 </span></h3><p><span>拥有日志管理功能的负载设备支持用户通过串口、终端等方法输出不同模块的日志信息，使用具有日志颜色显示功能的工具能够以不同的颜色显示不同类型的日志。</span></p><h3 id='信息管理-1'><span>信息管理</span></h3><ul><li><span>无人机系统信息获取：负载设备通过该功能可主动获取GDU移动端App 使用的语言等信息。</span></li><li><span>消息订阅：负载设备能够订阅无人机上各个部件实时产生的传感器数据以及无人机系统状态信息，如飞机速度、融合海拔高度及RTK 位置等。</span></li></ul><h3 id='相机功能'><span>相机功能</span></h3><ul><li><span>基础功能：设置相机模式、拍照、录像、获取相机状态</span></li><li><span>进阶功能：指点变焦、测光、对焦</span></li><li><span>高级功能：视频流传输、媒体文件回放与下载</span></li></ul><h3 id='云台功能-1'><span>云台功能</span></h3><ul><li><span>控制云台转动速度和转动方式</span></li><li><span>设置平滑系数和最大速度系数</span></li><li><span>云台校准、复位及角度微调</span></li></ul><h3 id='电源管理-1'><span>电源管理</span></h3><p><span>具有电源管理功能的负载设备，不仅能够向无人机申请较高的功率，还能接收无人机发送的关机通知正常关机，防止负载设备意外丢失数据信息。</span></p><h3 id='飞行控制-1'><span>飞行控制</span></h3><ul><li><span>设置或获取无人机飞行控制器的参数，如返航高度，避障状态等</span></li><li><span>执行基本的飞行任务，如起飞、降落及返航等</span></li><li><span>无人机基础控制功能，如速度控制、姿态控制和位置控制</span></li></ul><h3 id='自定义控件-1'><span>自定义控件</span></h3><ul><li><span>负载控制：GDU Flight 能够根据控件配置文件中的配置项，显示开发者为负载设备设计的控件，用户通过该控件能够控制使用PSDK 开发的负载设备。</span></li><li><span>浮窗信息显示：GDU Flight 能够显示基于PSDK 开发的负载设备推送的信息。</span></li></ul><h3 id='hms功能'><span>HMS功能</span></h3><p><span>获取HMS信息：获取无人机的健康管理信息，有效监控无人机当前状态</span></p><h3 id='时间同步-1'><span>时间同步</span></h3><ul><li><span>获取PPS数据：获取无人机的硬件触发脉冲信号</span></li><li><span>获取UTC时间：获取统一的UTC时间</span></li></ul><h3 id='数据传输-1'><span>数据传输</span></h3><ul><li><span>数据传输：用户能够在负载设备和移动端App间传输控制命令和数据信息。</span></li><li><span>状态获取：用户能够获取不同类型的数据传输通道当前的状态。</span></li><li><span>带宽控制：用户能够设置不同类型的数据占用数据传输通道带宽的比例。</span></li></ul><h3 id='高级视觉'><span>高级视觉</span></h3><p><span>获取相机码流：获取相机的H.264 码流，用户可对视频流解码进行实时处理。</span></p><h3 id='本地升级-1'><span>本地升级</span></h3><p><span>本地升级是一个用于升级负载设备固件的功能，开发者使用本地升级功能，能够方便用户通过GDU 上位机 选择本地固件文件更新负载设备的固件。</span></p><h3 id='运动规划-1'><span>运动规划</span></h3><p><span>航点任务：控制GDU 的无人机按照预设的多个航点实现自主飞行</span></p><h2 id='如何使用psdk'><span>如何使用PSDK</span></h2><h2 id='2-选用开发工具'><span>2. 选用开发工具</span></h2><p><span>选购开发负载设备时所需使用的无人机、开发平台和硬件平台：</span></p><ul><li><span>选购无人机</span></li><li><span>选购开发负载设备的转接环</span></li><li><span>选择开发平台</span></li></ul><h2 id='3-开发负载设备'><span>3. 开发负载设备</span></h2><h4 id='开发前准备'><span>开发前准备</span></h4><p><span>使用PSDK 开发负载设备前，建议先学习开发负载设备所需的基础知识、了解PSDK 的功能以及负载设备所需满足的标准，根据实际的开发需求选购合适的硬件平台，选择可靠的开发平台。</span></p><ul><li><span>学习无人机基础知识和控制原理：如俯仰、偏航、滚转和升降等基础知识</span></li><li><span>了解PSDK 支持的功能</span></li><li><span>选购硬件平台</span></li></ul><h4 id='开始开发负载设备'><span>开始开发负载设备</span></h4><p><span>使用PSDK 开发负载设备时，</span><strong><span>请正确地连接</span></strong><span>所选购的硬件平台、第三方开发板和GDU 的无人机，</span><strong><span>正确地配置</span></strong><span>负载设备开发环境，通过运行示例代码编译后的程序，了解使用PSDK 开发负载设备的方法。</span></p><h2 id='4-成为gdu-的合作伙伴'><span>4. 成为GDU 的合作伙伴</span></h2><p><span>GDU 秉承</span><strong><span>开放共赢</span></strong><span>的合作理念，为开发者提供技术支持、负载检测、渠道推荐以及GDU 生态推广等服务，诚挚携手广大开发者以及合作伙伴共建可持续发展的应用生态。</span></p><ul><li><span>若合作伙伴开发的负载设备能通过GDU 的负载检测，该负载设备将被GDU 推荐给第三方合作伙伴。</span></li><li><span>若合作伙伴的负载设备能够通过第三方专业机构的检测，在与GDU 签署合作协议后，GDU 将与合作伙伴开展更为深入的合作，如将合作伙伴的负载设备推荐给[全球用户]等，更多合作事宜请[ 联系我们]</span></li></ul><h2 id='获取技术支持服务'><span>获取技术支持服务</span></h2><ul><li><p><span>在</span><a href='https://gdusdksupport.zendesk.com/hc/zh-cn'><span>GDU 技术支持社区</span></a><span>中寻求帮助</span></p></li><li><p><span>获取技术支持服务</span></p><ul><li><p><span>使用</span><a href='https://gdusdksupport.zendesk.com/hc/zh-cn/requests/new'><span>问题反馈</span></a><span>表单</span></p></li><li><p><span>向GDU SDK 团队发送</span><a href='mailto:dev@gdu.com'><span>邮件</span></a></p><p>&nbsp;</p></li></ul></li></ul><h1 id='选型指南'><span>选型指南 </span></h1><h2 id='负载开发标准'><span>负载开发标准</span></h2><p><span>为确保无人机在搭载负载设备执行飞行任务时的安全，请在使用PSDK 开发负载设备时，遵循GDU 的负载设备开发标准。</span></p><h2 id='硬件接口标准'><span>硬件接口标准</span></h2><h2 id='干扰兼容性要求'><span>干扰兼容性要求</span></h2><h2 id='结构设计标准'><span>结构设计标准</span></h2><h2 id='自定义数据传输标准'><span>自定义数据传输标准</span></h2><h5 id='使用s400系列'><span>使用S400系列</span></h5><figure><table><thead><tr><th><span>通道类型</span></th><th><span>传输方向</span></th><th><span>速率限制</span></th></tr></thead><tbody><tr><td><span>命令通道</span></td><td><span>移动端App ➟ 负载设备</span></td><td><span>≤4096B/s</span></td></tr><tr><td><span>负载设备 ➟ 移动端App</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>用户负载设备 ➟ 负载设备</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>负载设备 ➟ 用户负载设备</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>高速数据传输通道</span></td><td><span>负载设备 ➟ 移动端App</span></td><td><span>单云台：≤ 8192Kbps 多云台：每个云台的传输速率≤ 4096Kbps</span></td></tr></tbody></table></figure><h2 id='视频流传输标准'><span>视频流传输标准</span></h2><p><span>使用PSDK 开发的</span><strong><span>相机类</span></strong><span>负载设备，</span><strong><span>必须</span></strong><span>选用如下的两种</span><strong><span>H.264 编码标准</span></strong><span>。</span></p><p><strong><span>Custom-H264</span></strong><span> 标准</span></p><h4 id='特性-1'><span>特性</span></h4><ol start='' ><li><span>较为通用且更易获取的标准H264格式码流。</span></li><li><span>使用该视频流格式发送码流时，会通过飞机透传到App端解码，且实时码率不得超过反馈值。</span></li><li><span>使用该格式传输视频流，SEI的内容可传输到App端。</span></li></ol><h4 id='要求-1'><span>要求</span></h4><p><span>基于PSDK 开发的</span><strong><span>相机类</span></strong><span>负载设备，在使用</span><strong><span>Custom-H264 标准</span></strong><span>时，需注意如下关键配置信息：</span></p><figure><table><thead><tr><th><span>关键项</span></th><th><span>H.264 标准项</span></th><th><span>取值</span></th></tr></thead><tbody><tr><td><span>视频分辨率</span></td><td><span>-</span></td><td><span>最大不超过 1920 × 1080</span></td></tr><tr><td><span>帧率</span></td><td><span>-</span></td><td><span>最大不超过 30 fps</span></td></tr><tr><td><span>码率</span></td><td><span>-</span></td><td><span>最大不超过 8 Mbps</span></td></tr><tr><td><span>推荐视频长宽比</span></td><td><span>-</span></td><td><span>4: 3</span></td></tr><tr><td><span>GOP 编码结构必须选用Period I</span></td><td><span>-</span></td><td><span>-</span></td></tr><tr><td><span>档次</span></td><td><span>Level Number</span></td><td><span>＜5.1</span></td></tr><tr><td><span>profile_idc</span></td><td><span>7.3.2.1.1</span></td><td><span>Baseline=66，Main=77，High=100</span></td></tr><tr><td><span>YUV420 格式</span></td><td><span>7.3.2.1.1</span></td><td><span>chroma_format_idc=1</span></td></tr><tr><td><span>8Bit 视频</span></td><td><span>7.3.2.1.1</span></td><td><span>bit_depth_luma_minus8=0 bit_depth_chroma_minus8=0</span></td></tr><tr><td><span>不允许编码器自定义 Scaling Matrix</span></td><td><span>7.3.2.1.1 7.3.2.2</span></td><td><span>seq_scaling_matrix_present_flag=0 pic_scaling_matrix_present_flag=0</span></td></tr><tr><td><span>仅支持帧格式编码，不支持场编码</span></td><td><span>7.3.2.1.1</span></td><td><span>frames_mbs_only_flag=1</span></td></tr><tr><td><span>仅允许 P 帧和 I 帧，且P 帧有单个参考帧</span></td><td><span>7.3.3 7.3.2.2 7.3.3</span></td><td><span>slice_type = 0 或 2 num_ref_idx_l0_default_active_minus1=0 num_ref_idx_active_override_flag=0</span></td></tr><tr><td><span>不支持多Slice Group</span></td><td><span>7.3.2.2</span></td><td><span>num_slice_groups_minus1=0</span></td></tr></tbody></table></figure><blockquote><p><strong><span>注意：</span></strong><span> 使用H.264 编码标准时，GOP 编码结构必须选用Period I（帧内编码帧，每隔1 秒将插入1 个IDR 帧，确保图像数据丢失时可被恢复）。</span></p></blockquote><p><strong><span>GDU-H264</span></strong><span> 标准</span></p><h4 id='特性-2'><span>特性</span></h4><ol start='' ><li><span>较为严苛的GDU H264格式码流标准。</span></li><li><span>使用该视频流格式发送码流时，会通过飞机转码，在最大码率限制内，能够根据实时图传链路的情况，动态调节码率，达到最优的图传显示效果。</span></li><li><span>使用该格式传输视频流，SEI的内容会被飞机丢弃，无法传输到App端。</span></li></ol><h4 id='要求-2'><span>要求</span></h4><p><span>基于PSDK 开发的</span><strong><span>相机类</span></strong><span>负载设备，在使用</span><strong><span>GDU-H264 标准</span></strong><span>时，需注意如下关键配置信息：</span></p><figure><table><thead><tr><th><span>关键项</span></th><th><span>H.264 标准项</span></th><th><span>取值</span></th></tr></thead><tbody><tr><td><span>视频分辨率</span></td><td><span>-</span></td><td><span>最大不超过 1920 × 1080</span></td></tr><tr><td><span>帧率</span></td><td><span>-</span></td><td><span>最大不超过 30fps</span></td></tr><tr><td><span>码率</span></td><td><span>-</span></td><td><span>最大不超过 8 Mbps</span></td></tr><tr><td><span>每一帧结尾必须加上AUD信息</span></td><td><span>-</span></td><td><span>固定6字节：0x00 0x00 0x00 0x01 0x09 0x10</span></td></tr><tr><td><span>推荐视频长宽比</span></td><td><span>-</span></td><td><span>4:3或16: 9</span></td></tr><tr><td><span>一帧数据字节数</span></td><td><span>-</span></td><td><span>最大不超过 256KBytes</span></td></tr><tr><td><span>档次</span></td><td><span>Level Number</span></td><td><span>＜5.1</span></td></tr><tr><td><span>profile_idc</span></td><td><span>7.3.2.1.1</span></td><td><span>Baseline=66，Main=77，High=100</span></td></tr><tr><td><span>YUV420 格式</span></td><td><span>7.3.2.1.1</span></td><td><span>chroma_format_idc=1</span></td></tr><tr><td><span>8Bit 视频</span></td><td><span>7.3.2.1.1</span></td><td><span>bit_depth_luma_minus8=0 bit_depth_chroma_minus8=0</span></td></tr><tr><td><span>不允许编码器自定义 Scaling Matrix</span></td><td><span>7.3.2.1.1 7.3.2.2</span></td><td><span>seq_scaling_matrix_present_flag=0 pic_scaling_matrix_present_flag=0</span></td></tr><tr><td><span>仅支持帧格式编码，不支持场编码</span></td><td><span>7.3.2.1.1</span></td><td><span>frames_mbs_only_flag=1</span></td></tr><tr><td><span>仅允许 P 帧和 I 帧，且P 帧有单个参考帧</span></td><td><span>7.3.3 7.3.2.2 7.3.3</span></td><td><span>slice_type = 0 或 2 num_ref_idx_l0_default_active_minus1=0 num_ref_idx_active_override_flag=0</span></td></tr><tr><td><span>不支持多Slice Group</span></td><td><span>7.3.2.2</span></td><td><span>num_slice_groups_minus1=0</span></td></tr><tr><td><span>不支持长期参考帧</span></td><td><span>7.3.3.3</span></td><td><span>long_term_reference_flag=0</span></td></tr><tr><td><span>要求解码顺序和播放顺序一致</span></td><td><span>E.1.1</span></td><td><span>max_num_reorder_frames=0</span></td></tr><tr><td><span>限制解码的参考帧数量为5</span></td><td><span>E.1.1</span></td><td><span>max_dec_frame_buffering=5</span></td></tr><tr><td><span>支持最大的参考帧个数为1帧，支持最大的参考间隔为1</span></td><td><span>7.3.2.1.1</span></td><td><span>max_num_ref_frames=1</span></td></tr></tbody></table></figure><blockquote><p><strong><span>注意：</span></strong></p><ul><li><span>使用H.264 编码标准时，Gop structure 可选，为Period I或者GDR。</span></li><li><span>如果是Period Ⅰ，要求每个I帧为IDR帧，若不符合要求，则不保证图传能够从丢包错误中正确恢复；在发送完SPS/PPS之后，需要立马传输Ⅰ帧的流，然后再传输AUD，在SPS/PPS和slice之间无AUD信息。Period Ⅰ结构中，建议一秒一个IDR。</span></li><li><span>如果为GDR，在每个GDR刷新帧需要传输sps/pps。</span></li></ul></blockquote><blockquote><p><strong><span>兼容性说明：</span></strong><span> 若视频流格式设置为</span><strong><span>GDU H264</span></strong><span> 格式，</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/function-set/basic-function/data-transmission.html'><span>数据流传输功能open in new window</span></a><span>将无法使用，建议切换到</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/function-set/advanced-function/sdk-interconnection.html'><span>SDK 互联互通功能open in new window</span></a><span>使用。</span></p></blockquote><blockquote><p><strong><span>相关参考：</span></strong><span> </span><a href='https://www.itu.int/rec/T-REC-H.264-201906-S/en'><span>H.264 协议标准</span></a></p></blockquote><blockquote><p><strong><span>视频流检测工具：</span></strong><span> </span><a href='https://github.com/gdu-sdk/GDUPSDKVideoStreamCheckTool'><span>码流检测工具</span></a></p></blockquote><h2 id='选择开发平台-1'><span>选择开发平台</span></h2><p><span>请根据操作系统和开发平台对PSDK 功能的支持差异、负载设备程序的资源占用情况以及PSDK 支持的工具链，选择开发负载设备的操作系统和开发平台。</span></p><h2 id='选择飞行平台'><span>选择飞行平台</span></h2><h2 id='选择操作系统'><span>选择操作系统</span></h2><h4 id='平台功能差异'><span>平台功能差异</span></h4><figure><table><thead><tr><th><span>功能名称</span></th><th><span>平台支持-Linux</span></th><th><span>平台支持-RTOS</span></th></tr></thead><tbody><tr><td><span>日志管理</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>信息管理</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>基础相机功能</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>云台功能</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>电源管理</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>飞行控制</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>自定义控件</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>HMS 功能</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>时间同步</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>低速数据传输</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>视频流传输</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>回放下载</span></td><td><span>✓</span></td><td><span>-</span></td></tr><tr><td><span>获取相机码流</span></td><td><span>✓</span></td><td><span>-</span></td></tr><tr><td><span>本地升级</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>精准定位</span></td><td><span>✓</span></td><td><span>✓</span></td></tr><tr><td><span>运动规划</span></td><td><span>✓</span></td><td><span>✓</span></td></tr></tbody></table></figure><h4 id='资源占用'><span>资源占用</span></h4><h5 id='linux'><span>Linux</span></h5><p><span>使用Manifold 2-C 运行Linux 平台PSDK 示例程序，程序运行时的资源占用情况如下所示：</span></p><ul><li><span>栈：约 12288 字节</span></li><li><span>堆：约 40960 字节</span></li><li><span>Text 段：755359 字节</span></li><li><span>Data 段：3872 字节</span></li><li><span>Bss 段：23848 字节</span></li><li><span>CPU 占用：7.2 %</span></li></ul><h5 id='rtos'><span>RTOS</span></h5><p><span>使用STM32F407IGH6-EVAL 运行RTOS 平台PSDK 示例程序，程序运行时的资源占用情况如下所示：</span></p><ul><li><span>Text 段：167140 字节</span></li><li><span>Data 段：1740 字节</span></li><li><span>Bss 段：117852 字节</span></li><li><span>CPU 占用：30 %</span></li></ul><h2 id='选择开发平台-2'><span>选择开发平台</span></h2><p><span>PSDK 支持使用如下工具编译基于PSDK 开发的负载设备，请根据选用的</span><strong><span>开发平台</span></strong><span>正确地选择工具链。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 有关跨平台移植的详细说明请参见</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/quick-start/porting.html'><span>跨平台移植open in new window</span></a><span>。</span></p></blockquote><figure><table><thead><tr><th><span>工具链名称</span></th><th><span>目标平台</span></th><th><span>典型芯片型号</span></th><th><span>推荐开发平台</span></th></tr></thead><tbody><tr><td><span>aarch64-linux-gnu-gcc</span></td><td><span>aarch64-linux-gnu</span></td><td><span>NVIDIA Jetson TX2、Rockchip RK3399 pro</span></td><td><span>Manifold2-G、瑞芯微Toybrick开发板</span></td></tr><tr><td><span>x86_64-linux-gnu-gcc</span></td><td><span>x86_64-linux-gnu</span></td><td><span>64位intel处理器，如 Intel Core i7-8550U</span></td><td><span>Maniflod2-C</span></td></tr><tr><td><span>arm-linux-gnueabi-gcc</span></td><td><span>arm-linux-gnueabi</span></td><td><span>ZYNQ、I.MX6Q</span></td><td><span>-</span></td></tr><tr><td><span>arm-linux-gnueabihf-gcc</span></td><td><span>arm-linux-gnueabihf</span></td><td><span>支持硬件浮点运算的处理器，如OK5718-C等</span></td><td><span>-</span></td></tr><tr><td><span>armcc-cortex-m4</span></td><td><span>Cortex M4/M4F系列MCU</span></td><td><span>STM32F407IGT6、STM32F405RGT6</span></td><td><span>STM32F407-Eval、STM32F407探索者开发板等</span></td></tr><tr><td><span>arm-none-eabi-gcc</span></td><td><span>Cortex M4/M4F系列MCU</span></td><td><span>STM32F407IGT6、STM32F405RGT6</span></td><td><span>STM32F407-Eval、STM32F407探索者开发板等</span></td></tr><tr><td><span>arm-linux-androideabi-gcc</span></td><td><span>arm-linux-androideabi</span></td><td><span>高通骁龙系列芯片</span></td><td><span>安卓平台</span></td></tr><tr><td><span>aarch64-linux-android-gcc</span></td><td><span>aarch64-linux-android</span></td><td><span>高通骁龙系列芯片</span></td><td><span>安卓平台</span></td></tr><tr><td><span>arm-himix100-linux-gcc</span></td><td><span>arm-himix100-linux</span></td><td><span>hi3516EV系列芯片</span></td><td><span>-</span></td></tr><tr><td><span>arm-himix200-linux-gcc</span></td><td><span>arm-himix200-linux</span></td><td><span>hi3516C系列芯片</span></td><td><span>-</span></td></tr><tr><td><span>aarch64-himix100-linux-gcc</span></td><td><span>aarch64-himix100-linux</span></td><td><span>hi3559C</span></td><td><span>-</span></td></tr><tr><td><span>arm-hisiv300-linux-uclibcgnueabi-gcc</span></td><td><span>arm-hisiv300-linux-uclibcgnueabi</span></td><td><span>hi3516A系列芯片</span></td><td><span>-</span></td></tr><tr><td><span>arm-hisiv400-linux-gnueabi-gcc</span></td><td><span>arm-hisiv400-linux-gnueabi</span></td><td><span>hi3516A系列芯片</span></td><td><span>-</span></td></tr><tr><td><span>arm-hisiv500-linux-uclibcgnueabi-gcc</span></td><td><span>arm-hisiv500-linux-uclibcgnueabi</span></td><td><span>hi3519系列芯片</span></td><td><span>-</span></td></tr><tr><td><span>arm-hisiv600-linux-gnueabi-gcc</span></td><td><span>arm-hisiv600-linux-gnueabi</span></td><td><span>hi3519系列芯片</span></td><td><span>-</span></td></tr><tr><td><span>xtensa-esp32-elf-gcc</span></td><td><span>xtensa-esp32-elf</span></td><td><span>ESP32系列芯片</span></td><td><span>ESP32-DevkitC</span></td></tr></tbody></table></figure><blockquote><p><strong><span>说明：</span></strong><span> 开发者需根据所使用的开发平台，选择指定编译链的静态库。若开发包中没有所需编译链的静态库，请提供开发负载设备时使用的</span><strong><span>开发平台的型号</span></strong><span>、</span><strong><span>编译链的型号</span></strong><span>和</span><strong><span>编译链的安装包</span></strong><span>发送给</span><a href='mailto:dev@gdu.com'><span>SDK 技术支持团队</span></a><span>，我们将为您准备相应的工具链。</span></p></blockquote><h2 id='选购硬件平台'><span>选购硬件平台</span></h2><blockquote><p><strong><span>注意</span></strong></p><ul><li><span>SDK同轴线仅支持使用</span><strong><span>PSDK V3.x.x</span></strong><span>。</span></li><li><span>GDU 已于 </span><strong><span>2021年 10月 21日</span></strong><span>停止对</span><strong><span>PSDK V2.x.x</span></strong><span> 和FlyPort 的开发，建议使用</span><strong><span>SDK同轴线</span></strong><span>、</span><strong><span>X-Port</span></strong><span> 或</span><strong><span>FlyPort V2</span></strong><span> 在</span><strong><span>PSDK V3.x.x</span></strong><span> 的基础上开发负载设备。PSDK V2.x.x的内容请参考</span><a href='https://developer.gdu.com/cn/document/26cd55ae-ef09-4463-b941-d6bb2bb98461'><span>历史文档open in new window</span></a><span>。</span></li><li><span>FlyPort 仅支持使用</span><strong><span>PSDK V1.x.x</span></strong><span> 。若您仍使用</span><strong><span>PSDK V1.x.x</span></strong><span> 和</span><strong><span>FlyPort</span></strong><span> 开发负载设备，请使用</span><a href='https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/payload-sdk-doc-1.0.zip'><span>PSDK V1.x.xopen in new window</span></a><span> 的文档。</span></li></ul></blockquote><h2 id='选购无人机'><span>选购无人机</span></h2><blockquote><p><strong><span>说明：</span></strong></p><ul><li><span>有关无人机参数和使用无人机的详细说明，请参见</span><a href='https://enterprise.gdu.com/'><span>官网open in new window</span></a><span>所选购机型的快速入门指南。</span></li><li><span>S400行业系列机型，下表中列举的图片为 S400，机型具体规格参数请在</span><a href='https://dl.gducdn.com/downloads/GDU_Mavic_3_Enterprise/GDU_Mavic_3E_3T_Quick_Start_Guide.pdf'><span>GDU S400行业系列 - 快速入门指南open in new window</span></a><span>中搜索“规格参数”查看。</span></li><li><span>S400 系列机型，下表中列举的图片为S400，机型具体规格参数请在</span><a href='https://dl.gducdn.com/downloads/matrice-30-series/20220426/Matrice30_Series_Quick_Start_Guide_0426.pdf'><span>快速入门指南open in new window</span></a><span>中搜索“技术规格”查看。</span></li></ul></blockquote><p><span>      </span></p><figure><table><thead><tr><th><span>参数</span></th><th style='text-align:center;' ><span>S400</span></th><th style='text-align:center;' >&nbsp;</th><th style='text-align:center;' >&nbsp;</th></tr></thead><tbody><tr><td><strong><span>飞行器图片</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>重量（含电池）</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>最大载重</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>最大飞行时间</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>最多负载数量</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>视觉感知</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>防护等级</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr><tr><td><strong><span>SDK 支持（最低版本）</span></strong></td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td><td style='text-align:center;' >&nbsp;</td></tr></tbody></table></figure><h2 id='购买开发套件'><span>购买开发套件</span></h2><h4 id='flyport-v2'><span>FlyPort V2</span></h4><p><span>借助</span><a href='https://store.gdu.com/cn/product/psdk-development-kit-v2'><span>FlyPort V2</span></a><span> 开发套件中的接口拓展板，开发者能够使用第三方开发板开发负载设备。</span>
<span>FlyPort V2 包含如下配件：</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/5815b0ac-0184-45f9-996d-b99c982b8e08.png" referrerpolicy="no-referrer" alt="img"></p><blockquote><p><strong><span>说明：</span></strong><span> 当负载设备进入量产阶段后，请购买 </span><a href='https://store.gdu.com/cn/product/gdu-FlyPort-adapter-set-v2'><span>FlyPort V2 转接环套装</span></a><span>。jjj</span></p></blockquote><h4 id='其他sdk配件'><span>其他SDK配件</span></h4><ul><li><span>OSDK拓展组件</span><a href='https://store.gdu.com/cn/product/matrice-300-rtk-osdk-expansion-module'><span>（点击购买）open in new window</span></a><span>：仅支持S400 RTK，可连接 S400 RTK，并提供若干机载计算平台转接接口。</span></li><li><span>SDK 同轴线</span><a href='https://store.gdu.com/cn/product/osdk-round-ribbon-cable-set'><span>（点击购买）open in new window</span></a><span>：开发者根据同轴线的引脚定义，将其集成至定制机载计算机中，并通过该线材将定制机载计算机与飞行平台进行连接。</span></li><li><span>PSDK 快拆支架</span><a href='https://store.gdu.com/cn/product/psdk-mounting-bracket?from=search-result-v2&amp;position=0'><span>（点击购买）open in new window</span></a><span>：可将PSDK负载固定至S400系列飞行平台上，并且可快速取出以及更换不同类型的PSDK负载。</span></li></ul><h2 id='开发套件对比'><span>开发套件对比</span></h2><figure><table><thead><tr><th style='text-align:center;' ><span>参数</span></th><th><span>FlyPort V2</span></th><th><span>SDK 同轴线</span></th><th><span>OSDK 拓展组件（仅支持S400 RTK）</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><strong><span>开发套件图片</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>硬件尺寸</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>重量</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>负载重量</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>适配PSDK 版本</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>电压输出 （最大功率）</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>UART 信号传输</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>MDI 数据传输</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>High Power Apply</span></strong></td><td><span>-</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>PPS 信号传输</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td style='text-align:center;' ><strong><span>适配机型</span></strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>受实际工作环境的影响，X-Port 实际的工作电流可能会和额定电流有一定的差异。</span></li><li><span>GDU S400 行业系列仅提供一个PSDK Type-C端口用于拓展开发与连接PSDK 负载，暂无开发配件支持，请用户查阅</span><a href='https://github.com/gdu-sdk/Payload-SDK/blob/master/doc/reference_designs/Type-C Schematic Reference.pdf'><span>硬件参考设计open in new window</span></a><span>自行开发。</span></li></ul></blockquote><h2 id='选购第三方开发平台'><span>选购第三方开发平台</span></h2><p><span>GDU PSDK 使用STM3240G-EVAL(STM32F407IG) 开发板开发并调试示例程序，建议开发者参考</span><a href='https://www.st.com/en/evaluation-tools/stm3240g-eval.html'><span>STM3240G-EVAL(STM32F407IG)open in new window</span></a><span> 的参数信息选购所需使用的开发平台。</span></p><p>&nbsp;</p><h1 id='快速入门'><span>快速入门</span></h1><h2 id='开发须知'><span>开发须知</span></h2><p><span>使用PSDK 开发负载设备前，请认真阅读本文档中的内容，避免操作不当意外损毁无人机、硬件平台或负载设备。</span></p><h2 id='固件升级'><span>固件升级</span></h2><p><span>在开发负载设备前，需先使用</span><strong><span>GDU Assistant2</span></strong><span> 升级无人机和硬件平台的固件，有关固件版本的详细说明，请参见</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/whats-new/version-announcement.html'><span>固件版本open in new window</span></a><span>。</span></p><blockquote><p><strong><span>注意</span></strong></p><ul><li><span>SDK同轴线仅支持使用</span><strong><span>PSDK V3.x.x</span></strong><span>。</span></li><li><span>FlyPort 仅支持使用</span><strong><span>PSDK V1.x.x</span></strong><span>。</span></li><li><span>GDU 已于 </span><strong><span>2021年 10月 21日</span></strong><span>停止对</span><strong><span>PSDK V2.x.x</span></strong><span> 和FlyPort 的开发，建议使用</span><strong><span>SDK同轴线</span></strong><span>、</span><strong><span>FlyPort V2</span></strong><span> 在</span><strong><span>PSDK V3.x.x</span></strong><span> 的基础上开发负载设备。PSDK V2.x.x的内容请参考</span><a href='https://developer.gdu.com/cn/document/26cd55ae-ef09-4463-b941-d6bb2bb98461'><span>历史文档open in new window</span></a><span>。</span></li><li><span>若您仍使用</span><strong><span>PSDK V1.x.x</span></strong><span> 和</span><strong><span>FlyPort</span></strong><span> 开发负载设备，请使用</span><a href='https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/payload-sdk-doc-1.0.zip'><span>PSDK V1.x.xopen in new window</span></a><span> 的文档。</span></li></ul></blockquote><h2 id='开发与测试'><span>开发与测试</span></h2><p><span>使用PSDK 开发负载设备时，为保护开发者免受意外，请注意如下事项：</span></p><ul><li><span>在使用PSDK 开发负载设备或测试基于PSDK 开发的负载设备时，请取下无人机上的桨叶。</span></li><li><span>无人机电机在转动时，请勿靠近。</span></li><li><span>请勿向无人机电源输出接口输入大功率电流。</span></li></ul><h2 id='免责声明-2'><span>免责声明</span></h2><ul><li><span>在使用基于PSDK 开发的负载设备前，请检查使用负载设备所在地区的法律法规。</span><strong><span>因使用PSDK 引发的安全问题或法律纠纷与GDU 无关，GDU不承担任何连带责任</span></strong><span>。</span></li><li><span>使用基于PSDK 开发的负载设备执行飞行任务时，请按照用户手册中的说明操作无人机，确保飞机在执行任务时处于良好的飞行状态，降低无人机潜在的安全隐患和出现安全事故的可能性。</span></li><li><strong><span>GDU不会以任何方式和任何理由获取第三方用户的私人数据。</span></strong><span> 开发者应开发出</span><strong><span>保护用户隐私数据的功能，例如数据加密和混淆等</span></strong><span>。因使用GDU PSDK 造成用户隐私数据泄露的事件，GDU 将不负任何法律责任。</span></li></ul><h2 id='设备连接'><span>设备连接</span></h2><p><span>使用FlyPort V2或者SDK 同轴线开发负载设备时，请按本文引导连接硬件平台、负载设备开发板、接口拓展板和GDU 的无人机。</span></p><blockquote><p><strong><span>提示：</span></strong></p><ul><li><span>本文档</span><strong><span>未描述的硬件接口</span></strong><span>将逐步开放，敬请关注。</span></li><li><span>请根据所购机型</span><a href='https://www.gdu.com/cn/downloads'><span>说明书open in new window</span></a><span>中的指导连接无人机和遥控器。</span></li><li><span>有关硬件平台参数的详细说明请参见</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/model-instruction/choose-hardware-platform.html'><span>选购硬件平台open in new window</span></a><span>。</span></li><li><span>若您仍使用</span><strong><span>PSDK V1.x.x 和 FlyPort</span></strong><span> 开发负载设备，请根据压缩包中</span><a href='https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/payload-sdk-doc-1.0.zip'><span>PSDK 1.x.xopen in new window</span></a><span>的文档连接FlyPort 和负载设备开发板。</span></li></ul></blockquote><h2 id='使用-s400-行业系列'><span>使用 S400 行业系列</span></h2><p><span>图 S400 行业系列 设备连接</span></p><p><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/V3.3/m3-enterprise-device-connection.png" referrerpolicy="no-referrer" alt="img"></p><h3 id='基于typec口的负载开发psdk接口）-1'><span>基于TypeC口的负载开发（PSDK接口）</span></h3><h4 id='psdk接口定义'><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/quick-start/device-connect.html#psdk接口定义'><span>#</span></a><span>PSDK接口定义</span></h4><p><span>图 S400 行业系列 PSDK接口图示</span></p><p><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/V3.3/m3e-hardwarepin.png" referrerpolicy="no-referrer" alt="img"></p><p><span>表 PSDK 接口引脚介绍</span></p><figure><table><thead><tr><th><span>编号</span></th><th><span>A1</span></th><th><span>A2</span></th><th><span>A3</span></th><th><span>A4</span></th><th><span>A5</span></th><th><span>A6</span></th><th><span>A7</span></th><th><span>A8</span></th><th><span>A9</span></th><th><span>A10</span></th><th><span>A11</span></th><th><span>A12</span></th></tr></thead><tbody><tr><td><span>接口名称</span></td><td><span>GND</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>VCC</span></td><td><span>SYNC_PPS</span></td><td><span>USB_ID</span></td><td><span>USB_VBUS</span></td><td><span>ON_DET</span></td><td><span>VCC</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>GND</span></td></tr><tr><td><span>编号</span></td><td><span>B12</span></td><td><span>B11</span></td><td><span>B10</span></td><td><span>B9</span></td><td><span>B8</span></td><td><span>B7</span></td><td><span>B6</span></td><td><span>B5</span></td><td><span>B4</span></td><td><span>B3</span></td><td><span>B2</span></td><td><span>B1</span></td></tr><tr><td><span>接口名称</span></td><td><span>GND</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>VCC</span></td><td><span>UART_RX</span></td><td><span>USB_DM</span></td><td><span>USB_DP</span></td><td><span>UART_TX</span></td><td><span>VCC</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>GND</span></td></tr></tbody></table></figure><h5 id='接口功能说明-1'><span>接口功能说明</span></h5><blockquote><p><strong><span>说明：</span></strong></p><ul><li><span>不同机型之间在供电接口、USB_VBUS和USB_ID接口上存在差异，在软硬件设计上需要考虑兼容性。</span></li><li><span>NC引脚为飞机端预留信号引脚。为避免开发或使用中第三方设备损坏飞机端SDK接口，请将NC引脚置空，不要与设备端自定义接口连接。</span></li></ul></blockquote><ul><li><p><span>供电接口：</span></p><ul><li><p><span>如需为用户负载设备供电，请使用VCC引脚。</span></p><blockquote><p><strong><span>说明：</span></strong></p><ul><li><span>该接口的额定电压为12-17.6V（随电池电压降低），电流限制3A，无人机输出的总功率36-52.8W。</span></li><li><span>该接口的VCC引脚在同一网络下，开发者可根据实际的使用需求连接VCC引脚数量。但为保证无人机能够持续稳定地输出电流，请同时连接4 个VCC引脚。</span></li></ul></blockquote></li><li><p><span>S400 行业系列默认做USB主设备，USB_ID引脚（A6）必须拉低。</span></p></li><li><p><span>飞行器无电压输出能力，只能检测外部电压的有无，USB_VBUS引脚（A7）无电压输出能力。</span></p></li><li><p><span>ON_DET 引脚（A8）为S400 行业系列外接PSDK设备检测引脚，接入ON_DET 引脚（A8）的对端必须为GND，请勿串联任何阻值电阻，此时才会有12-17.6V电压输出。</span></p></li></ul></li><li><p><span>数据通信接口：</span></p><ul><li><span>如需使用USB 2.0或者RNDIS（TCP/IP over USB） 的功能，请使用USB_DP 引脚（B6）和USB_DM 引脚（B7）。</span></li><li><span>如需通过无人机上的串口，实现用户负载设备和无人机间的通信，请使用UART_RX 引脚（B8）和UART_TX 引脚（B5）。UART_RX 引脚（B8）需连接PSDK设备的TX端，UART_TX 引脚（B5）需连接PSDK设备的RX端。</span></li></ul><blockquote><p><strong><span>说明：</span></strong><span> S400 机型所支持的串口波特率为 921600。</span></p></blockquote></li><li><p><span>时间同步：如需使用无人机对外输出的同步信号，实现时间同步功能，请使用SYNC_PPS 引脚（A5）。</span></p></li></ul><h5 id='硬件参考设计-1'><span>硬件参考设计</span></h5><p><span>请点击查看：</span><a href='https://github.com/gdu-sdk/Payload-SDK/blob/master/doc/reference_designs/Type-C Schematic Reference.pdf'><span>硬件参考设计open in new window</span></a><span>。</span></p><h2 id='使用-s400-系列'><span>使用 S400 系列</span></h2><p><span>S400 只有一种设备连接方式，通过PSDK接口，使用</span><code>SDK 同轴线</code><span>与第三方开发板相连。</span></p><p><span>图 S400 设备连接</span></p><p><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/V3.3/M30%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5.png" referrerpolicy="no-referrer" alt="img"></p><h3 id='基于typec口的负载开发psdk接口）-2'><span>基于TypeC口的负载开发（PSDK接口）</span></h3><h4 id='typec接口定义'><span>TypeC接口定义</span></h4><p><span>图 转接板连接线接口</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/2ad3a43c-57df-47a8-8450-eb937589df77.png" referrerpolicy="no-referrer" alt="OSDK CN.jpg"></p><p><span>表 转接板连接线接口</span></p><figure><table><thead><tr><th><span>编号</span></th><th><span>A1</span></th><th><span>A2</span></th><th><span>A3</span></th><th><span>A4</span></th><th><span>A5</span></th><th><span>A6</span></th><th><span>A7</span></th><th><span>A8</span></th><th><span>A9</span></th><th><span>A10</span></th><th><span>A11</span></th><th><span>A12</span></th></tr></thead><tbody><tr><td><span>接口名称</span></td><td><span>GND</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>VCC</span></td><td><span>SYNC_PPS</span></td><td><span>USB_ID</span></td><td><span>USB_VBUS</span></td><td><span>ON_DET</span></td><td><span>VCC</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>GND</span></td></tr><tr><td><span>编号</span></td><td><span>B12</span></td><td><span>B11</span></td><td><span>B10</span></td><td><span>B9</span></td><td><span>B8</span></td><td><span>B7</span></td><td><span>B6</span></td><td><span>B5</span></td><td><span>B4</span></td><td><span>B3</span></td><td><span>B2</span></td><td><span>B1</span></td></tr><tr><td><span>接口名称</span></td><td><span>GND</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>VCC</span></td><td><span>UART_RX</span></td><td><span>USB_DM</span></td><td><span>USB_DP</span></td><td><span>UART_TX</span></td><td><span>VCC</span></td><td><span>NC</span></td><td><span>NC</span></td><td><span>GND</span></td></tr></tbody></table></figure><h5 id='接口功能说明-2'><span>接口功能说明</span></h5><blockquote><p><strong><span>说明：</span></strong></p><ul><li><span>不同机型之间在供电接口、USB_VBUS和USB_ID接口上存在差异，在软硬件设计上需要考虑兼容性。</span></li><li><span>NC引脚为飞机端预留信号引脚。为避免开发或使用中第三方设备损坏飞机端SDK接口，请将NC引脚置空，不要与设备端自定义接口连接。</span></li></ul></blockquote><ul><li><p><span>供电接口：</span></p><ul><li><p><span>如需为用户负载设备供电，请使用VCC引脚。</span></p><blockquote><p><strong><span>说明：</span></strong></p><ul><li><span>该接口的额定电压为19.2-26.1V（随电池电压降低），电流限制4A，且无人机输出的总功率为76.8-104.4W。</span></li><li><span>该接口的VCC引脚在同一网络下，开发者可根据实际的使用需求连接VCC引脚数量。但为保证无人机能够持续稳定地输出电流，请同时连接4 个VCC引脚。</span></li></ul></blockquote></li><li><p><span>S400系列默认做USB主设备，USB_ID引脚（A6）必须拉低。</span></p></li><li><p><span>USB_VBUS引脚（A7）只有在USB_ID引脚（A6）被拉低时，才会输出5V电压输出，最高500mA。</span></p></li><li><p><span>ON_DET 引脚（A8）为S400系列外接PSDK设备检测引脚，接入ON_DET 引脚（A8）的对端必须为GND，请勿串联任何阻值电阻，此时才会有19.2-26.1V电压输出。</span></p></li></ul></li><li><p><span>数据通信接口：</span></p><ul><li><span>如需使用USB 2.0或者RNDIS（TCP/IP over USB） 的功能，请使用USB_DP 引脚（B6）和USB_DM 引脚（B7）。</span></li><li><span>如需通过无人机上的串口，实现用户负载设备和无人机间的通信，请使用UART_RX 引脚（B8）和UART_TX 引脚（B5）。UART_RX 引脚（B8）需连接PSDK设备的TX端，UART_TX 引脚（B5）需连接PSDK设备的RX端。</span></li></ul><blockquote><p><strong><span>说明：</span></strong><span> S400 机型所支持的串口波特率为 115200、230400、460800、921600、1000000。</span></p></blockquote></li><li><p><span>时间同步：如需使用无人机对外输出的同步信号，实现时间同步功能，请使用SYNC_PPS 引脚（A5）。</span></p></li></ul><h5 id='硬件参考设计-2'><span>硬件参考设计</span></h5><p><span>请点击查看：</span><a href='https://github.com/gdu-sdk/Payload-SDK/blob/master/doc/reference_designs/Type-C Schematic Reference.pdf'><span>硬件参考设计open in new window</span></a><span>。</span></p><h4 id='使用sdk同轴线'><span>使用SDK同轴线</span></h4><p><span>开发者根据同轴线的</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/quick-start/device-connect.html#9'><span>引脚定义</span></a><span>，将SDK 同轴线集成至负载中，并通过该线材将用户定制的负载设备与对应的飞机进行连接。</span></p><h2 id='使用-s400-rtk'><span>使用 S400 RTK</span></h2><p><span>S400 RTK 有三种连接方式：</span></p><ol start='' ><li><span>通过</span><code>云台口</code><span>，使用</span><code>FlyPort V2</code><span>连接接口拓展板，与第三方开发板相连</span></li><li><span>通过</span><code>OSDK 拓展接口</code><span>，使用</span><code>SDK 同轴线</code><span>与第三方开发板相连</span></li></ol><blockquote><p><strong><span>说明：</span></strong></p><ul><li><span>按照 S400 RTK 前进方向，以俯视视角来说，上置云台口在机身上方左侧，OSDK 拓展接口在机身上方右侧，下置云台口在机身下方。</span></li><li><span>云台口 在 S400 RTK 上为 上置云台口 与 下置云台口 的统称。</span></li></ul></blockquote><h3 id='基于云台口的负载开发'><span>基于云台口的负载开发</span></h3><h4 id='使用flyport-v2'><span>使用FlyPort V2</span></h4><p><span>FlyPort V2 提供了排线接口和同轴线接口，使用排线通过Port 1 接口可将FlyPort V2 连接至接口拓展板或第三方开发板。使用同轴线通过Port 2 接口可将FlyPort V2 连接至FlyPort 负载设备开发板。FlyPort V2 的引脚如 图2.FlyPort V2 引脚接口 所示。</span></p><blockquote><p><strong><span>注意</span></strong></p><ul><li><span>请勿同时使用Port 1 和Port 2。</span></li><li><span>使用排线连接接口拓展板和FlyPort V2 上的Port 1 接口时，请务必使红色线缆与圆点标记位对齐插入，避免接反线缆烧毁负载设备。</span></li></ul></blockquote><p><span>图 FlyPort V2 引脚接口</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/7b4cf714-184a-44b3-abf6-bde3b57541d7.png" referrerpolicy="no-referrer" alt="img"></p><h5 id='port-1'><span>Port 1</span></h5><ul><li><span>使用FlyPort V2 的供电功能，请使用引脚：1～６。</span></li><li><span>为实现使用FlyPort V2 开发的负载设备与GDU 的无人机通信，</span><strong><span>必须</span></strong><span>连接引脚：11和12。</span></li><li><span>使用PSDK 提供的时间同步功能，需要连接PPS 引脚（14）与</span><strong><span>具有RTK 功能的无人机</span></strong><span>间同步时间。</span></li><li><span>使用高功率功能的负载设备通过引脚15 和16 向GDU 的无人机申请高功率。</span></li><li><span>使用网口高速数据传输功能，需连接引脚17～20。</span></li></ul><h5 id='port-2'><span>Port 2</span></h5><ul><li><span>使用FlyPort V2 的供电功能，请使用引脚：1～17。</span></li><li><span>为实现使用FlyPort V2 开发的负载设备与GDU 的无人机通信，</span><strong><span>必须</span></strong><span>连接引脚：37和39。</span></li><li><span>使用PSDK 提供的时间同步功能，需要连接PPS 引脚（19）与</span><strong><span>具有RTK 功能的无人机</span></strong><span>间同步时间。</span></li><li><span>使用高功率功能的负载设备通过HIGH_POWER_APPLY 引脚（22） 向GDU 的无人机申请高功率。</span></li><li><span>使用高速数据传输功能，需连接引脚23、25、29 和31。</span></li></ul><h5 id='安装负载设备'><span>安装负载设备</span></h5><ol start='' ><li><p><span>安装主轴臂：使用四颗M2×12 的螺丝锁定负载设备，负载设备上对应螺纹孔的深度不小于5.3 mm。</span></p></li><li><p><span>安装辅轴臂：使用一颗M3 螺丝、辅轴臂套筒和辅轴臂胶塞锁定辅轴臂。确保M3螺丝穿过俯仰轴中心轴线。</span></p></li><li><p><span>负载设备质心位置</span></p><ul><li><span>质心位置不变的负载，需保证负载设备的质心位于俯仰轴中心轴线上。</span></li><li><span>质心位置可变的负载设备如变焦相机，需保证当变焦镜头在最大变焦倍数时，相机的质心位于P轴的轴线上。</span></li></ul></li></ol><h2 id='配置开发环境'><span>配置开发环境</span></h2><h2 id='获取基础软件'><span>获取基础软件</span></h2><ul><li><a href='https://www.gdu.com/cn/downloads/softwares/assistant-gdu-2-for-matrice'><span>GDU Assistant 2open in new window</span></a></li><li><a href='https://github.com/gdu-sdk/Payload-SDK'><span>Payload SDK 软件开发工具包open in new window</span></a></li><li><a href='https://developer.gdu.com/mobile-sdk/downloads/'><span>Mobile SDK 软件开发工具包open in new window</span></a><span> （可选）</span></li></ul><h2 id='配置rtos-开发环境'><span>配置RTOS 开发环境</span></h2><ul><li><p><span>安装</span><a href='http://www2.keil.com/mdk5/'><span>Keil MDKopen in new window</span></a><span>和相关开发工具</span></p><ul><li><span>C Compiler: Armcc.exe V5.06 update 6 (build 750)</span></li><li><span>Assembler: Armasm.exe V5.06 update 6 (build 750)</span></li><li><span>Linker/Locator: ArmLink.exe V5.06 update 6 (build 750)</span></li><li><span>Library Manager: ArmAr.exe V5.06 update 6 (build 750)</span></li><li><span>Hex Converter: FromElf.exe V5.06 update 6 (build 750)</span></li></ul></li><li><p><span>使用Keil软件</span>
<strong><span>激活Keil MDK 软件</span></strong><span>后，使用Keil Pack Installer 或</span><a href='http://www.keil.com/dd2/Pack/'><span>手动下载</span></a><span>最新的STM32F4xx_DFP.2.x.x 驱动包，如 图1.安装Pack 包 所示。</span></p></li></ul><p><span>图1.安装Pack 包</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/4c23df4b-cf4b-440d-9f17-19f7134c5c81.png" referrerpolicy="no-referrer" alt="img"></p><h2 id='配置linux-开发环境'><span>配置Linux 开发环境</span></h2><p><span>使用Linux 开发环境时，请安装如下开发工具：</span></p><ul><li><span>C编译器： GCC 5.4.0/5.5.0 版本</span></li><li><span>CMake：2.8 及以上版本</span></li><li><span>FFmpeg：版本需要高于或等于 4.1.3，低于5.0.0</span></li></ul><h2 id='运行示例程序'><span>运行示例程序</span></h2><p><span>在注册 PSDK 企业账号后，请下载 PSDK 提供的示例代码并在示例代码中补充应用信息，通过编译、调试和烧录等操作获得示例程序。在 GDU Assistant 2 上绑定 GDU 的硬件平台后，即可运行示例程序，借助示例程序了解使用 PSDK 开发负载设备的方法。</span></p><blockquote><p><strong><span>提示：</span></strong><span> 如需将 RTOS 或 Linux 的示例代码运行在其他开发板或操作系统中，请参考 </span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/quick-start/porting.html'><span>跨平台移植open in new window</span></a><span>。</span></p></blockquote><h2 id='获取示例代码'><span>获取示例代码</span></h2><p><span>在 </span><a href='https://developer.gdu.com/payload-sdk/apply/'><span>注册</span></a><span>成为 GDU PSDK 的企业用户后，即可下载 GDU PSDK 开发包，在 PSDK 开发包中获取 GDU 提供的示例代码，借助示例代码了解使用 PSDK 开发负载设备的方法，使用示例代码快速开发出功能完善的出负载设备。</span></p><h2 id='创建负载应用'><span>创建负载应用</span></h2><p><span>获取使用 PSDK 开发负载产品的</span><a href='https://developer.gdu.com/payload-sdk/apply'><span>权限open in new window</span></a><span> 后，请在</span><a href='https://developer.gdu.com/user/apps/#all'><span>用户中心open in new window</span></a><span> 创建负载应用，获取应用 ID 和应用秘钥，如 图. 填写应用信息 所示。</span></p><p><span>图. 填写应用信息</span></p><p><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/v3.4/create-applicaton.png" referrerpolicy="no-referrer" alt="img"></p><blockquote><p><strong><span>注意：</span></strong><span> 为提高您的开发效率，请在示例代码中</span><strong><span>正确</span></strong><span>填写</span><em><span>应用的名称</span></em><span>、</span><em><span>ID</span></em><span>、</span><em><span>Key</span></em><span>和</span><em><span>开发者账号</span></em><span>，否则编译后的示例程序将无法正常运行。</span></p></blockquote><h2 id='运行-rtos-示例代码'><span>运行 RTOS 示例代码</span></h2><blockquote><p><strong><span>说明：</span></strong><span> 本文以</span><strong><span>STM32F4 Discovery 开发板</span></strong><span>为例，介绍运行 RTOS 示例代码的步骤和方法。</span></p></blockquote><h3 id='烧录-bootloader'><span>烧录 Bootloader</span></h3><ol start='' ><li><span>使用 Keil MDK IDE 打开位于</span><code>sample/sample_c/platform/rtos_freertos/stm32f4_discovery/project/mdk_bootloader/</code><span>目录下的工程文件</span><code>mdk_bootloader.uvprojx</code><span>。</span></li><li><span>使用 Keil MDK IDE 编译工程为示例程序。</span></li><li><span>将编译后的示例程序</span><strong><span>烧录</span></strong><span>到负载设备中（如 STM32F4_discovery 开发板）。</span></li></ol><blockquote><p><strong><span>相关参考</span></strong></p><ul><li><span>实现 Bootloader：</span><code>platform/rtos_freertos/stm32f4_discovery/bootloader</code></li><li><span>Bootloader 工程目录：</span><code>platform/rtos_freertos/stm32f4_discovery/project/mdk_bootloader</code></li></ul></blockquote><h3 id='补充应用信息-1'><span>补充应用信息</span></h3><ol start='' ><li><span>使用 Keil IDE 打开位于</span><code>sample/sample_c/platform/rtos_freertos/stm32f4_discovery/project/mdk/</code><span>目录下的工程文件</span><code>mdk_app.uvprojx</code><span>。</span></li><li><span>在 </span><code>sample/sample_c/platform/rtos_freertos/application/gdu_sdk_app_info.h</code><span> 文件中补充应用的名称、ID、Key、License、开发者账号和指定波特率。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "your_app_name"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "your_app_id"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_KEY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "your_app_key"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_LICENSE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "your_app_license"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_DEVELOPER_ACCOUNT &nbsp; &nbsp;  "your_developer_account"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_BAUD_RATE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "460800"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><h3 id='编译并烧录'><span>编译并烧录</span></h3><ul><li><span>使用 Keil MDK IDE 编译示例代码为示例程序。</span></li><li><span>编译示例代码后，将编译后的程序</span><strong><span>烧录</span></strong><span>到负载设备中（如 STM32F4_discovery 开发板）。</span></li><li><span>如需调试示例程序，请将串口调试工具的波特率设置为：</span><code>921600</code><span>。</span></li></ul><h2 id='运行-linux-示例代码'><span>运行 Linux 示例代码</span></h2><blockquote><p><strong><span>说明：</span></strong><span> 本文以 Manifold 2-C 为例，介绍运行 Linux 示例代码的步骤和方法。</span></p></blockquote><h3 id='补充应用信息-2'><span>补充应用信息</span></h3><ul><li><span>在 </span><code>samples/sample_c/platform/linux/manifold2/application/gdu_sdk_app_info.h</code><span> 文件中替换应用的名称、ID、Key、License、开发者账号和指定波特率。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "your_app_name"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "your_app_id"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_KEY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "your_app_key"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_APP_LICENSE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "your_app_license"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_DEVELOPER_ACCOUNT &nbsp; &nbsp;  "your_developer_account"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define USER_BAUD_RATE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  "460800"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><ul><li><span>在 </span><code>samples/sample_c/platform/linux/manifold2/hal/hal_uart.h</code><span> 文件的 </span><code>LINUX_UART_DEV1</code><span>和 </span><code>LINUX_UART_DEV2</code><span> 宏中填写对应的串口名称。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define LINUX_UART_DEV1 &nbsp;  "/dev/your_com"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define LINUX_UART_DEV2 &nbsp;  "/dev/your_com"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><ul><li><span>通过</span><code>ifconfig</code><span>命令，查看当前与无人机通讯的网口设备名称，并填写到</span><code>samples/sample_c/platform/linux/manifold2/hal/hal_network.h</code><span> 文件的 </span><code>LINUX_NETWORK_DEV</code><span> 宏中。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#define LINUX_NETWORK_DEV &nbsp;  "your_network_name"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h3 id='编译示例程序'><span>编译示例程序</span></h3><ul><li><p><strong><span>编译示例代码</span></strong></p><p><span>进入示例代码工程的根目录下：</span><code>Payload-SDK/</code><span>，使用如下命令将示例代码编译为示例程序。</span></p><ol start='' ><li><code>mkdir build</code></li><li><code>cd build</code></li><li><code>cmake ..</code></li><li><code>make</code></li></ol><p><span>根目录位置说明：</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Payload-SDK/</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── CMakeLists.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── EULA.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── LICENSE.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── README.md</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── build/</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── doc/</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── psdk_lib/</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">├── samples/</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">└── tools/</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><ul><li><p><strong><span>执行 C 语言示例程序</span></strong></p><ul><li><span>进入示例程序的目录： </span><code>cd build/bin/</code></li><li><span>使用</span><code>sudo ./gdu_sdk_demo_linux</code><span>命令运行示例程序</span></li></ul></li><li><p><strong><span>执行 C++ 语言示例程序</span></strong></p><ul><li><span>进入示例程序的目录： </span><code>cd build/bin/</code></li><li><span>使用</span><code>sudo ./gdu_sdk_demo_linux_cxx</code><span>命令运行示例程序</span></li></ul></li></ul><h2 id='应用绑定flyport-v2）'><span>应用绑定（FlyPort V2）</span></h2><p><span>通过 GDU Assistant 2 将 FlyPort V2 与示例程序绑定后，当负载设备挂载在无人机上时，负载设备将自动运行开发者编译或烧录的示例程序。</span></p><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>使用 GDU Assistant 2 绑定或调试负载设备时，请先在软件右上角的 “配置” 标签中打开 </span><strong><span>“数据授权”</span></strong><span> 开关，否则 GDU Assistant 2 将无法正常绑定或调试负载设备。</span></li><li><span>初次绑定 FlyPort V2 后，在不同的无人机上使用同一个 FlyPort V2 时，无需重新绑定示例程序。</span></li></ul></blockquote><ol start='' ><li><span>将负载设备（如 Manifold 2-C）或开发板（如 STM32F407IGH6-EVAL）挂载在 GDU 的无人机上，同时将 GDU 的无人机连接到计算机。</span></li><li><span>使用</span><strong><span>应用信息</span></strong><span>中的</span><strong><span>账号</span></strong><span>登陆 GDU Assistant 2 ，单击 “Payload SDK ” 选项卡，进入 PSDK 硬件平台界面。</span></li><li><span>在 PSDK 硬件平台界面，单击 “绑定” 按钮，绑定硬件平台、示例程序和 GDU 无人机。</span></li><li><span>绑定成功后，PSDK 硬件平台界面中的绑定状态将显示为</span><code>已绑定</code><span>，如 图. 应用绑定 所示。</span></li></ol><p><span>图. 应用绑定</span></p><p><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/v3.4/app-bind.png" referrerpolicy="no-referrer" alt="img"></p><ol start='' ><li><span>确认 PSDK 适配器与 PSDK 负载通信波特率为 460800（PSDK 示例程序通信波特率为 460800）。</span></li></ol><p><span>图. 设置通信波特率</span></p><p><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/v3.4/baud-rate.jpeg" referrerpolicy="no-referrer" alt="img"></p><ol start='' ><li><span>应用绑定成功后，负载设备将自动运行示例程序。</span></li></ol><h2 id='绑定故障排查'><span>绑定故障排查</span></h2><h3 id='1-flyport-v2-故障排查'><span>1. FlyPort V2 故障排查</span></h3><figure><table><thead><tr><th><span>错误代码</span></th><th><span>错误说明</span></th><th><span>解决方案</span></th></tr></thead><tbody><tr><td><span>1</span></td><td><span>无法获取负载信息</span></td><td><span>1. 确认硬件平台正常连接 2. 确认基于 PSDK 开发的负载设备控制程序已正常运行</span></td></tr><tr><td><span>2</span></td><td><span>开发者账号非法</span></td><td><span>请确认负载设备控制程序中的用户信息与所绑定的转接环的用户信息相同</span></td></tr><tr><td><span>3</span></td><td><span>无法获取认证信息</span></td><td><span>请将负载设备中的日志信息提交给 GDU 技术支持团队排查相应的问题</span></td></tr><tr><td><span>4</span></td><td><span>FlyPort 校验失败</span></td><td>&nbsp;</td></tr><tr><td><span>5</span></td><td><span>认证信息错误</span></td><td>&nbsp;</td></tr><tr><td><span>6</span></td><td><span>存储绑定信息失败</span></td><td>&nbsp;</td></tr><tr><td><span>7</span></td><td><span>无法获取 SN 号</span></td><td>&nbsp;</td></tr></tbody></table></figure><h3 id='2-应用服务故障排查'><span>2. 应用服务故障排查</span></h3><figure><table><thead><tr><th><span>错误代码</span></th><th><span>错误说明</span></th><th><span>解决方案</span></th></tr></thead><tbody><tr><td><span>400</span></td><td><span>SN 不存在</span></td><td><span>请将负载设备中的日志信息提交给 GDU 技术支持团队排查相应的问题</span></td></tr><tr><td><span>500</span></td><td><span>服务器异常</span></td><td>&nbsp;</td></tr><tr><td><span>700</span></td><td><span>未找到负载设备的应用程序</span></td><td>&nbsp;</td></tr><tr><td><span>701</span></td><td><span>数据校验失败</span></td><td>&nbsp;</td></tr><tr><td><span>702</span></td><td><span>绑定关系错误</span></td><td>&nbsp;</td></tr></tbody></table></figure><h3 id='3-调参软件故障排查'><span>3. 调参软件故障排查</span></h3><figure><table><thead><tr><th><span>错误代码</span></th><th><span>错误说明</span></th><th><span>解决方案</span></th></tr></thead><tbody><tr><td><span>3</span></td><td><span>网络异常</span></td><td><span>请确认您的计算机能够访问互联网</span></td></tr><tr><td><span>4</span></td><td><span>调参软件错误</span></td><td><span>重新安装调参软件或重新启动计算机</span></td></tr><tr><td><span>5</span></td><td><span>FTP 错误</span></td><td>&nbsp;</td></tr></tbody></table></figure><h2 id='编译故障排查'><span>编译故障排查</span></h2><h3 id='使用-keil-mdk-编译示例代码时报错errorl6050u'><span>使用 Keil MDK 编译示例代码时报错：“error：L6050U”</span></h3><ul><li><span>故障原因：Keil MDK 未激活。</span></li><li><span>解决方法：使用 Keil MDK 编译示例代码前请先激活 Keil MDK。</span></li></ul><h2 id='跨平台移植'><span>跨平台移植</span></h2><p><span>将基于PSDK 开发的负载设备控制程序移植到不同版本的软硬件平台上时，需要先初始化Hal 和Osal 层，注册关键的配置信息。通过加载静态库、引用指定的资源文件并声明结构体，设置负载设备控制程序跨平台移植所需的配置信息。最后使用指定的接口将Platform 模块注册到负载设备的控制程序中，获取硬件资源和操作系统资源，实现负载设备控制程序的跨平台移植。</span></p><h2 id='示例代码'><span>示例代码</span></h2><ul><li><p><span>Linux</span></p><ul><li><span>Hal 层适配：</span><code>samples/sample_c/platform/linux/manifold2/hal</code></li><li><span>Osal 层适配：</span><code>samples/sample_c/platform/linux/common/osal/</code></li></ul></li><li><p><span>FreeRTOS</span></p><ul><li><span>Hal 层适配：</span><code>samples/sample_c/platform/rtos_freertos/stm32f4_discovery/hal</code></li><li><span>Osal 层适配：</span><code>samples/sample_c/platform/rtos_freertos/common/osal/</code></li></ul></li></ul><blockquote><p><strong><span>说明：</span></strong><span> PSDK Platform 模块的API 接口，在</span><code>psdk_lib/include/gdu_platform.h</code><span>文件中。</span></p></blockquote><h2 id='概述-1'><span>概述</span></h2><p><span>为能使基于PSDK 开发的负载设备控制程序移植到不同的软硬件平台，需要通过Hal（Hardware Abstraction Layer，硬件接口层）适配不同的硬件平台，通过Osal（Operating System Abstraction Layer，操作系统抽象层）实现与不同操作系统的兼容，如 图1.代码移植 所示。</span></p><p><span>图1.代码移植</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/5dce3cd2-f792-4639-b710-eabe6360167f.png" referrerpolicy="no-referrer" alt="img"></p><h2 id='基础概念-1'><span>基础概念</span></h2><h3 id='hal-层'><span>Hal 层</span></h3><p><span>Hal（Hardware Abstraction Layer，硬件接口层）是PSDK 硬件接口抽象层，位于操作系统、负载设备控制程序和硬件接口间。开发者需要按照</span><code>GduPlatform_RegHalUartHandler()</code><span>, </span><code>GduPlatform_RegHalUsbBulkHandler</code><span>与</span><code>GduPlatform_RegHalNetworkHandler()</code><span>接口中的函数原型，实现并将适配Hal 层的函数注册到负载设备控制程序中，使基于PSDK 开发的负载设备控制程序，通过Hal 层即可直接访问负载设备硬件的底层资源，控制负载设备执行相应的动作，使负载设备控制程序能够适配不同的硬件平台，如STM32F407IGH6-EVAL 或Manifold 2-C 等。</span></p><h4 id='网口设备'><span>网口设备</span></h4><p><span>需要使用网口的设备适配Hal 层函数需要执行如下操作：</span></p><ul><li><p><span>实现适配Hal 层网口操作函数</span></p><ul><li><span>本地网卡初始化：</span><code>T_GduReturnCode (*NetworkInit)(const char *ipAddr, const char *netMask, T_GduNetworkHandle *networkHandle)</code></li><li><span>本地网卡反初始化：</span><code>T_GduReturnCode (*NetworkDeInit)(T_GduNetworkHandle networkHandle)</code></li><li><span>获取网卡信息：</span><code>T_GduReturnCode (*NetworkGetDeviceInfo)(T_GduHalNetworkDeviceInfo *deviceInfo)</code></li></ul></li><li><p><span>使用</span><code>GduPlatform_RegHalNetworkHandler()</code><span>接口注册网口操作函数</span></p></li></ul><h4 id='串口设备'><span>串口设备</span></h4><p><span>使用串口通信的设备适配Hal 层函数需要执行如下操作：</span></p><ul><li><p><span>实现适配Hal 层UART 操作函数</span></p><ul><li><span>串口初始化：</span><code>T_GduReturnCode (*UartInit)(E_GduHalUartNum uartNum, uint32_t baudRate, T_GduUartHandle *uartHandle)</code></li><li><span>串口反初始化：</span><code>T_GduReturnCode (*UartDeInit)(T_GduUartHandle uartHandle)</code></li><li><span>发送数据：</span><code>T_GduReturnCode (*UartWriteData)(T_GduUartHandle uartHandle, const uint8_t *buf, uint32_t len, uint32_t *realLen)</code></li><li><span>接收数据：</span><code>T_GduReturnCode (*UartReadData)(T_GduUartHandle uartHandle, uint8_t *buf, uint32_t len, uint32_t *realLen)</code></li><li><span>获取串口状态： </span><code>T_GduReturnCode (*UartGetStatus)(E_GduHalUartNum uartNum, T_GduUartStatus *status)</code></li></ul></li><li><p><span>使用</span><code>GduPlatform_RegHalUartHandler()</code><span>接口注册串口操作函数</span></p></li></ul><blockquote><p><strong><span>说明</span></strong></p><ul><li><p><span>负载设备串口的参数</span></p><ul><li><span>波特率：460800(FlyPort V2/X-Port　固件版本低于且包含V01.01.0100)或者GDU Assistant 2 软件设置值(FlyPort V2/X-Port　固件版本高于V01.01.0100)</span></li><li><span>停止位：1</span></li><li><span>数据位：8</span></li><li><span>奇偶校验：无</span></li></ul></li><li><p><span>可通过GDU Assistant 2 软件设置FlyPort V2/X-Port 与PSDK 负载设备的通信波特率（PSDK 设备通信参数须与FlyPort V2/X-Port 保持一致），完美适配不同的硬件平台（某些硬件平台不支持默认通信参数或存在功能缺陷）且适应不同的应用场景（例如订阅大量数据时需适当提高通信波特率）。</span></p></li></ul></blockquote><p><span>图２. 设置通信波特率</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/eacc5743-8920-4f1c-92aa-e063a60e4745.jpg" referrerpolicy="no-referrer" alt="img"></p><h4 id='usb设备'><span>USB设备</span></h4><p><span>使用USB Bulk通信的设备适配Hal 层函数需要执行如下操作：</span></p><ul><li><p><span>实现适配Hal 层USB Bulk 操作函数</span></p><ul><li><span>USB Bulk初始化：</span><code>T_GduReturnCode (*UsbBulkInit)(T_GduHalUsbBulkInfo usbBulkInfo, T_GduUsbBulkHandle *usbBulkHandle)</code></li><li><span>USB Bulk反初始化：</span><code>T_GduReturnCode (*UsbBulkDeInit)(T_GduUsbBulkHandle usbBulkHandle)</code></li><li><span>USB Bulk写数据：</span><code>T_GduReturnCode (*UsbBulkWriteData)(T_GduUsbBulkHandle usbBulkHandle, const uint8_t *buf, uint32_t len, uint32_t *realLen)</code></li><li><span>USB Bulk读数据：</span><code>T_GduReturnCode (*UsbBulkReadData)(T_GduUsbBulkHandle usbBulkHandle, uint8_t *buf, uint32_t len, uint32_t *realLen)</code></li><li><span>获取USB Bulk信息(仅针对SDK设备端作为USB Device的情况)：</span><code>T_GduReturnCode (*UsbBulkGetDeviceInfo)(T_GduHalUsbBulkDeviceInfo *deviceInfo)</code></li></ul></li><li><p><span>使用</span><code>GduPlatform_RegHalUsbBulkHandler()</code><span>接口注册 USB Bulk 操作函数</span></p></li></ul><p><span>在S400 RTK，USB的主从模式存在差异：</span></p><ul><li><span>S400 RTK：SDK设备端为USB Host，飞机端为USB Device</span></li></ul><h5 id='s400-rtk'><span>S400 RTK</span></h5><p><span>USB功能限制如下表所示</span></p><figure><table><thead><tr><th style='text-align:center;' ><span>USB功能</span></th><th style='text-align:center;' ><span>功能限制</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>虚拟串口</span></td><td style='text-align:center;' ><span>云台管理、相机管理、部分基础通信</span></td></tr><tr><td style='text-align:center;' ><span>USB Bulk</span></td><td style='text-align:center;' ><span>获取码流、获取感知灰度图、MOP功能、媒体文件管理</span></td></tr></tbody></table></figure><p><span>虚拟串口：</span></p><ol start='' ><li><span>Linux平台：无需额外配置，驱动默认支持。可以通过</span><code>ls /dev/ttyACMx</code><span>查询到，当作标准串口设备进行操作。</span></li><li><span>RTOS平台：需要移植USB Host的库进行读写操作，详情请参考 samples/sample_c/platform/rtos_freertos/stm32f4_discovery/middlewares/ST/STM32_USB_Host_Library/中的USB_Host移植实现。</span></li></ol><p><span>USB-Bulk：</span></p><ol start='' ><li><p><span>Linux平台：用户在Type-C拓展口开发程序，可以通过安装并调用libusb静态库的方式进行开发。</span></p><p><span>安装方法如下：</span><code>sudo apt-get install libusb-1.0-0-dev</code></p></li><li><p><span>RTOS平台：不支持USB Bulk相关驱动。</span></p></li></ol><h5 id='s400'><span>S400</span></h5><p><span>USB功能限制如下表所示</span></p><figure><table><thead><tr><th style='text-align:center;' ><span>USB功能</span></th><th style='text-align:center;' ><span>功能限制</span></th></tr></thead><tbody><tr><td style='text-align:center;' ><span>RNDIS虚拟网卡/USB转以太网卡</span></td><td style='text-align:center;' ><span>推送相机码流、订阅主相机码流</span></td></tr><tr><td style='text-align:center;' ><span>USB Bulk通道1</span></td><td style='text-align:center;' ><span>推送第三方相机码流、获取码流</span></td></tr><tr><td style='text-align:center;' ><span>USB Bulk通道2</span></td><td style='text-align:center;' ><span>获取感知灰度图</span></td></tr></tbody></table></figure><h5 id='将开发平台的usb配置为从模式'><span>将开发平台的USB配置为从模式</span></h5><ol start='' ><li><span>配置USB为从模式（USB-Device）：配置开发平台的USB管脚复用，并且设置为USB-OTG或者USB-Device模式。当配置成功后，可以将USB口接到另外一个设备的USB Host上，可以查询对应的vid和pid信息，并确认是否符合预期。如我们将GDU Manifold 2-G的vid和pid配置为0x0955和0x7020，将USB接到另外一台Ubuntu上，通过</span><code>lsusb</code><span>命令方便地查询到。 </span><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/1.png" referrerpolicy="no-referrer" alt="1"></li><li><span>配置RNDIS网卡：首先确认平台是否支持并且打开 USB Gadget驱动，详细请参考</span><a href='https://www.elinux.org/images/e/ef/USB_Gadget_Configfs_API_0.pdf'><span>链接open in new window</span></a><span>。编写RNDIS的配置，以管理员身份运行后，可以将USB口接到另外一个设备的USB Host上，通过</span><code>ifconfig</code><span>命令查询到对应的网卡是否枚举出来，并确认是否符合预期，并且可以通过</span><code>ping</code><span>命令来检查是否通信成功。 </span><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/2.png" referrerpolicy="no-referrer" alt="2"><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/3.png" referrerpolicy="no-referrer" alt="3"></li><li><span>配置USB Bulk：首先确认是否平台是否支持并且打开 USB Gadget驱动，详细请参考</span><a href='https://www.elinux.org/images/e/ef/USB_Gadget_Configfs_API_0.pdf'><span>链接open in new window</span></a><span>。编写USB Bulk的配置配置并运行Bulk初始化程序，以管理员身份运行后，可以将USB口接到另外一个设备的USB Host上，先使用</span><code>sudo su</code><span>切换root账户再通过</span><code>cat /sys/kernel/debug/usb/devices</code><span>命令查询到对应的Bulk端口，并确认是否符合预期。对bulk设备的读写操作详情请参考hal_usb_bulk.c中的接口实现。 </span><img src="https://terra-1-g.gducdn.com/71a7d383e71a4fb8887a310eb746b47f/psdk/4.png" referrerpolicy="no-referrer" alt="4"></li></ol><h3 id='osal-层'><span>Osal 层</span></h3><p><span>Osal（Operating System Abstraction Layer，操作系统抽象层）是PSDK 的操作系统抽象层，位于负载设备控制程序和操作系统间。开发者需要按照</span><code>GduPlatform_RegOsalHandler()</code><span>接口中的函数原型，实现并将适配不同操作系统的函数注册到负载设备控制程序中，使用PSDK 开发的负载设备控制程序即可直接访问操作系统以及操作系统内核的资源，将负载设备控制程序移植到不同的操作系统上。</span></p><h4 id='线程函数'><span>线程函数</span></h4><p><span>使用线程机制管理负载设备控制程序执行相应的任务，开发者需要实现创建线程、销毁线程和线程睡眠的函数。</span></p><ul><li><span>创建线程：</span><code>T_GduReturnCode (*TaskCreate)(const char *name, void *(*taskFunc)(void *), uint32_t stackSize, void *arg, T_GduTaskHandle *task)</code></li><li><span>销毁线程：</span><code>T_GduReturnCode (*TaskDestroy)(T_GduTaskHandle task)</code></li><li><span>线程睡眠：</span><code>T_GduReturnCode (*TaskSleepMs)(uint32_t timeMs)</code></li></ul><h4 id='互斥锁'><span>互斥锁</span></h4><p><span>互斥锁是一种用于防止多个线程同时对同一队列、计数器和中断处理程序等公共资源（如共享内存等）执行读写操作的机制，能够有效避免进程死锁或长时间的等待。使用互斥锁机制，需要开发者实现创建互斥锁、销毁互斥锁、互斥锁上锁和互斥锁解锁。</span></p><ul><li><span>创建互斥锁：</span><code>T_GduReturnCode (*MutexCreate)(T_GduMutexHandle *mutex)</code></li><li><span>销毁互斥锁：</span><code>T_GduReturnCode (*MutexDestroy)(T_GduMutexHandle mutex)</code></li><li><span>互斥锁上锁：</span><code>T_GduReturnCode (*MutexLock)(T_GduMutexHandle mutex)</code></li><li><span>互斥锁解锁：</span><code>T_GduReturnCode (*MutexUnlock)(T_GduMutexHandle mutex)</code></li></ul><h4 id='信号量'><span>信号量</span></h4><p><span>信号量是一种用于防止多线程同时操作相同代码段的机制。开发者使用该机制时，需要实现创建信号量、销毁信号量、等待信号量、释放信号量和等待超时信号量函数。</span></p><ul><li><span>创建信号量：</span><code>T_GduReturnCode (*SemaphoreCreate)(uint32_t initValue, T_GduSemaHandle *semaphore)</code></li></ul><blockquote><p><strong><span>说明：</span></strong><span> 使用该接口时，请设置</span><code>initValue</code><span>信号量的初始值。</span></p></blockquote><ul><li><span>销毁信号量：</span><code>T_GduReturnCode (*SemaphoreDestroy)(T_GduSemaHandle semaphore)</code></li><li><span>等待信号量：</span><code>T_GduReturnCode (*SemaphoreWait)(T_GduSemaHandle semaphore)</code></li></ul><blockquote><p><strong><span>说明：</span></strong><span> 等待信号量接口等待时间的</span><strong><span>最大值</span></strong><span>为</span><strong><span>32767 ms</span></strong><span>。</span></p></blockquote><ul><li><span>等待超时信号量：</span><code>T_GduReturnCode (*SemaphoreTimedWait)(T_GduSemaHandle semaphore, uint32_t waitTimeMs)</code></li><li><span>释放信号量：</span><code>T_GduReturnCode (*SemaphorePost)(T_GduSemaHandle semaphore)</code></li></ul><h4 id='时间接口'><span>时间接口</span></h4><ul><li><span>获取当前系统的时间（ms）：</span><code>T_GduReturnCode (*GetTimeMs)(uint32_t *ms)</code></li><li><span>获取当前系统的时间（us）：</span><code>T_GduReturnCode (*GetTimeUs)(uint64_t *us)</code></li></ul><h4 id='内存管理接口'><span>内存管理接口</span></h4><ul><li><span>申请内存：</span><code>void *(*Malloc)(uint32_t size)</code></li><li><span>释放内存：</span><code>void (*Free)(void *ptr)</code></li></ul><h2 id='实现跨平台移植'><span>实现跨平台移植</span></h2><h3 id='1-跨平台接口适配'><span>1. 跨平台接口适配</span></h3><figure><table><thead><tr><th><span>跨平台接口适配</span></th><th><span>适配方案</span></th><th>&nbsp;</th><th>&nbsp;</th></tr></thead><tbody><tr><td><span>Hal 层适配</span></td><td><span>串口</span></td><td><span>Linux</span></td><td><span>请根据硬件连接，配置对应的串口设备名称，如</span><code>ttyUSB0</code><span>, 并实现串口初始化、串口读数据和串口写数据的回调函数。详细实现方法请参见：/samples/sample_c/platform/linux/manifold2/hal/hal_uart.c</span></td></tr><tr><td><span>RTOS</span></td><td><span>请根据MCU 的型号配置对应的串口管脚，并实现串口初始化、串口读数据和串口写数据的回调函数。 详细实现方法请参见：samples/sample_c/platform/rtos_freertos/stm32f4_discovery/hal/hal_uart.c</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>网口</span></td><td><span>Linux</span></td><td><span>使用网口将第三方开发平台连接至GDU无人机后，需要实现并注册配置网络的回调函数，当系统初始化时，会自动完成负载网络参数的配置，配置完成后，可以使用网口相关的功能。 详细实现方法请参见：/samples/sample_c/platform/linux/manifold2/hal/hal_network.c</span></td><td>&nbsp;</td></tr><tr><td><span>RTOS</span></td><td><span>对于RTOS系统，可以通过注册配置网络参数的回调函数，获取到当前负载应配置的网络参数，根据实际需要告知其他子系统模块，完成网口相关的功能。 详细实现方法请参见：/samples/sample_c/platform/rtos_freertos/stm32f4_discovery/application/main.c</span></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><span>Osal 层适配</span></td><td><span>Linux</span></td><td><span>使用标准库 </span><code>pthread</code><span> 封装 </span><code>T_GduOsalHandler</code><span>中的线程函数、互斥锁、信号量以及时间接口等接口。详细实现方法请参见：samples/sample_c/platform/linux/common/osal/osal.c</span></td><td>&nbsp;</td></tr><tr><td><span>RTOS</span></td><td><span>使用 CMSIS 封装的</span><code>thread</code><span>接口，封装 </span><code>T_GduOsalHandler</code><span>中的线程函数、互斥锁、信号量以及时间接口等接口。 详细实现方法请参见：samples/sample_c/platform/rtos_freertos/common/osal/osal.c</span></td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><h3 id='2-注册跨平台适配接口'><span>2. 注册跨平台适配接口</span></h3><h4 id='结构体声明'><span>结构体声明</span></h4><p><span>请完整地填充 </span><code>T_GduHalUartHandler</code><span>、</span><code>T_GduHalNetworkHandler</code><span> 、</span><code>T_GduHalUsbBulkHandler</code><span>和 </span><code>T_GduOsalHandler</code><span> 中的接口内容，确保所注册的接口能够正常使用。</span></p><ul><li><span>T_GduHalUartHandler uartHandler</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduHalUartHandler</span> <span class="cm-variable">uartHandler</span> <span class="cm-operator">=</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">UartInit</span> <span class="cm-operator">=</span> <span class="cm-variable">HalUart_Init</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">UartDeInit</span> <span class="cm-operator">=</span> <span class="cm-variable">HalUart_DeInit</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">UartWriteData</span> <span class="cm-operator">=</span> <span class="cm-variable">HalUart_WriteData</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">UartReadData</span> <span class="cm-operator">=</span> <span class="cm-variable">HalUart_ReadData</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">UartGetStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">HalUart_GetStatus</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><ul><li><span>T_GduHalNetworkHandler networkHandler</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">T_GduHalNetworkHandler</span> <span class="cm-variable">networkHandler</span> <span class="cm-operator">=</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; .<span class="cm-variable">NetworkInit</span> <span class="cm-operator">=</span> <span class="cm-variable">HalNetWork_Init</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; .<span class="cm-variable">NetworkDeInit</span> <span class="cm-operator">=</span> <span class="cm-variable">HalNetWork_DeInit</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; .<span class="cm-variable">NetworkGetDeviceInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">HalNetWork_GetDeviceInfo</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li><span>T_GduOsalHandler osalHandler</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduOsalHandler</span> <span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">TaskCreate</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_TaskCreate</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">TaskDestroy</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_TaskDestroy</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">TaskSleepMs</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_TaskSleepMs</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">MutexCreate</span><span class="cm-operator">=</span> <span class="cm-variable">Osal_MutexCreate</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">MutexDestroy</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_MutexDestroy</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">MutexLock</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_MutexLock</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">MutexUnlock</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_MutexUnlock</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">SemaphoreCreate</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_SemaphoreCreate</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">SemaphoreDestroy</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_SemaphoreDestroy</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">SemaphoreWait</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_SemaphoreWait</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">SemaphoreTimedWait</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_SemaphoreTimedWait</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">SemaphorePost</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_SemaphorePost</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">Malloc</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_Malloc</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">Free</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_Free</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">GetTimeMs</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_GetTimeMs</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">GetTimeUs</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_GetTimeUs</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 415px;"></div><div class="CodeMirror-gutters" style="display: none; height: 415px;"></div></div></div></pre><p><span>请依次调用 </span><code>GduPlatform_RegOsalHandler()</code><span>、</span><code>GduPlatform_RegHalUartHandler()</code><span>函数注册基础Hal 层和Osal 层，若接口注册不成功，请根据返回码和日志信息排查错误问题。若使用依赖USB或者网卡的功能，还需要根据实际情况调用</span><code>GduPlatform_RegHalUsbBulkHandler</code><span>函数注册USB Bulk设备的相关方法或者调用</span><code>GduPlatform_RegHalNetworkHandler</code><span>函数注册网卡的相关方法。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 跨平台移植模块必须在其他PSDK 功能模块前被注册，若Platform 模块注册失败或未注册，开发者将无法使用基于PSDK 开发的负载设备。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_RegOsalHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">osalHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"register osal handler error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_RegHalUartHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">uartHandler</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"register hal uart handler error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#if (CONFIG_HARDWARE_CONNECTION == GDU_USE_UART_AND_USB_BULK_DEVICE)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_RegHalUsbBulkHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">usbBulkHandler</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"register hal usb bulk handler error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#elif (CONFIG_HARDWARE_CONNECTION == GDU_USE_UART_AND_NETWORK_DEVICE)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_RegHalNetworkHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">networkHandler</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"register hal network handler error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//Attention: if you want to use camera stream view function, please uncomment it.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_RegSocketHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">socketHandler</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"register osal socket handler error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#elif (CONFIG_HARDWARE_CONNECTION == GDU_USE_ONLY_UART)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/*!&lt; Attention: Only use uart hardware connection.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 806px;"></div><div class="CodeMirror-gutters" style="display: none; height: 806px;"></div></div></div></pre><h1 id='功能集合'><span>功能集合</span></h1><h2 id='基础功能'><span>基础功能</span></h2><h3 id='日志管理-2'><span>日志管理</span></h3><h2 id='概述-2'><span>概述</span></h2><p><span>PSDK 的日志管理功能支持通过如串口、终端或USB 等日志输出方法，输出Debug、Info、Warn和Error 四种类型的日志；使用能够显示日志颜色的终端工具，如Putty 等能够以不同的颜色显示不同类型的日志。</span>
<span>基于PSDK 开发的负载设备输出的日志结构如下：日志颜色起始符 + 系统时间 + 模块名称 + 日志等级标识 + 日志内容 + 日志颜色结束符</span></p><h2 id='基础概念-2'><span>基础概念</span></h2><h4 id='日志标识符'><span>日志标识符</span></h4><p><span>使用</span><strong><span>不支持</span></strong><span>显示日志颜色的调试工具查看日志时，会显示日志的颜色标识符。</span></p><ul><li><p><span>日志颜色：不同类型的日志，其标识颜色也不同。XShell、SecureCRT及Putty 等工具能够根据日志的等级，以不同的颜色显示不同类型的日志。</span></p></li><li><p><span>日志颜色起始标识符：</span></p><ul><li><span>黑色：</span><code>\033[30m</code><span>、红色：</span><code>\033[31m</code><span>、绿色：</span><code>\033[32m</code></li><li><span>黄色：</span><code>\033[33m</code><span>、蓝色：</span><code>\033[34m</code><span>、紫色：</span><code>\033[35m</code></li><li><span>青色：</span><code>\033[36m</code><span>、白色：</span><code>\033[37m</code></li></ul></li><li><p><span>日志颜色结束标识符：</span><code>\033[0m</code></p></li></ul><h4 id='日志信息'><span>日志信息</span></h4><ul><li><p><span>系统时间：负载设备上电时，负载设备的时间为负载设备系统的时间，当负载设备与无人机完成时间同步后，负载设备的时间将与无人机的时间同步(ms)。</span></p></li><li><p><span>模块名称：PSDK 模块的名称（该名称无法被修改），用户打印接口的模块名称为“user”。</span></p></li><li><p><span>日志内容：单条日志最多不超过500 个字节（bytes）。</span></p></li><li><p><span>日志等级：日志的等级从高到低为Debug、Info、Warn和Error，日志管理功能模块可打印不高于指定等级的所有日志。</span></p><p><span>表1. 日志等级说明</span></p><figure><table><thead><tr><th><span>日志等级</span></th><th><span>日志内容</span></th><th><span>输出接口</span></th><th><span>日志颜色</span></th></tr></thead><tbody><tr><td><span>Debug - 4</span></td><td><span>调试信息</span></td><td><span>USER_LOG_DEBUG</span></td><td><span>White</span></td></tr><tr><td><span>Info - 3</span></td><td><span>关键信息</span></td><td><span>USER_LOG_INFO</span></td><td><span>Green</span></td></tr><tr><td><span>Warn - 2</span></td><td><span>警告信息</span></td><td><span>USER_LOG_WARN</span></td><td><span>Yellow</span></td></tr><tr><td><span>Error - 1</span></td><td><span>系统错误</span></td><td><span>USER_LOG_ERROR</span></td><td><span>Red</span></td></tr></tbody></table></figure></li></ul><h2 id='使用日志管理功能'><span>使用日志管理功能</span></h2><p><span>使用PSDK 日志管理功能，需要先初始化日志打印接口，设置日志等级，通过注册日志打印函数，实现日志管理功能。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 本教程以“使用STM32 在RTOS 系统上通过串口打印日志信息”为例，介绍使用日志管理功能的方法和步骤。</span></p></blockquote><h5 id='1-初始化串口并注册日志输出方法'><span>1. 初始化串口并注册日志输出方法</span></h5><p><span>在RTOS 系统上使用PSDK 开发负载设备的日志管理功能时，建议使用串口打印日志信息。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduUser_PrintConsole</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>, <span class="cm-variable-3">uint16_t</span> <span class="cm-variable">dataLen</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">UART_Write</span>(<span class="cm-variable">GDU_CONSOLE_UART_NUM</span>, (<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span>) <span class="cm-variable">data</span>, <span class="cm-variable">dataLen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">UART_Init</span>(<span class="cm-variable">GDU_CONSOLE_UART_NUM</span>, <span class="cm-variable">GDU_CONSOLE_UART_BAUD</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><h5 id='2-注册日志打印接口'><span>2. 注册日志打印接口</span></h5><p><span>使用PSDK 的日志管理功能，需要初始化日志打印方法</span><code>printConsole</code><span>，设置所需打印的日志等级、是否启动颜色显示和该日志对应的打印方法，并通过</span><code>GduLogger_AddConsole()</code><span>注册到负载设备控制程序中。</span></p><blockquote><p><strong><span>注意：</span></strong><span> 使用PSDK 开发的负载设备最多支持同时使用</span><strong><span>8种</span></strong><span>日志打印方法。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduLoggerConsole</span> <span class="cm-variable">printConsole</span> <span class="cm-operator">=</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">func</span> <span class="cm-operator">=</span> <span class="cm-variable">GduUser_PrintConsole</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">consoleLevel</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_LOGGER_CONSOLE_LOG_LEVEL_INFO</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .<span class="cm-variable">isSupportColor</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLogger_AddConsole</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">printConsole</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"add printf console error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 253px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><h5 id='3-输出日志信息'><span>3. 输出日志信息</span></h5><p><span>调用日志打印函数输出日志信息，日志输出结果如 图1.日志信息 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">USER_LOG_ERROR("psdk log console test.");</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">USER_LOG_WARN("psdk log console test.");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">USER_LOG_INFO("psdk log console test.");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">USER_LOG_DEBUG("psdk log console test.");</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><blockquote><p><strong><span>说明：</span></strong><span> 日志的等级为Info，因此负载设备中类型为Info、Warn 及Error 的日志将被输出在终端上，类型为Debug 的日志将不会被打印出来。</span></p></blockquote><h2 id='日志查看'><span>日志查看</span></h2><ul><li><p><span>Linux：</span></p><ul><li><span>在Clion IDE 上使用 </span><a href='https://plugins.jetbrains.com/plugin/7125-grep-console/'><span>Grep Consoleopen in new window</span></a><span>可过滤负载设备的日志文档</span></li><li><span>使用grep命令：在终端中执行</span><code>./demo_linux_ubuntu | grep &#39;Info&#39;</code><span>过滤所需的日志信息，更多使用方法请使用</span><code>man grep</code><span>查询</span></li></ul></li><li><p><span>RTOS：使用串口查看工具如SecureCRT、XShell或Putty 等工具查看日志信息</span></p></li></ul><h3 id='信息管理-2'><span>信息管理</span></h3><h2 id='概述-3'><span>概述</span></h2><p><span>PSDK 的信息管理功能包含信息获取和消息订阅功能，基于PSDK 开发的负载设备具有信息获取功能，能够主动获取到无人机的型号、负载设备挂载的位置以及用户使用的移动端App 等信息，加载不同的配置文件，方便用户使用负载设备；具有消息订阅功能的负载设备，能够记录用户订阅的数据信息，方便用户实现更广泛的应用。</span></p><h2 id='基础概念-3'><span>基础概念</span></h2><h4 id='信息获取'><span>信息获取</span></h4><p><span>信息获取是指负载设备能够</span><strong><span>主动获取并记录</span></strong><span>无人机上如无人机型号、硬件平台类型和负载设备挂载位置等数据信息。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 将使用PSDK 开发的负载设备安装到无人机上，在开机初始化5s 后才能够获取到无人机正确的数据信息。</span></p></blockquote><p><span>使用PSDK 开发的负载设备在初始化后，即可获取到如下信息：</span></p><ul><li><span>基本信息：无人机型号、硬件平台类型和负载挂载位置</span></li><li><span>移动端App 信息：App 的系统语言和App 的屏幕类型</span></li></ul><h4 id='消息订阅'><span>消息订阅</span></h4><p><span>无人机上的各个部件根据无人机实际的飞行状况，会实时产生大量的数据信息并被无人机推送给其他模块，用户使用具有消息订阅功能的负载设备，能够指定所需订阅的数据信息。</span></p><h4 id='订阅流程'><span>订阅流程</span></h4><p><span>订阅数据项后，负载设备即可获得订阅的信息，具体流程如 图1.消息订阅 所示。</span></p><p><span>图1.消息订阅</span></p><p><img src="https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/fcf07426-70c9-4b7b-944c-4a8a394a6cf3.png" referrerpolicy="no-referrer" alt="img"></p><h4 id='订阅项'><span>订阅项</span></h4><p><span>使用PSDK 消息订阅功能可订阅的数据信息如 表1.无人机订阅项 所示。</span></p><p><span>表1.无人机订阅项</span></p><figure><table><thead><tr><th><span>数据类型</span></th><th><span>订阅项（Topic）</span></th><th><span>最大订阅频率（Hz）</span></th></tr></thead><tbody><tr><td><span>基础信息</span></td><td><span>速度</span></td><td><span>10</span></td></tr><tr><td>&nbsp;</td><td><span>融合海拔高度</span></td><td><span>10</span></td></tr><tr><td>&nbsp;</td><td><span>相对高度</span></td><td><span>10</span></td></tr><tr><td>&nbsp;</td><td><span>融合位置</span></td><td><span>10</span></td></tr><tr><td>&nbsp;</td><td><span>飞行状态</span></td><td><span>10</span></td></tr><tr><td>&nbsp;</td><td><span>电池信息</span></td><td><span>10</span></td></tr><tr><td><span>GPS 信息</span></td><td><span>GPS 信息</span></td><td><span>10</span></td></tr><tr><td>&nbsp;</td><td><span>GPS 时间</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>GPS 位置</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>GPS 速度</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>GPS 信息</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>GPS 信号等级</span></td><td><span>10</span></td></tr><tr><td><span>RTK 信息</span></td><td><span>RTK 信息</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>RTK 速度</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>RTK 航向角</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>RTK 位置属性</span></td><td><span>5</span></td></tr><tr><td>&nbsp;</td><td><span>RTK 航向角属性</span></td><td><span>5</span></td></tr></tbody></table></figure><h4 id='订阅规则'><span>订阅规则</span></h4><ul><li><span>消息订阅功能最多支持订阅</span><strong><span>3类频率</span></strong><span>，如最多支持订阅1Hz、5Hz、10Hz，3类频率，每个订阅项只能被订阅一次。</span></li><li><span>指定订阅频率时，任何参数的订阅频率不能小于或等于0 ，相同订阅频率的主题的数据长度总和须小于或等于242。</span></li></ul><h2 id='使用消息订阅功能'><span>使用消息订阅功能</span></h2><p><span>PSDK 支持通过注册回调和接口调用两种方式订阅无人机对外推送的数据信息：</span></p><ul><li><span>通过调用</span><code>GduFcSubscription_GetLatestValueOfTopic()</code><span>获取无人机最新产生的订阅项的数据信息及其对应的时间。</span></li><li><span>通过调用</span><code>GduFcSubscription_SubscribeTopic</code><span>接口指定订阅频率和订阅项，通过构造并注册回调函数，获取无人机最新产生的订阅项的数据信息及其对应的时间。</span></li></ul><h4 id='消息订阅功能模块初始化'><span>消息订阅功能模块初始化</span></h4><p><span>使用PSDK 开发的负载设备如需订阅无人机上的状态信息，需要先调用</span><code>GduFcSubscription_Init()</code><span>初始化消息订阅模块。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_Init</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"init data subscription module error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h4 id='通过构造回调函数获取无人机上的信息'><span>通过构造回调函数获取无人机上的信息</span></h4><ol start='' ><li><span>构造回调函数</span>
<span>通过构造回调函数接收无人机推送的信息。</span></li></ol><blockquote><p><strong><span>注意：</span></strong><span> 为避免出现内存踩踏事件，须将数据地址的类型强制转换为订阅项数据结构中的指针类型。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42432px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_FcSubscriptionReceiveQuaternionCallback</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>, <span class="cm-variable-3">uint16_t</span> <span class="cm-variable">dataSize</span>, <span class="cm-keyword">const</span> <span class="cm-variable">T_GduDataTimestamp</span> <span class="cm-operator">*</span><span class="cm-variable">timestamp</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduFcSubscriptionQuaternion</span> <span class="cm-operator">*</span><span class="cm-variable">quaternion</span> <span class="cm-operator">=</span> (<span class="cm-variable">T_GduFcSubscriptionQuaternion</span> <span class="cm-operator">*</span>) <span class="cm-variable">data</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gdu_f64_t</span> <span class="cm-variable">pitch</span>, <span class="cm-variable">yaw</span>, <span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_UTIL_UNUSED</span>(<span class="cm-variable">dataSize</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f64_t</span>) <span class="cm-variable">asinf</span>(<span class="cm-operator">-</span><span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q1</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q3</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q0</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span>) <span class="cm-operator">*</span> <span class="cm-number">57.3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">roll</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f64_t</span>) <span class="cm-variable">atan2f</span>(<span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q1</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q0</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q3</span>, <span class="cm-operator">-</span><span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span> <span class="cm-operator">-</span> <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q3</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q3</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-number">57.3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f64_t</span>) <span class="cm-variable">atan2f</span>(<span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q3</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q0</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q1</span>, <span class="cm-operator">-</span><span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q1</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q1</span> <span class="cm-operator">-</span> <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span> <span class="cm-operator">*</span> <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-number">57.3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_userFcSubscriptionDataShow</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"receive quaternion data."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"timestamp: millisecond %u microsecond %u."</span>, <span class="cm-variable">timestamp</span><span class="cm-operator">-&gt;</span><span class="cm-variable">millisecond</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">timestamp</span><span class="cm-operator">-&gt;</span><span class="cm-variable">microsecond</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"quaternion: %f %f %f %f.\r\n"</span>, <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q0</span>, <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q1</span>, <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q2</span>, <span class="cm-variable">quaternion</span><span class="cm-operator">-&gt;</span><span class="cm-variable">q3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"euler angles: pitch = %.2f roll = %.2f yaw = %.2f."</span>, <span class="cm-variable">pitch</span>, <span class="cm-variable">yaw</span>, <span class="cm-variable">roll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_WidgetLogAppend</span>(<span class="cm-string">"pitch = %.2f roll = %.2f yaw = %.2f."</span>, <span class="cm-variable">pitch</span>, <span class="cm-variable">yaw</span>, <span class="cm-variable">roll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 760px;"></div><div class="CodeMirror-gutters" style="display: none; height: 760px;"></div></div></div></pre><ol start='' ><li><span>注册回调函数</span>
<span>注册回调函数接收无人机产生并对外推送的数据信息，下述代码以1Hz 的频率订阅无人机“无人机飞行速度”和“无人机GPS坐标”，如 图2. 订阅结果（1） 所示。</span></li></ol><blockquote><p><strong><span>说明：</span></strong><span> 使用订阅功能订阅无人机上的数据信息时，订阅频率只能为”最大订阅频率“的约数。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.4248px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_SubscribeTopic</span>(<span class="cm-variable">GDU_FC_SUBSCRIPTION_TOPIC_VELOCITY</span>, <span class="cm-variable">GDU_DATA_SUBSCRIPTION_TOPIC_1_HZ</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Subscribe topic velocity error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_SubscribeTopic</span>(<span class="cm-variable">GDU_FC_SUBSCRIPTION_TOPIC_GPS_POSITION</span>, <span class="cm-variable">GDU_DATA_SUBSCRIPTION_TOPIC_1_HZ</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Subscribe topic gps position error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><h4 id='在线程函数中获取无人机上的信息'><span>在线程函数中获取无人机上的信息</span></h4><p><span>通过数据订阅线程函数获取无人机推送的信息并打印在终端上。下述代码以1Hz 的频率，订阅无人机最新产生的无人机飞行速度和无人机GPS坐标，以及该数据对应的时间，如 图3. 订阅结果（2） 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_GetLatestValueOfTopic</span>(<span class="cm-variable">GDU_FC_SUBSCRIPTION_TOPIC_VELOCITY</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span>) <span class="cm-operator">&amp;</span><span class="cm-variable">velocity</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduFcSubscriptionVelocity</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">&amp;</span><span class="cm-variable">timestamp</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get value of topic velocity error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"velocity: x = %f y = %f z = %f healthFlag = %d."</span>, <span class="cm-variable">velocity</span>.<span class="cm-variable">data</span>.<span class="cm-variable">x</span>, <span class="cm-variable">velocity</span>.<span class="cm-variable">data</span>.<span class="cm-variable">y</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">velocity</span>.<span class="cm-variable">data</span>.<span class="cm-variable">z</span>, <span class="cm-variable">velocity</span>.<span class="cm-variable">health</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_GetLatestValueOfTopic</span>(<span class="cm-variable">GDU_FC_SUBSCRIPTION_TOPIC_GPS_POSITION</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span>) <span class="cm-operator">&amp;</span><span class="cm-variable">gpsPosition</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduFcSubscriptionGpsPosition</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">&amp;</span><span class="cm-variable">timestamp</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get value of topic gps position error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"gps position: x = %d y = %d z = %d."</span>, <span class="cm-variable">gpsPosition</span>.<span class="cm-variable">x</span>, <span class="cm-variable">gpsPosition</span>.<span class="cm-variable">y</span>, <span class="cm-variable">gpsPosition</span>.<span class="cm-variable">z</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 507px;"></div><div class="CodeMirror-gutters" style="display: none; height: 507px;"></div></div></div></pre><h3 id='基础相机功能'><span>基础相机功能</span></h3><h2 id='概述-4'><span>概述</span></h2><p><span>为满足开发者对相机类负载设备的控制需求，PSDK 提供了</span><strong><span>控制</span></strong><span>相机执行拍照、录像、变焦及对焦等功能的接口，开发者需</span><strong><span>先实现</span></strong><span>相机拍照、录像以及测光等功能，再通过注册PSDK 相机类的接口，开发出功能完善的相机类负载设备；通过使用GDU Flight 以及基于MSDK 开发的移动端App，用户能够控制使用PSDK 开发的相机类负载设备执行指定的动作，获取负载设备中的信息和资源。</span></p><ul><li><span>基础功能：设置相机模式、拍照、录像、获取相机状态、SD 卡管理</span></li><li><span>高级功能：变焦、测光、对焦、视频流传输、回放下载、媒体库管理</span></li></ul><h2 id='基础概念介绍'><span>基础概念介绍</span></h2><h4 id='相机模式'><span>相机模式</span></h4><p><span>使用相机类功能前，需要先设置相机类负载设备的模式，不同的模式指定了相机类负载设备在执行某个任务时的工作逻辑。</span></p><ul><li><span>拍照：在该模式下，用户能够触发相机类负载设备拍摄照片。</span></li><li><span>录像：在该模式下，用户能够触发相机类负载设备录制影像。</span></li><li><span>视频回放：在该模式下，用户可以在移动端App 上播放或下载负载设备上的媒体文件。</span></li></ul><blockquote><p><strong><span>注意：</span></strong><span> 相机只能在一种模式中执行相应的操作，如在录像模式下</span><strong><span>仅能录像无法拍照</span></strong><span>。</span></p></blockquote><h4 id='拍照模式'><span>拍照模式</span></h4><p><span>使用PSDK 开发的相机类负载设备支持以下拍照模式：</span></p><ul><li><p><span>单拍：下发拍照命令后，相机拍摄单张照片。</span></p></li><li><p><span>连拍：下发拍照命令后，相机将连续拍摄指定数量的照片；当前支持2/3/5/7/10/14张连拍。</span></p></li><li><p><span>定时拍照：下发拍照命令时，相机按照指定的时间间隔，拍摄指定数量的照片。</span></p><ul><li><span>当前支持2/3/5/7/10秒时间间隔；</span></li><li><span>当前最大支持指定拍摄254 张照片，当拍照张数为255的时候，相机将不间断地拍摄照片。</span></li></ul></li></ul><h4 id='对焦模式'><span>对焦模式</span></h4><ul><li><span>自动对焦：Auto Focus，简称AF。在自动对焦模式下，相机类负载设备根据光电传感器获取的影像状态（漫发射），计算出对焦结果实现对焦功能，获取清晰的影像。</span></li><li><span>手动对焦：Manual Focus，简称MF。在手动对焦模式下，用户通过调节对焦环能够获得清晰的影像。</span></li></ul><h4 id='对焦点'><span>对焦点</span></h4><blockquote><p><strong><span>说明：</span></strong><span> 相机类负载设备的对焦点默认为传感器的中心位置。</span></p></blockquote><p><span>在控制相机类负载设备对焦，需要先设置对焦点，该对焦点的值为当前对焦点在相机画面中的横纵比系数，如 图1.对焦点 所示。</span></p><ul><li><span>在自动对焦模式下，开发者需要制定相机对焦的策略，设置对焦点（该对焦点也称“目标点”）。</span></li><li><span>在手动对焦模式下，用户可根据实际需要调整对焦点，获得所需的影像。</span></li></ul><h4 id='对焦环'><span>对焦环</span></h4><p><span>使用PSDK 开发的具有变焦环（光学变焦）的相机类负载设备通过调用</span><code>SetFocusRingValue</code><span>接口，设置对焦环的值：</span></p><ul><li><span>对焦环的值默认为0，表示无穷大和最接近的可能焦距。</span></li><li><span>对焦环的值不为0时，用户可根据相机的实际参数设置对焦环的值。</span></li></ul><h4 id='对焦助手'><span>对焦助手</span></h4><p><span>在AF 和 MF 模式下，对焦助手通过数字变焦的方式，能够放大用户指定的对焦区域，调用</span><code>SetFocusAssistantSettings</code><span>接口可设置对焦助手的状态，使用对焦助手，用户能够查看当前相机类负载设备的对焦质量。</span></p><h4 id='变焦模式-1'><span>变焦模式</span></h4><ul><li><span>光学变焦，通过改变光学镜头的结构实现变焦，光学变焦倍数越大，能拍摄的景物就越远，反之则近；</span></li><li><span>数码变焦，处理器使用特定的算法，通过改变传感器上每个像素的面积，实现数码变焦；</span></li><li><span>连续变焦，相机类负载设备控制镜头以指定的速度沿指定的方向运动，相机类负载设备先控制镜头执行光学变焦，当光学变焦达到上限后，相机类负载设备再执行数码变焦，以此实现连续变焦的功能。当前变焦倍数=当前光学变焦倍数 × 当前数码变焦倍数；</span></li><li><span>指点变焦，用户指定某一目标点后，基于PSDK 开发的相机类负载设备能够控制云台转动，使指定的目标处于画面中心，控制相机类负载设备按照预设的变焦倍数放大图像。</span></li></ul><h4 id='变焦方向-1'><span>变焦方向</span></h4><ul><li><span>ZOOM_IN ：变焦倍数减小，图像由远到近</span></li><li><span>ZOOM_OUT ：变焦倍数增大，图像由近到远</span></li></ul><h4 id='变焦速度-1'><span>变焦速度</span></h4><ul><li><span>SLOWEST：以最慢的速度变焦</span></li><li><span>SLOW：以较慢的速度变焦</span></li><li><span>MODERATELY_SLOW：以比正常速度稍慢的速度变焦</span></li><li><span>NORMAL：镜头以正常的速度变焦</span></li><li><span>MODERATELY_FAST：以比正常速度稍快的速度变焦</span></li><li><span>FAST：以较快的速度变焦</span></li><li><span>FASTEST：以最快的速度变焦</span></li></ul><h4 id='测光模式'><span>测光模式</span></h4><ul><li><span>平均测光，通过对画面整体亮度的分析，计算出画面的平均亮度的值，适合光照均匀的拍照场景；</span></li><li><span>中央重点测光，仅对图像传感器中间区域测光，适合拍摄框架式构图的照片；</span></li><li><span>点测光，对在以“指定的点”为中心的范围内测光，如 图1.点测光区域 所示，通过该方式能获得准确的测光结果，确保指定的对象能够曝光正确，适合光照复杂的拍摄场景。</span></li></ul><p><span>图像传感器被分为12列8行定义的96个点区域。行索引范围是[0,7]，其中值在图像上从上到下递增；列索引范围是[0，11]，其中值从左到右增加。</span></p><h4 id='变焦模式-2'><span>变焦模式</span></h4><ul><li><span>光学变焦，通过改变光学镜头的结构实现变焦，光学变焦倍数越大，能拍摄的景物就越远，反之则近；</span></li><li><span>数码变焦，处理器使用特定的算法，通过改变传感器上每个像素的面积，实现数码变焦；</span></li><li><span>连续变焦，相机类负载设备控制镜头以指定的速度沿指定的方向运动，相机类负载设备先控制镜头执行光学变焦，当光学变焦达到上限后，相机类负载设备再执行数码变焦，以此实现连续变焦的功能。当前变焦倍数=当前光学变焦倍数 × 当前数码变焦倍数；</span></li><li><span>指点变焦，用户指定某一目标点后，基于PSDK 开发的相机类负载设备能够控制云台转动，使指定的目标处于画面中心，控制相机类负载设备按照预设的变焦倍数放大图像。</span></li></ul><h4 id='变焦方向-2'><span>变焦方向</span></h4><ul><li><span>ZOOM_IN ：变焦倍数减小，图像由远到近</span></li><li><span>ZOOM_OUT ：变焦倍数增大，图像由近到远</span></li></ul><h4 id='变焦速度-2'><span>变焦速度</span></h4><ul><li><span>SLOWEST：以最慢的速度变焦</span></li><li><span>SLOW：以较慢的速度变焦</span></li><li><span>MODERATELY_SLOW：以比正常速度稍慢的速度变焦</span></li><li><span>NORMAL：镜头以正常的速度变焦</span></li><li><span>MODERATELY_FAST：以比正常速度稍快的速度变焦</span></li><li><span>FAST：以较快的速度变焦</span></li><li><span>FASTEST：以最快的速度变焦</span></li></ul><h4 id='媒体文件管理'><span>媒体文件管理</span></h4><p><span>使用PSDK 开发的相机类负载设备能够根据用户的指令，执行文件删除或下载等操作。</span></p><h4 id='媒体文件预览功能'><span>媒体文件预览功能</span></h4><p><span>使用PSDK 开发的相机类负载设备支持用户使用GDU Flight 或基于MSDK 开发的移动端App 预览负载设备中的媒体文件。</span></p><ul><li><p><span>静态预览：预览单个文件或文件列表</span></p><ul><li><p><span>缩略图，预览文件列表</span></p><ul><li><span>图像：负载设备按照文件的原始比例生成缩略图，请将预览图的宽度设置为100 像素</span></li><li><span>视频：截取视频某一帧的画面</span></li></ul></li><li><p><span>截屏图，预览单个文件</span></p><ul><li><span>图像：按原始比例，建议缩放图像成宽为600 像素的预览图</span></li><li><span>视频：截取视频某一帧的画面</span></li></ul></li><li><p><span>原始文件，如需获得相机类负载设备中原始的媒体文件，请使用下载功能获取指定的媒体文件。</span></p></li></ul></li><li><p><span>动态预览（视频预览)：播放、暂停、停止、跳转（快进、快退和进度拖动）</span></p><blockquote><p><strong><span>说明：</span></strong><span> 支持动态预览的文件格式：MP4、JPG、DNG 和MOV，编码格式请参见</span><a href='https://developer.gdu.com/doc/payload-sdk-tutorial/cn/model-instruction/payload-develop-criterion.html'><span>视频标准open in new window</span></a><span>。</span></p></blockquote></li></ul><h2 id='实现相机类基础功能'><span>实现相机类基础功能</span></h2><p><span>请开发者根据选用的</span><strong><span>开发平台</span></strong><span>以及行业应用实际的使用需求，按照PSDK 中的结构体</span><code>T_GduCameraCommonHandler</code><span>构造实现相机类负载设备设置相机模式、拍照和录像等功能的函数，将相机功能的函数注册到PSDK 中指定的接口后，用户通过使用GDU Flight 或基于MSDK 开发的移动端App 能够控制基于PSDK 开发的相机类负载设备执行相应的动作。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 获取负载设备系统当前的状态</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetSystemState</span> <span class="cm-operator">=</span> <span class="cm-variable">GetSystemState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置相机类负载设备模式的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetMode</span> <span class="cm-operator">=</span> <span class="cm-variable">SetMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetMode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_CameraGetMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现开始或停止录像的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">StartRecordVideo</span> <span class="cm-operator">=</span> <span class="cm-variable">StartRecordVideo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">StopRecordVideo</span> <span class="cm-operator">=</span> <span class="cm-variable">StopRecordVideo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现开始或停止拍照的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">StartShootPhoto</span> <span class="cm-operator">=</span> <span class="cm-variable">StartShootPhoto</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">StopShootPhoto</span> <span class="cm-operator">=</span> <span class="cm-variable">StopShootPhoto</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置相机类负载设备的拍照功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetShootPhotoMode</span> <span class="cm-operator">=</span> <span class="cm-variable">SetShootPhotoMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetShootPhotoMode</span> <span class="cm-operator">=</span> <span class="cm-variable">GetShootPhotoMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetPhotoBurstCount</span> <span class="cm-operator">=</span> <span class="cm-variable">SetPhotoBurstCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetPhotoBurstCount</span> <span class="cm-operator">=</span> <span class="cm-variable">GetPhotoBurstCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetPhotoTimeIntervalSettings</span> <span class="cm-operator">=</span> <span class="cm-variable">SetPhotoTimeIntervalSettings</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetPhotoTimeIntervalSettings</span> <span class="cm-operator">=</span> <span class="cm-variable">GetPhotoTimeIntervalSettings</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现SD 卡管理功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetSDCardState</span> <span class="cm-operator">=</span> <span class="cm-variable">GetSDCardState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">FormatSDCard</span> <span class="cm-operator">=</span> <span class="cm-variable">FormatSDCard</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><h2 id='基础功能初始化'><span>基础功能初始化</span></h2><p><span>使用PSDK 开发负载设备的相机功能时，必须要初始化相机模块并注册相机类的功能。</span></p><h4 id='相机类功能模块初始化'><span>相机类功能模块初始化</span></h4><p><span>在使用相机类功能前，必须先调用接口</span><code>GduPayloadCamera_Init</code><span>初始化相机类负载设备，确保相机类负载设备可正常工作。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_PsdkReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_Init</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"payload camera init error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><h4 id='注册相机类基础功能'><span>注册相机类基础功能</span></h4><p><span>开发者</span><strong><span>实现</span></strong><span>相机类负载设备设置相机模式、拍照和录像等功能后，需要通过</span><code>GduPayloadCamera_RegCommonHandler</code><span>注册相机类基础功能。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_RegCommonHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_commonHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera register common handler error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><h2 id='使用sd-卡管理功能'><span>使用SD 卡管理功能</span></h2><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>本教程以</span><strong><span>模拟</span></strong><span>SD 卡管理功能为例，介绍使用PSDK SD 卡管理功能的使用方法，如需开发具有SD 卡管理功能的负载设备，请调用负载设备系统的接口实现SD 卡管理功能。</span></li></ul></blockquote><h4 id='sd-卡模块初始化'><span>SD 卡模块初始化</span></h4><p><span>使用SD 卡管理功能，需要开发者先开发并注册操作SD 卡功能的函数，通过初始化SD 卡管理模块，获取SD 卡的状态信息。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">isI0nserted</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">totalSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">availableCaptureCount</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span> <span class="cm-operator">/</span> <span class="cm-variable">SDCARD_PER_PHOTO_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">availableRecordingTimeInSeconds</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span> <span class="cm-operator">/</span> <span class="cm-variable">SDCARD_PER_SECONDS_RECORD_SPACE_IN_MB</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><h4 id='获取sd-卡的当前状态'><span>获取SD 卡的当前状态</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>GetSDCardState</code><span>接口能够获取负载设备上SD 卡当前的状态，用户使用GDU Flight 以及基于MSDK 开发的APP 能够查看负载设备中SD 卡的状态信息。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 预估可拍照张数和可录像时长的功能。</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isRecording</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">currentVideoRecordingTimeInSeconds</span><span class="cm-operator">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">-</span> <span class="cm-variable">SDCARD_PER_SECONDS_RECORD_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">isFull</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 获取SD 卡的状态</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetSDCardState</span>(<span class="cm-variable">T_GduCameraSDCardState</span> <span class="cm-operator">*</span><span class="cm-variable">sdCardState</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-variable">sdCardState</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraSDCardState</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraSDCardState</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 737px;"></div><div class="CodeMirror-gutters" style="display: none; height: 737px;"></div></div></div></pre><h4 id='使用sd-卡格式化功能'><span>使用SD 卡格式化功能</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>FormatSDCard</code><span>接口能够控制负载设备执行SD 卡格式化，用户使用GDU Flight 以及基于MSDK 开发的APP 可获取负载设备中SD 卡的状态信息并控制负载设备执行SD 卡格式化功能，如 图1. SD 卡管理功能 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">FormatSDCard</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"format sdcard"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memset</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraSDCardState</span>, <span class="cm-number">0</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraSDCardState</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">isInserted</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">totalSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">availableCaptureCount</span> <span class="cm-operator">=</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span> <span class="cm-operator">/</span> <span class="cm-variable">SDCARD_PER_PHOTO_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">availableRecordingTimeInSeconds</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span> <span class="cm-operator">/</span> <span class="cm-variable">SDCARD_PER_SECONDS_RECORD_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 691px;"></div></div></div></pre><p>&nbsp;</p><h2 id='使用模式设置功能'><span>使用模式设置功能</span></h2><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetMode</code><span>和</span><code>GetMode</code><span>接口能够设置相机的模式，用户使用GDU Flight 能够切换相机类负载设备的工作模式，如 图2. 设置相机模式 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetSystemState</span>(<span class="cm-variable">T_GduCameraSystemState</span> <span class="cm-operator">*</span><span class="cm-variable">systemState</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">systemState</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetMode</span>(<span class="cm-variable">E_GduCameraMode</span> <span class="cm-variable">mode</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">cameraMode</span> <span class="cm-operator">=</span> <span class="cm-variable">mode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set camera mode:%d"</span>, <span class="cm-variable">mode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_CameraGetMode</span>(<span class="cm-variable">E_GduCameraMode</span> <span class="cm-operator">*</span><span class="cm-variable">mode</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">mode</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraState</span>.<span class="cm-variable">cameraMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1520px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1520px;"></div></div></div></pre><p>&nbsp;</p><h2 id='使用拍照功能'><span>使用拍照功能</span></h2><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>使用拍照功能前，用户需要在GDU Flight 或基于MSDK 开发的移动端App 上将相机类负载设备的工作模式设置为拍照模式。</span></li><li><span>使用PSDK 开发的负载设备在拍照时，会向GDU Flight 或基于MSDK 开发的移动端App 返回拍照状态（用于如触发移动端App 拍照声音等功能）。</span></li></ul></blockquote><h4 id='设置相机类负载设备的拍照模式'><span>设置相机类负载设备的拍照模式</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetShootPhotoMode</code><span>和</span><code>GetShootPhotoMode</code><span>接口能够设置并获取相机类负载设备的模式，用户使用GDU Flight 以及基于MSDK 开发的移动端App 可设置并获取相机类负载设备的拍照模式。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetShootPhotoMode</span>(<span class="cm-variable">E_GduCameraShootPhotoMode</span> <span class="cm-variable">mode</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">=</span> <span class="cm-variable">mode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set shoot photo mode:%d"</span>, <span class="cm-variable">mode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetShootPhotoMode</span>(<span class="cm-variable">E_GduCameraShootPhotoMode</span> <span class="cm-operator">*</span><span class="cm-variable">mode</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">mode</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraShootPhotoMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);<span class="cm-variable">\</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1013px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1013px;"></div></div></div></pre><h4 id='控制相机单拍'><span>控制相机单拍</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>StartShootPhoto</code><span>和</span><code>StopShootPhoto</code><span>接口控制相机类负载设备拍摄单张照片，用户使用GDU Flight 以及基于MSDK 开发的移动端App 可控制相机类负载设备拍摄单张照片。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StartShootPhoto</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"start shoot photo"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_SINGLE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_SINGLE_PHOTO</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_BURST</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_BURST_PHOTO</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_INTERVAL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_INTERVAL_PHOTO</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isShootingIntervalStart</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">currentPhotoShootingIntervalTimeInSeconds</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraPhotoTimeIntervalSettings</span>.<span class="cm-variable">timeIntervalSeconds</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StopShootPhoto</span>(<span class="cm-variable-3">void</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"stop shoot photo"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_PHOTO_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isShootingIntervalStart</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1336px;"></div></div></div></pre><h4 id='控制相机连拍'><span>控制相机连拍</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetPhotoBurstCount</code><span>和</span><code>GetPhotoBurstCount</code><span>接口控制相机类负载设备连拍，用户使用GDU Flight 以及基于MSDK 开发的移动端App 可设置相机类负载设备的连拍张数，控制相机类负载设备拍摄指定数量的照片。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetPhotoBurstCount</span>(<span class="cm-variable">E_GduCameraBurstCount</span> <span class="cm-variable">burstCount</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraBurstCount</span> <span class="cm-operator">=</span> <span class="cm-variable">burstCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set photo burst count:%d"</span>, <span class="cm-variable">burstCount</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetPhotoBurstCount</span>(<span class="cm-variable">E_GduCameraBurstCount</span> <span class="cm-operator">*</span><span class="cm-variable">burstCount</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">burstCount</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraBurstCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1013px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1013px;"></div></div></div></pre><h4 id='控制相机定时拍照'><span>控制相机定时拍照</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetPhotoTimeIntervalSettings</code><span>和</span><code>GetPhotoTimeIntervalSettings</code><span>接口控制相机类负载设备定时拍照，用户使用GDU Flight 以及基于MSDK 开发的移动端App 可设置相机类负载设备的拍照间隔，控制相机类负载设备按照指定的时间间隔拍摄照片。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.4248px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetPhotoTimeIntervalSettings</span>(<span class="cm-variable">T_GduCameraPhotoTimeIntervalSettings</span> <span class="cm-variable">settings</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraPhotoTimeIntervalSettings</span>.<span class="cm-variable">captureCount</span> <span class="cm-operator">=</span> <span class="cm-variable">settings</span>.<span class="cm-variable">captureCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraPhotoTimeIntervalSettings</span>.<span class="cm-variable">timeIntervalSeconds</span> <span class="cm-operator">=</span> <span class="cm-variable">settings</span>.<span class="cm-variable">timeIntervalSeconds</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set photo interval settings count:%d seconds:%d"</span>, <span class="cm-variable">settings</span>.<span class="cm-variable">captureCount</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">settings</span>.<span class="cm-variable">timeIntervalSeconds</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">currentPhotoShootingIntervalCount</span> <span class="cm-operator">=</span> <span class="cm-variable">settings</span>.<span class="cm-variable">captureCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetPhotoTimeIntervalSettings</span>(<span class="cm-variable">T_GduCameraPhotoTimeIntervalSettings</span> <span class="cm-operator">*</span><span class="cm-variable">settings</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-variable">settings</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraPhotoTimeIntervalSettings</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraPhotoTimeIntervalSettings</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1175px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1175px;"></div></div></div></pre><h4 id='拍照状态管理'><span>拍照状态管理</span></h4><p><span>在GDU Flight 以及使用MSDK 开发的移动端App 中点击“拍照”按钮后，使用PSDK 开发的相机类负载设备在自定义时间内（如0.5s）在线程中执行拍照、照片存储和内存状态更新的操作。</span></p><h5 id='确认拍照状态'><span>确认拍照状态</span></h5><p><span>使用PSDK 开发的相机类负载设备在执行完拍照动作后，需要获取负载设备的拍照状态。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">!=</span> <span class="cm-variable">PSDK_CAMERA_SHOOTING_PHOTO_IDLE</span> <span class="cm-operator">&amp;&amp;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">photoCnt</span><span class="cm-operator">++</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">TAKING_PHOTO_SPENT_TIME_MS_EMU</span> <span class="cm-operator">/</span> (<span class="cm-number">1000</span> <span class="cm-operator">/</span> <span class="cm-variable">PAYLOAD_CAMERA_EMU_TASK_FREQ</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">PSDK_CAMERA_SHOOTING_PHOTO_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">photoCnt</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><h5 id='存储照片'><span>存储照片</span></h5><p><span>相机类负载设备在执行完拍照后，使用PSDK 开发的相机类负载设备将相机拍摄的照片存储在</span><strong><span>相机类负载设备上</span></strong><span>的内存卡中。</span></p><ul><li><span>存储单拍模式下相机类负载设备拍摄的照片</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_SINGLE</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">-</span> <span class="cm-variable">SDCARD_PER_PHOTO_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_PHOTO_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><ul><li><span>存储连拍模式下相机类负载设备拍摄的照片</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_BURST</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">-</span> <span class="cm-variable">SDCARD_PER_PHOTO_SPACE_IN_MB</span> <span class="cm-operator">*</span> <span class="cm-variable">s_cameraBurstCount</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_PHOTO_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><ul><li><span>存储定时拍照模式下相机类负载设备拍摄的照片</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_INTERVAL</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">isStartIntervalPhotoAction</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_PHOTO_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">-</span> <span class="cm-variable">SDCARD_PER_PHOTO_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><h5 id='检查存储空间'><span>检查存储空间</span></h5><p><span>为确保相机类负载设备中的SD 卡在相机类负载设备执行拍照动作后，有充足的存储空间存储照片或视频，建议在使用PSDK 开发的相机类负载设备中添加检查SD 卡存储空间的功能。</span></p><ul><li><span>检查相机类负载设备执行单拍和连拍后SD 卡剩余的存储空间。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">isFull</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><ul><li><span>检查相机类负载设备执行定时拍照后SD 卡剩余的存储空间</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraShootPhotoMode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_SHOOT_PHOTO_MODE_INTERVAL</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">isStartIntervalPhotoAction</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isStoring</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">shootingState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_SHOOTING_PHOTO_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">-</span> <span class="cm-variable">SDCARD_PER_PHOTO_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p><span>使用遥控器可以控制相机类负载设备执行拍照动作</span></p><p><span>在单拍模式下，可执行拍照动作。</span></p><p><span>在连拍模式下，设置相机类负载设备的连拍张数后，相机类负载设备即可执行连拍动作。</span></p><p><span>在定时拍照模式下，设置相机类负载设备拍照的间隔时间，相机类负载设备可执行定时拍照动作。</span></p><p>&nbsp;</p><h2 id='使用录像功能'><span>使用录像功能</span></h2><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>相机类负载设备在录像的过程中无法拍照和测光；</span></li><li><span>开发者可根据用户的使用需要，设置相机类负载设备录像时如ISO、曝光以及对焦等参数的默认值；</span></li><li><span>使用相机类负载设备的录像功能前，用户需要在GDU Flight 或基于MSDK 开发的移动端App 上将相机类负载设备的模式设置为录像模式。</span></li></ul></blockquote><h4 id='控制相机录像'><span>控制相机录像</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>StartRecordVideo</code><span>和</span><code>StopRecordVideo</code><span>接口控制相机类负载设备录像，用户使用GDU Flight 以及基于MSDK 开发的移动端App 可控制相机类负载设备录像。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StartRecordVideo</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isRecording</span> <span class="cm-operator">!=</span> <span class="cm-atom">false</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera is already in recording state"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_NONSUPPORT_IN_CURRENT_STATE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isRecording</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"start record video"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StopRecordVideo</span>(<span class="cm-variable-3">void</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isRecording</span> <span class="cm-operator">!=</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera is not in recording state"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_NONSUPPORT_IN_CURRENT_STATE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isRecording</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">currentVideoRecordingTimeInSeconds</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"stop record video"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1428px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1428px;"></div></div></div></pre><h4 id='录像状态更新'><span>录像状态更新</span></h4><p><span>使用PSDK 开发的相机类负载设备控制程序，默认以10Hz 的频率更新相机的状态。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 相机开始录像后，GDU Flight 及基于MSDK 开发的移动端App 会显示当前正在录像的时间，相机停止录像时，该时间将归0。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">isRecording</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraState</span>.<span class="cm-variable">currentVideoRecordingTimeInSeconds</span><span class="cm-operator">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">-</span> <span class="cm-variable">SDCARD_PER_SECONDS_RECORD_SPACE_IN_MB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">SDCARD_TOTAL_SPACE_IN_MB</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">remainSpaceInMB</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraSDCardState</span>.<span class="cm-variable">isFull</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetSystemState</span>(<span class="cm-variable">T_GduCameraSystemState</span> <span class="cm-operator">*</span><span class="cm-variable">systemState</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">systemState</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 714px;"></div><div class="CodeMirror-gutters" style="display: none; height: 714px;"></div></div></div></pre><p><span>在GDU Flight 或基于MSDK 开发的移动端App 上向负载设备发送录像指令后（也可通过遥控器向负载设备发送录像指令），相机类负载设备根据用户发送的指令控制负载设备录像，如 图7.相机录像 所示。</span></p><h2 id='实现对焦功能'><span>实现对焦功能</span></h2><p><span>请开发者根据选用的</span><strong><span>开发平台</span></strong><span>以及行业应用实际的使用需求，按照PSDK 中的结构体</span><code>T_GduCameraFocusHandler</code><span>构造实现相机类负载设备对焦功能的函数，将对焦功能的函数注册到PSDK 中指定的接口后，用户通过使用GDU Flight 或基于MSDK 开发的移动端App 能够控制基于PSDK 开发的相机类负载设备对焦。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置对焦模式的功能</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">SetFocusMode</span> <span class="cm-operator">=</span> <span class="cm-variable">SetFocusMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">GetFocusMode</span> <span class="cm-operator">=</span> <span class="cm-variable">GetFocusMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置对焦点的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">SetFocusTarget</span> <span class="cm-operator">=</span> <span class="cm-variable">SetFocusTarget</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">GetFocusTarget</span> <span class="cm-operator">=</span> <span class="cm-variable">GetFocusTarget</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置对焦助手的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">SetFocusAssistantSettings</span> <span class="cm-operator">=</span> <span class="cm-variable">SetFocusAssistantSettings</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">GetFocusAssistantSettings</span> <span class="cm-operator">=</span> <span class="cm-variable">GetFocusAssistantSettings</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置对焦环的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">SetFocusRingValue</span> <span class="cm-operator">=</span> <span class="cm-variable">SetFocusRingValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">GetFocusRingValue</span> <span class="cm-operator">=</span> <span class="cm-variable">GetFocusRingValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_focusHandler</span>.<span class="cm-variable">GetFocusRingValueUpperBound</span> <span class="cm-operator">=</span> <span class="cm-variable">GetFocusRingValueUpperBound</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><h2 id='使用对焦功能'><span>使用对焦功能</span></h2><h4 id='注册对焦功能'><span>注册对焦功能</span></h4><p><span>开发者实现相机类负载设备的对焦功能后，需要通过</span><code>GduPayloadCamera_RegFocusHandler</code><span>注册对焦功能，方便用户通过使用GDU Flight 以及基于MSDK 开发的移动端App 控制相机类负载设备对焦。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_RegFocusHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_focusHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera register adjustable focal point handler error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><h4 id='设置对焦模式'><span>设置对焦模式</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetFocusMode</code><span>和</span><code>GetFocusMode</code><span>接口能够设置相机类负载设备的对焦模式，用户使用GDU Flight 能够切换相机类负载设备的对焦模式。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetFocusMode</span>(<span class="cm-variable">E_GduCameraFocusMode</span> <span class="cm-variable">mode</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set focus mode:%d"</span>, <span class="cm-variable">mode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraFocusMode</span> <span class="cm-operator">=</span> <span class="cm-variable">mode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetFocusMode</span>(<span class="cm-variable">E_GduCameraFocusMode</span> <span class="cm-operator">*</span><span class="cm-variable">mode</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">mode</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraFocusMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><h4 id='设置对焦点'><span>设置对焦点</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetFocusTarget</code><span>和</span><code>GetFocusTarget</code><span>接口能够设置相机类负载设备的对焦点，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够设置或获取相机类负载设备的对焦点。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetFocusTarget</span>(<span class="cm-variable">T_GduCameraPointInScreen</span> <span class="cm-variable">target</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set focus target x:%.2f y:%.2f"</span>, <span class="cm-variable">target</span>.<span class="cm-variable">focusX</span>, <span class="cm-variable">target</span>.<span class="cm-variable">focusY</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraFocusTarget</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">target</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraPointInScreen</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetFocusTarget</span>(<span class="cm-variable">T_GduCameraPointInScreen</span> <span class="cm-operator">*</span><span class="cm-variable">target</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-variable">target</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraFocusTarget</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraPointInScreen</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><h4 id='设置对焦环'><span>设置对焦环</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetFocusRingValue</code><span>、</span><code>GetFocusRingValueUpperBound</code><span>和</span><code>GetFocusRingValueUpperBound</code><span>接口能够设置相机类负载设备对焦环的值，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够设置或获取相机类负载设备对焦环的当前的值和最大值。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetFocusRingValue</span>(<span class="cm-variable-3">uint32_t</span> <span class="cm-variable">value</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set focus ring value:%d"</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraFocusRingValue</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetFocusRingValue</span>(<span class="cm-variable-3">uint32_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraFocusRingValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetFocusRingValueUpperBound</span>(<span class="cm-variable-3">uint32_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">value</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">FOCUS_MAX_RINGVALUE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><h4 id='使用对焦助手'><span>使用对焦助手</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetFocusAssistantSettings</code><span>和</span><code>GetFocusAssistantSettings</code><span>接口能够设置相机类负载设备对焦环的值，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够设置或获取相机类负载设备对焦助手的状态。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.4248px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetFocusAssistantSettings</span>(<span class="cm-variable">T_GduCameraFocusAssistantSettings</span> <span class="cm-variable">settings</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set focus assistant setting MF:%d AF:%d"</span>, <span class="cm-variable">settings</span>.<span class="cm-variable">isEnabledMF</span>, <span class="cm-variable">settings</span>.<span class="cm-variable">isEnabledAF</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraFocusAssistantSettings</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">settings</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraFocusAssistantSettings</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetFocusAssistantSettings</span>(<span class="cm-variable">T_GduCameraFocusAssistantSettings</span> <span class="cm-operator">*</span><span class="cm-variable">settings</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-variable">settings</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraFocusAssistantSettings</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraFocusAssistantSettings</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 438px;"></div><div class="CodeMirror-gutters" style="display: none; height: 438px;"></div></div></div></pre><p><span>实现相机类负载设备的对焦功能后，在自动对焦模式下，相机类负载设备需要设置对焦点 ；在手动对焦模式下，用户可根据实际需要调整对焦点。</span></p><p>&nbsp;</p><h2 id='实现测光功能'><span>实现测光功能</span></h2><p><span>请开发者根据选用的</span><strong><span>开发平台</span></strong><span>以及行业应用实际的使用需求，按照PSDK 中的结构体</span><code>T_GduCameraExposureMeteringHandler</code><span>构造实现相机类负载设备测光功能的函数，将测光功能的函数注册到PSDK 中指定的接口后，用户通过使用GDU Flight 或基于MSDK 开发的移动端App 能够控制相机类负载设备测光。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现设置测光模式的功能</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_exposureMeteringHandler</span>.<span class="cm-variable">SetMeteringMode</span> <span class="cm-operator">=</span> <span class="cm-variable">SetMeteringMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_exposureMeteringHandler</span>.<span class="cm-variable">GetMeteringMode</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMeteringMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现控制负载设备测光的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_exposureMeteringHandler</span>.<span class="cm-variable">SetSpotMeteringTarget</span> <span class="cm-operator">=</span> <span class="cm-variable">SetSpotMeteringTarget</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_exposureMeteringHandler</span>.<span class="cm-variable">GetSpotMeteringTarget</span> <span class="cm-operator">=</span> <span class="cm-variable">GetSpotMeteringTarget</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><h2 id='使用测光功能'><span>使用测光功能</span></h2><h4 id='注册测光功能'><span>注册测光功能</span></h4><p><span>开发者实现相机类负载设备的测光功能后，需要通过</span><code>PsdkPayloadCamera_RegExposureMeteringHandler</code><span>注册测光功能；调用指定的接口后，用户通过使用GDU Flight 以及基于MSDK 开发的移动端App 即可控制相机类负载设备测光，如 图2. 测光功能</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_RegExposureMeteringHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_exposureMeteringHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera register exposure metering handler error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><h4 id='设置测光模式'><span>设置测光模式</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetMeteringMode</code><span>和</span><code>GetMeteringMode</code><span>接口能够设置或获取相机类负载设备的测光模式，用户使用GDU Flight 以及基于MSDK 开发的APP 能够查看负载设备的测光模式，如 图3. 指点测光 和 图4. 中央重点测光 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetMeteringMode</span>(<span class="cm-variable">E_GduCameraMeteringMode</span> <span class="cm-variable">mode</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set metering mode:%d"</span>, <span class="cm-variable">mode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraMeteringMode</span> <span class="cm-operator">=</span> <span class="cm-variable">mode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMeteringMode</span>(<span class="cm-variable">E_GduCameraMeteringMode</span> <span class="cm-operator">*</span><span class="cm-variable">mode</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">mode</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraMeteringMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><h4 id='设置测光对象'><span>[设置测光对象</span></h4><p><span>相机类负载设备在调用</span><code>SetSpotMeteringTarget</code><span>和</span><code>GetSpotMeteringTarget</code><span>接口后，使用GDU Flight 以及基于MSDK 开发的移动端App 可设置或获取相机类负载设备的测光对象。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetSpotMeteringTarget</span>(<span class="cm-variable">T_GduCameraSpotMeteringTarget</span> <span class="cm-variable">target</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set spot metering area col:%d row:%d"</span>, <span class="cm-variable">target</span>.<span class="cm-variable">col</span>, <span class="cm-variable">target</span>.<span class="cm-variable">row</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraSpotMeteringTarget</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">target</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraSpotMeteringTarget</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetSpotMeteringTarget</span>(<span class="cm-variable">T_GduCameraSpotMeteringTarget</span> <span class="cm-operator">*</span><span class="cm-variable">target</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-variable">target</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_cameraSpotMeteringTarget</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduCameraSpotMeteringTarget</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><p>&nbsp;</p><h2 id='实现变焦功能'><span>实现变焦功能</span></h2><p><span>请开发者根据选用的</span><strong><span>开发平台</span></strong><span>以及行业应用实际的使用需求，按照PSDK 中的结构体</span><code>T_GduCameraTapZoomHandler</code><span>构造实现相机类负载设备变焦功能的函数，将变焦功能的函数注册到PSDK 中指定的接口后，用户通过使用GDU Flight 或基于MSDK 开发的移动端App 能够控制相机类负载设备变焦。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现控制负载设备执行数码变焦的功能</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_digitalZoomHandler</span>.<span class="cm-variable">SetDigitalZoomFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">SetDigitalZoomFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_digitalZoomHandler</span>.<span class="cm-variable">GetDigitalZoomFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">GetDigitalZoomFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现控制负载设备执行光学变焦的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_opticalZoomHandler</span>.<span class="cm-variable">SetOpticalZoomFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">SetOpticalZoomFocalLength</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_opticalZoomHandler</span>.<span class="cm-variable">GetOpticalZoomFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">GetOpticalZoomFocalLength</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_opticalZoomHandler</span>.<span class="cm-variable">GetOpticalZoomFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">GetOpticalZoomFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_opticalZoomHandler</span>.<span class="cm-variable">GetOpticalZoomSpec</span> <span class="cm-operator">=</span> <span class="cm-variable">GetOpticalZoomSpec</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_opticalZoomHandler</span>.<span class="cm-variable">StartContinuousOpticalZoom</span> <span class="cm-operator">=</span> <span class="cm-variable">StartContinuousOpticalZoom</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_opticalZoomHandler</span>.<span class="cm-variable">StopContinuousOpticalZoom</span> <span class="cm-operator">=</span> <span class="cm-variable">StopContinuousOpticalZoom</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现控制负载设备执行指点变焦的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomHandler</span>.<span class="cm-variable">GetTapZoomState</span> <span class="cm-operator">=</span> <span class="cm-variable">GetTapZoomState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomHandler</span>.<span class="cm-variable">SetTapZoomEnabled</span> <span class="cm-operator">=</span> <span class="cm-variable">SetTapZoomEnabled</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomHandler</span>.<span class="cm-variable">GetTapZoomEnabled</span> <span class="cm-operator">=</span> <span class="cm-variable">GetTapZoomEnabled</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomHandler</span>.<span class="cm-variable">SetTapZoomMultiplier</span> <span class="cm-operator">=</span> <span class="cm-variable">SetTapZoomMultiplier</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomHandler</span>.<span class="cm-variable">GetTapZoomMultiplier</span> <span class="cm-operator">=</span> <span class="cm-variable">GetTapZoomMultiplier</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomHandler</span>.<span class="cm-variable">TapZoomAtTarget</span> <span class="cm-operator">=</span> <span class="cm-variable">TapZoomAtTarget</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 392px;"></div><div class="CodeMirror-gutters" style="display: none; height: 392px;"></div></div></div></pre><h2 id='使用变焦功能'><span>使用变焦功能</span></h2><h4 id='注册变焦功能'><span>注册变焦功能</span></h4><p><span>开发者实现相机类负载设备的变焦功能后，需要通过注册接口</span><strong><span>注册</span></strong><span>各个变焦功能的函数；基于PSDK 开发的负载设备通过调用指定的接口，即可控制相机类负载设备执行变焦，方便用户通过使用GDU Flight 以及基于MSDK 开发的移动端App 控制相机类负载设备变焦。</span></p><ul><li><span>注册数码变焦功能</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_RegDigitalZoomHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_digitalZoomHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera register digital zoom handler error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li><span>注册光学变焦功能</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_RegOpticalZoomHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_opticalZoomHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera register optical zoom handler error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li><span>注册指点变焦功能</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_RegTapZoomHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_tapZoomHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"camera register tap zoom handler error:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h4 id='使用数码变焦功能'><span>使用数码变焦功能</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetDigitalZoomFactor</code><span>和</span><code>GetDigitalZoomFactor</code><span>接口能够控制负载设备执行数码变焦，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够控制相机类负载设备的执行数码变焦，同时获取负载设备数码变焦的系数。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetDigitalZoomFactor</span>(<span class="cm-variable">gdu_f32_t</span> <span class="cm-variable">factor</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set digital zoom factor:%.2f"</span>, <span class="cm-variable">factor</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraDigitalZoomFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">factor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_CameraGetDigitalZoomFactor</span>(<span class="cm-variable">gdu_f32_t</span> <span class="cm-operator">*</span><span class="cm-variable">factor</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">factor</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraDigitalZoomFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1013px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1013px;"></div></div></div></pre><h4 id='使用光学变焦功能'><span>使用光学变焦功能</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>SetOpticalZoomFocalLength</code><span>和</span><code>GetOpticalZoomFocalLength</code><span>接口能够控制负载设备执行光学变焦，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够控制相机类负载设备执行光学变焦，同时获取负载设备光学变焦的系数。</span></p><ul><li><span>设置光学变焦相机的焦距</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="C" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetOpticalZoomFocalLength</span>(<span class="cm-variable-3">uint32_t</span> <span class="cm-variable">focalLength</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set optical zoom focal length:%d"</span>, <span class="cm-variable">focalLength</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_isOpticalZoomReachLimit</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraDigitalZoomFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_DIGITAL_BASE_FACTOR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraOpticalZoomFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MIN_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_CameraGetOpticalZoomFactor</span>(<span class="cm-variable">gdu_f32_t</span> <span class="cm-operator">*</span><span class="cm-variable">factor</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//Formula:factor = currentFocalLength / minFocalLength</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">factor</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">s_cameraOpticalZoomFocalLength</span> <span class="cm-operator">/</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MIN_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1082px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1082px;"></div></div></div></pre><ul><li><span>获取相机类负载设备的变焦系数</span>
<span>获取相机类负载设备当前的光学焦距后，根据变焦系数的计算公式，能够计算相机类负载设备当前的变焦系数（变焦系数 = 当前焦距 ÷ 最短焦距）。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_CameraGetOpticalZoomFactor</span>(<span class="cm-variable">gdu_f32_t</span> <span class="cm-operator">*</span><span class="cm-variable">factor</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//Formula:factor = currentFocalLength / minFocalLength</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">factor</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">s_cameraOpticalZoomFocalLength</span> <span class="cm-operator">/</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MIN_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 507px;"></div><div class="CodeMirror-gutters" style="display: none; height: 507px;"></div></div></div></pre><ul><li><span>获取光学变焦的范围</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetOpticalZoomSpec</span>(<span class="cm-variable">T_GduCameraOpticalZoomSpec</span> <span class="cm-operator">*</span><span class="cm-variable">spec</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">spec</span><span class="cm-operator">-&gt;</span><span class="cm-variable">maxFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MAX_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">spec</span><span class="cm-operator">-&gt;</span><span class="cm-variable">minFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MIN_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">spec</span><span class="cm-operator">-&gt;</span><span class="cm-variable">focalLengthStep</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_LENGTH_STEP</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p>&nbsp;</p><h4 id='使用连续变焦功能'><span>使用连续变焦功能</span></h4><p><span>基于PSDK 开发的负载设备控制程序调用</span><code>StartContinuousOpticalZoom</code><span>和</span><code>StopContinuousOpticalZoom</code><span>接口能够控制负载设备开始或停止执行连续变焦，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够控制相机类负载设备执行连续变焦。</span></p><ul><li><span>控制相机类负载设备开始变焦</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.4248px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StartContinuousOpticalZoom</span>(<span class="cm-variable">E_GduCameraZoomDirection</span> <span class="cm-variable">direction</span>, <span class="cm-variable">E_GduCameraZoomSpeed</span> <span class="cm-variable">speed</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"start continuous optical zoom direction:%d speed:%d"</span>, <span class="cm-variable">direction</span>, <span class="cm-variable">speed</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_isStartContinuousOpticalZoom</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraZoomDirection</span> <span class="cm-operator">=</span> <span class="cm-variable">direction</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraZoomSpeed</span> <span class="cm-operator">=</span> <span class="cm-variable">speed</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 599px;"></div><div class="CodeMirror-gutters" style="display: none; height: 599px;"></div></div></div></pre><ul><li><span>控制相机类负载设备停止变焦</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StopContinuousOpticalZoom</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"stop continuous optical zoom"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_isStartContinuousOpticalZoom</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraZoomDirection</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_ZOOM_DIRECTION_OUT</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraZoomSpeed</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_ZOOM_SPEED_NORMAL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 553px;"></div><div class="CodeMirror-gutters" style="display: none; height: 553px;"></div></div></div></pre><ul><li><span>控制相机持续变焦</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_isStartContinuousOpticalZoom</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">s_cameraDigitalZoomFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">int32_t</span>) <span class="cm-variable">s_cameraOpticalZoomFocalLength</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_isOpticalZoomReachLimit</span> <span class="cm-operator">==</span> <span class="cm-atom">false</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraZoomDirection</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_ZOOM_DIRECTION_IN</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">+=</span> ((<span class="cm-variable-3">int</span>) <span class="cm-variable">s_cameraZoomSpeed</span> <span class="cm-operator">-</span> <span class="cm-variable">GDU_CAMERA_ZOOM_SPEED_SLOWEST</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_LENGTH_CTRL_STEP</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraZoomDirection</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_ZOOM_DIRECTION_OUT</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">-=</span> ((<span class="cm-variable-3">int</span>) <span class="cm-variable">s_cameraZoomSpeed</span> <span class="cm-operator">-</span> <span class="cm-variable">GDU_CAMERA_ZOOM_SPEED_SLOWEST</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_LENGTH_CTRL_STEP</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MAX_LENGTH</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_isOpticalZoomReachLimit</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MAX_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MIN_LENGTH</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempFocalLength</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_OPTICAL_FOCAL_MIN_LENGTH</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraZoomDirection</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_ZOOM_DIRECTION_IN</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">+=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">ZOOM_DIGITAL_STEP_FACTOR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_cameraZoomDirection</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_CAMERA_ZOOM_DIRECTION_OUT</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">-=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">ZOOM_DIGITAL_STEP_FACTOR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">&gt;</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">ZOOM_DIGITAL_MAX_FACTOR</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">ZOOM_DIGITAL_MAX_FACTOR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">&lt;</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">ZOOM_DIGITAL_BASE_FACTOR</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_isOpticalZoomReachLimit</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tempDigitalFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">ZOOM_DIGITAL_BASE_FACTOR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraOpticalZoomFocalLength</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">uint16_t</span>) <span class="cm-variable">tempFocalLength</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_cameraDigitalZoomFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">tempDigitalFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 898px;"></div><div class="CodeMirror-gutters" style="display: none; height: 898px;"></div></div></div></pre><p><span>持续按住变焦按钮可改变变焦倍数，如 图1.连续变焦 所示。</span></p><ul><li><p><span>T : 放大焦距（放大变焦倍数）</span></p></li><li><p><span>W : 缩小焦距（缩小变焦倍数）</span></p></li><li><p><span>R : 还原相机的焦距</span></p><blockquote><p><strong><span>说明：</span></strong><span> 根据实际的使用需要，可设置相机类负载设备默认的变焦倍数，当前为1.0。</span></p></blockquote></li></ul><p>&nbsp;</p><h4 id='实现指点变焦功能'><span>实现指点变焦功能</span></h4><p><span>当用户开始使用“指点变焦”功能后，使用PSDK 开发的相机类负载设备将根据用户指定的目标点位置以及当前的焦距，先控制云台旋转，将目标对象置于画面中心，再控制负载设备变焦。</span></p><h5 id='通过注册回调函数的方式实现指点变焦功能'><span>通过注册回调函数的方式实现指点变焦功能</span></h5><ul><li><span>设置指点变焦的变焦系数</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetTapZoomMultiplier</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable">multiplier</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set tap zoom multiplier: %d."</span>, <span class="cm-variable">multiplier</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomMultiplier</span> <span class="cm-operator">=</span> <span class="cm-variable">multiplier</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetTapZoomMultiplier</span>(<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">multiplier</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">multiplier</span> <span class="cm-operator">=</span> <span class="cm-variable">s_tapZoomMultiplier</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><ul><li><span>获取指点变焦的对象</span>
<span>使用PSDK 开发的相机类负载设备通过</span><code>TapZoomAtTarget</code><span>接口获取用户在移动端App 中指定的变焦对象，在确认指点变焦功能开启后，根据目标点位置和混合焦距，计算云台转动角度，控制相机转动。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">TapZoomAtTarget</span>(<span class="cm-variable">T_GduCameraPointInScreen</span> <span class="cm-variable">target</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">E_GduGimbalRotationMode</span> <span class="cm-variable">rotationMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduGimbalRotationProperty</span> <span class="cm-variable">rotationProperty</span> <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduAttitude3d</span> <span class="cm-variable">rotationValue</span> <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">float</span> <span class="cm-variable">hybridFocalLength</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-comment">// unit: 0.1mm</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"tap zoom at target: x %f, y %f."</span>, <span class="cm-variable">target</span>.<span class="cm-variable">focusX</span>, <span class="cm-variable">target</span>.<span class="cm-variable">focusY</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_isTapZoomEnabled</span> <span class="cm-operator">!=</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"tap zoom is not enabled."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_isTapZooming</span> <span class="cm-operator">||</span> <span class="cm-variable">s_isStartTapZoom</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"The last tap zoom process is not over."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_NONSUPPORT_IN_CURRENT_STATE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rotationMode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_GIMBAL_ROTATION_MODE_RELATIVE_ANGLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">relativeAngleRotation</span>.<span class="cm-variable">actionTime</span> <span class="cm-operator">=</span> <span class="cm-variable">TAP_ZOOM_DURATION</span> <span class="cm-operator">/</span> <span class="cm-number">10</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/* Calculation formula: rotation angle = arctan((coordinate of target in sensor - coordinate of center point in</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* sensor) / hybrid focal length). Here, suppose that images of all pixels of sensor are displayed in screen,</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* and that center of the image sensor coincides with center of rotation of the gimbal, and that optical axis of</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* camera coincides with x-axis of gimbal. */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">hybridFocalLength</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">s_cameraOpticalZoomFocalLength</span> <span class="cm-operator">*</span> <span class="cm-variable">s_cameraDigitalZoomFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_zoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">int32_t</span>) (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">atan2f</span>((<span class="cm-variable">target</span>.<span class="cm-variable">focusY</span> <span class="cm-operator">-</span> <span class="cm-variable">CENTER_POINT_IN_SCREEN_Y_VALUE</span>) <span class="cm-operator">*</span> <span class="cm-variable">IMAGE_SENSOR_Y_SIZE</span>, <span class="cm-variable">hybridFocalLength</span>) <span class="cm-operator">*</span> <span class="cm-number">1800</span> <span class="cm-operator">/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GDU_PI</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">int32_t</span>) (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">atan2f</span>((<span class="cm-variable">target</span>.<span class="cm-variable">focusX</span> <span class="cm-operator">-</span> <span class="cm-variable">CENTER_POINT_IN_SCREEN_X_VALUE</span>) <span class="cm-operator">*</span> <span class="cm-variable">IMAGE_SENSOR_X_SIZE</span>, <span class="cm-variable">hybridFocalLength</span>) <span class="cm-operator">*</span> <span class="cm-number">1800</span> <span class="cm-operator">/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GDU_PI</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_tapZoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"lock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomNewestGimbalRotationArgument</span>.<span class="cm-variable">rotationMode</span> <span class="cm-operator">=</span> <span class="cm-variable">rotationMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomNewestGimbalRotationArgument</span>.<span class="cm-variable">rotationProperty</span> <span class="cm-operator">=</span> <span class="cm-variable">rotationProperty</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomNewestGimbalRotationArgument</span>.<span class="cm-variable">rotationValue</span> <span class="cm-operator">=</span> <span class="cm-variable">rotationValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_tapZoomNewestTargetHybridFocalLength</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">uint32_t</span>) (<span class="cm-variable">hybridFocalLength</span> <span class="cm-operator">*</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_tapZoomMultiplier</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_tapZoomMutex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"unlock mutex error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_isStartTapZoom</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1773px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1773px;"></div></div></div></pre><h5 id='在线程中实现指点变焦功能'><span>在线程中实现指点变焦功能</span></h5><p><span>为避免负载设备在旋转云台和控制变焦时，阻塞负载设备控制程序的主线程，请在线程中实现指点变焦功能。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_isStartTapZoom</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_isStartTapZoom</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_isTapZooming</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">GetTimeMs</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_tapZoomStartTime</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get start time error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_CameraRotationGimbal</span>(<span class="cm-variable">s_tapZoomNewestGimbalRotationArgument</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"rotate gimbal error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraTapZoomState</span>.<span class="cm-variable">isGimbalMoving</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_CameraHybridZoom</span>(<span class="cm-variable">s_tapZoomNewestTargetHybridFocalLength</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraTapZoomState</span>.<span class="cm-variable">zoomState</span> <span class="cm-operator">=</span> (<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">s_tapZoomNewestTargetHybridFocalLength</span> <span class="cm-operator">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ((<span class="cm-variable">gdu_f32_t</span>) <span class="cm-variable">s_cameraOpticalZoomFocalLength</span> <span class="cm-operator">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">s_cameraDigitalZoomFactor</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">?</span> <span class="cm-variable">GDU_CAMERA_TAP_ZOOM_STATE_ZOOM_IN</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  : <span class="cm-variable">GDU_CAMERA_TAP_ZOOM_STATE_ZOOM_OUT</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_OUT_OF_RANGE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"hybrid zoom focal length beyond limit."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraTapZoomState</span>.<span class="cm-variable">zoomState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_TAP_ZOOM_STATE_ZOOM_LIMITED</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"hybrid zoom error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_isTapZooming</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">GetTimeMs</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">currentTime</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get start time error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> ((<span class="cm-variable">currentTime</span> <span class="cm-operator">-</span> <span class="cm-variable">s_tapZoomStartTime</span>) <span class="cm-operator">&gt;=</span> <span class="cm-variable">TAP_ZOOM_DURATION</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraTapZoomState</span>.<span class="cm-variable">zoomState</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CAMERA_TAP_ZOOM_STATE_IDLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_cameraTapZoomState</span>.<span class="cm-variable">isGimbalMoving</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_isTapZooming</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 944px;"></div><div class="CodeMirror-gutters" style="display: none; height: 944px;"></div></div></div></pre><p>&nbsp;</p><h3 id='云台功能-2'><span>云台功能</span></h3><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>仅使用FlyPort 开发的负载设备支持使用PSDK 的云台功能。</span></li></ul></blockquote><h2 id='概述-5'><span>概述</span></h2><p><span>使用PSDK 的“云台控制”功能，开发者需要先设计负载设备的云台并开发出控制云台的程序，将云台的控制函数注册到PSDK 指定的接口后，用户通过使用GDU Flight、基于MSDK 开发的移动端App 及遥控器即可控制基于PSDK 开发的具有云台功能的负载设备，同时获得负载设备的相关信息，如姿态等。</span></p><h2 id='基础概念-4'><span>基础概念</span></h2><h4 id='云台状态信息'><span>云台状态信息</span></h4><p><span>使用PSDK 开发的云台类负载设备需要按照指定的要求上报云台的状态、当前姿态和校准状态等信息，方便用户移动端App 或机载计算机根据云台的状态，实现精准控制。有关获取云台状态的方法和相关详情请参见</span><strong><span>PSDK API 文档</span></strong><span>。</span></p><h4 id='关节角与姿态角'><span>关节角与姿态角</span></h4><h5 id='云台关节与云台关节角'><span>云台关节与云台关节角</span></h5><p><span>云台的关节如 图1.云台关节 所示，云台关节是云台上带动负载设备转动的结构件：云台电机，云台关节角即云台电机转动的角度。本教程使用机体坐标系描述云台的关节角。</span></p><h5 id='云台姿态与云台姿态角'><span>云台姿态与云台姿态角</span></h5><p><span>云台的姿态如 图2.云台姿态 所示，根据用户的控制指令，云台能够调整姿态；云台姿态角即使用大地坐标系（NED，北东地坐标系）描述云台上</span><strong><span>负载设备</span></strong><span>的角度，该角度也称为欧拉角。</span></p><h4 id='云台模式'><span>云台模式</span></h4><p><span>云台模式决定了云台跟随无人机运动时的转动方式：</span></p><ul><li><span>自由模式：当无人机的姿态改变时，云台将不会转动。</span></li><li><span>FPV 模式：当无人机的姿态发生改变时，云台会转动航向轴与横滚轴，确保负载设备当前的视场角不会发生改变。</span></li><li><span>YAW 跟随模式：在该模式下，云台的航向轴会跟随无人机的航向轴转动。</span></li></ul><blockquote><p><strong><span>说明：</span></strong><span> 在以上三种模式下，无人机系统中的其他模块（航线飞行时的云台控制指令）、遥控器和移动端App，能够控制云台转动。</span></p><p>&nbsp;</p></blockquote><h4 id='云台控制'><span>云台控制</span></h4><h5 id='控制方式'><span>控制方式</span></h5><p><span>云台转动的控制方式分为以下三种：</span></p><ul><li><span>相对角度控制：使用PSDK 开发的云台根据用户</span><strong><span>指定的</span></strong><span>角度，在规定的时间内，转动</span><strong><span>指定的角度</span></strong><span>。</span></li><li><span>绝对角度控制：使用PSDK 开发的云台根据用户的指令，在规定的时间内，从</span><strong><span>当前的位置</span></strong><span>转动到指定的位置。</span></li><li><span>速度控制：用户可控制使用PSDK 开发的云台的转动速度。</span></li></ul><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>在角度控制模式下，云台转动的时间受云台最大旋转速度和最大加速度限制，实际的转动角度受云台限位角度的限制。</span></li><li><span>在速度控制模式下，云台根据用户指定的速度转动0.5s，当云台转动到限位角时，将会停止转动。</span></li></ul></blockquote><h5 id='控制权限'><span>控制权限</span></h5><p><span>有关云台控制权限的详细说明请参见 表1.云台控制权限。</span></p><ul><li><p><span>控制规则：</span></p><ul><li><span>所有控制设备，控制权为同等优先级，同等优先级的控制场景按照开始控制的时间先后顺序抢占控制权，开始控制时间较晚的控制场景不能夺取控制权。</span></li></ul></li><li><p><span>权限释放</span></p><ul><li><span>控制模块完成对云台的控制后会释放控制权；</span></li></ul></li></ul><p>&nbsp;</p><h5 id='平滑度'><span>平滑度</span></h5><p><span>云台的平滑度是指云台响应动作的缓急，使用PSDK 开发的云台支持用户通过GDU Flight和基于MSDK 开发的移动端App 通过设置平滑控制系数，实现云台的缓启停。</span></p><ul><li><p><span>平滑控制系数：平滑控制系数决定云台转动的最大加速度。</span></p></li><li><p><span>云台转动的最大加速度= 10000 × (0.8 ^ (1 + X)) deg/s^2 (X 为平滑控制系数)</span></p><p>&nbsp;</p></li></ul><h5 id='最大速度百分比'><span>最大速度百分比</span></h5><ul><li><p><span>最大速度百分比：云台的最大速度百分比决定云台旋转的最大速度。</span></p></li><li><p><span>云台实际最大的转动速度= 默认最大速度 × 最大速度百分比</span></p><blockquote><p><strong><span>说明：</span></strong><span> 开发者根据实际的使用需要，可设置云台默认的最大云台转动运动速度。</span></p></blockquote></li></ul><p>&nbsp;</p><h5 id='角度微调'><span>角度微调</span></h5><p><span>使用PSDK 开发的云台支持用户通过GDU Flight和基于MSDK 开发的移动端App，精细化地调整云台关节角的角度，调整结果还可作为校准参数存储在负载设备中，用于降低云台的各类误差。</span></p><h5 id='云台限位功能'><span>云台限位功能</span></h5><p><span>为避免云台在工作时，因结构干涉导致云台意外损坏或干扰无人机的执行飞行任务，请务必为云台设置机械限位和软件限位。</span></p><ul><li><p><span>机械限位：机械限位由云台类负载设备的物理形态和设计结构决定。</span></p></li><li><p><span>软件限位：开发者可根据实际的使用需求设置软件限位：</span></p><ul><li><span>设置云台俯仰轴、横滚轴和航向轴的欧拉角角度限制；</span></li><li><span>设置俯仰轴欧拉角扩展角角度限制；</span></li><li><span>设置云台关节角限制。</span></li></ul><blockquote><p><strong><span>提示：</span></strong></p><ul><li><span>使用俯仰轴角度范围扩展功能后，可将云台俯仰轴的欧拉角角度限制设置为默认限制或扩展限制。</span></li><li><span>当云台的关节角达到限位时，使用GDU Flight 以及基于MSDK 开发的移动端App 将接收到云台转动到限位角的提示信息。</span></li></ul></blockquote></li></ul><h5 id='云台复位'><span>云台复位</span></h5><p><span>使用PSDK 开发的云台类负载设备支持用户通过GDU Flight和基于MSDK 开发的移动端App 复位云台，将云台的姿态复位为初始状态。</span></p><ul><li><p><span>航向轴复位：将云台航向轴的角度复位为无人机航向轴角度与云台航向轴微调角度的和。</span></p></li><li><p><span>俯仰轴与航向轴复位：将云台俯仰轴的角度复位为微调的角度，将云台航向轴的角度复位为无人机航向轴角度与云台航向轴微调角度的和。</span></p></li><li><p><span>重置云台的偏航轴和俯仰轴：将云台偏航轴的角度重置为无人机偏航轴和云台微调角度的和。重置云台俯仰轴为-90°与云台微调角度的和（云台下置），90°与云台微调角度的和（云台上置）。</span></p></li><li><p><span>重置云台的偏航轴为-90°与云台微调角度的和（云台下置），90°与云台微调角度的和（云台上置）。</span></p><p>&nbsp;</p></li></ul><h2 id='实现云台功能'><span>实现云台功能</span></h2><p><span>请开发者根据选用的</span><strong><span>开发平台</span></strong><span>以及行业应用实际的使用需求，按照PSDK 中的结构体</span><code>T_GduGimbalCommonHandler</code><span>构造实现云台类负载设备控制功能的函数，将云台控制功能的函数注册到PSDK 中指定的接口后，用户通过使用GDU Flight 或基于MSDK 开发的移动端App 能够控制基于PSDK 开发的云台类负载设备执行指定的动作。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetSystemState</span> <span class="cm-operator">=</span> <span class="cm-variable">GetSystemState</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetAttitudeInformation</span> <span class="cm-operator">=</span> <span class="cm-variable">GetAttitudeInformation</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetCalibrationState</span> <span class="cm-operator">=</span> <span class="cm-variable">GetCalibrationState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetRotationSpeed</span> <span class="cm-operator">=</span> <span class="cm-variable">GetRotationSpeed</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">GetJointAngle</span> <span class="cm-operator">=</span> <span class="cm-variable">GetJointAngle</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">Rotate</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_GimbalRotate</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">StartCalibrate</span> <span class="cm-operator">=</span> <span class="cm-variable">StartCalibrate</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetControllerSmoothFactor</span> <span class="cm-operator">=</span> <span class="cm-variable">SetControllerSmoothFactor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetPitchRangeExtensionEnabled</span> <span class="cm-operator">=</span> <span class="cm-variable">SetPitchRangeExtensionEnabled</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetControllerMaxSpeedPercentage</span> <span class="cm-operator">=</span> <span class="cm-variable">SetControllerMaxSpeedPercentage</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">RestoreFactorySettings</span> <span class="cm-operator">=</span> <span class="cm-variable">RestoreFactorySettings</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">SetMode</span> <span class="cm-operator">=</span> <span class="cm-variable">SetMode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">Reset</span> <span class="cm-operator">=</span> <span class="cm-variable">Reset</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_commonHandler</span>.<span class="cm-variable">FineTuneAngle</span> <span class="cm-operator">=</span> <span class="cm-variable">FineTuneAngle</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><h2 id='使用云台控制功能'><span>使用云台控制功能</span></h2><p><span>使用云台控制功能，需要先实现云台控制功能，再实现云台限位功能，根据云台模式调整云台的姿态、目标角度和限位标志，最后实现云台校准功能校准云台。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 使用PSDK 开发负载设备的云台功能时，请使用</span><strong><span>FlyPort V2</span></strong><span> 或 </span><strong><span>FlyPort</span></strong><span> 。</span></p></blockquote><h4 id='使用云台管理功能'><span>使用云台管理功能</span></h4><h5 id='1-云台控制功能模块初始化'><span>1. 云台控制功能模块初始化</span></h5><p><span>使用“云台控制”功能前，需要先初始化云台控制功能模块，确保云台控制功能可正常运行。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduGimbal_Init</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"init gimbal module error: 0x%08llX"</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><h5 id='2注册云台控制功能'><span>2.注册云台控制功能</span></h5><p><span>使用PSDK 的云台控制功能控制云台类负载设备时，开发者需要将控制云台的函数注册到指定的接口中。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduGimbal_RegCommonHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_commonHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"gimbal register common handler error: 0x%08llX"</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><h5 id='3-获取云台的状态信息'><span>3. 获取云台的状态信息</span></h5><p><span>为方便用户控制云台执行相应的动作，需调用</span><code>GetSystemState</code><span> 接口获取云台的状态。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetSystemState</span>(<span class="cm-variable">T_GduGimbalSystemState</span> <span class="cm-operator">*</span><span class="cm-variable">systemState</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"mutex lock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">systemState</span> <span class="cm-operator">=</span> <span class="cm-variable">s_systemState</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"mutex unlock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 438px;"></div><div class="CodeMirror-gutters" style="display: none; height: 438px;"></div></div></div></pre><h5 id='4-构造回调函数计算云台的转动速度'><span>4. 构造回调函数计算云台的转动速度</span></h5><p><span>构造回调函数计算云台的转动速度、调整云台的姿态并记录云台转动的目标角度和转动速度。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_GimbalRotate</span>(<span class="cm-variable">E_GduGimbalRotationMode</span> <span class="cm-variable">rotationMode</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">T_GduGimbalRotationProperty</span> <span class="cm-variable">rotationProperty</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">T_GduAttitude3d</span> <span class="cm-variable">rotationValue</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduAttitude3d</span> <span class="cm-variable">targetAttitudeDTemp</span> <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduAttitude3f</span> <span class="cm-variable">targetAttitudeFTemp</span> <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduAttitude3d</span> <span class="cm-variable">speedTemp</span> <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"gimbal rotation value invalid flag: pitch %d, roll %d, yaw %d."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">pitch</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">roll</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_attitudeMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"mutex lock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexLock</span>(<span class="cm-variable">s_commonMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"mutex lock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">switch</span> (<span class="cm-variable">rotationMode</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">GDU_GIMBAL_ROTATION_MODE_RELATIVE_ANGLE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"gimbal relative rotate angle: pitch %d, roll %d, yaw %d."</span>, <span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationValue</span>.<span class="cm-variable">roll</span>, <span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"gimbal relative rotate action time: %d."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">relativeAngleRotation</span>.<span class="cm-variable">actionTime</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"gimbal is rotating."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">?</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">pitch</span> : (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">+</span> <span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">roll</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">?</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span> : (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">+</span> <span class="cm-variable">rotationValue</span>.<span class="cm-variable">roll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">?</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span> : (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+</span> <span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_GimbalAngleLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">targetAttitudeFTemp</span>, <span class="cm-variable">s_aircraftAttitude</span>, <span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_targetAttitude</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_controlType</span> <span class="cm-operator">=</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_GimbalCalculateSpeed</span>(<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>, <span class="cm-variable">s_targetAttitude</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">relativeAngleRotation</span>.<span class="cm-variable">actionTime</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_speed</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"calculate gimbal rotation speed error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">GDU_GIMBAL_ROTATION_MODE_ABSOLUTE_ANGLE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"gimbal absolute rotate angle: pitch %d, roll %d, yaw %d."</span>, <span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationValue</span>.<span class="cm-variable">roll</span>, <span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"gimbal absolute rotate action time: %d."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">absoluteAngleRotation</span>.<span class="cm-variable">actionTime</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">absoluteAngleRotation</span>.<span class="cm-variable">jointAngleValid</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"gimbal joint angles: pitch %d, roll %d, yaw %d."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">absoluteAngleRotation</span>.<span class="cm-variable">jointAngle</span>.<span class="cm-variable">pitch</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">absoluteAngleRotation</span>.<span class="cm-variable">jointAngle</span>.<span class="cm-variable">roll</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">absoluteAngleRotation</span>.<span class="cm-variable">jointAngle</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"gimbal is rotating."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">?</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">pitch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  : <span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">roll</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">?</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : <span class="cm-variable">rotationValue</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationProperty</span>.<span class="cm-variable">rotationValueInvalidFlag</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">?</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  : <span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_GimbalAngleLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">targetAttitudeFTemp</span>, <span class="cm-variable">s_aircraftAttitude</span>, <span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">targetAttitudeDTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeFTemp</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_targetAttitude</span> <span class="cm-operator">=</span> <span class="cm-variable">targetAttitudeDTemp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_controlType</span> <span class="cm-operator">=</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_GimbalCalculateSpeed</span>(<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>, <span class="cm-variable">s_targetAttitude</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">rotationProperty</span>.<span class="cm-variable">absoluteAngleRotation</span>.<span class="cm-variable">actionTime</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_speed</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"calculate gimbal rotation speed error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">GDU_GIMBAL_ROTATION_MODE_SPEED</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"gimbal rotate speed: pitch %d, roll %d, yaw %d."</span>, <span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">rotationValue</span>.<span class="cm-variable">roll</span>, <span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">s_controlType</span> <span class="cm-operator">==</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"gimbal is rotating."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">memcpy</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">speedTemp</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">rotationValue</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduAttitude3d</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_GimbalSpeedLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">speedTemp</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_speed</span> <span class="cm-operator">=</span> <span class="cm-variable">speedTemp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">rotationValue</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">!=</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-variable">rotationValue</span>.<span class="cm-variable">roll</span> <span class="cm-operator">!=</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-variable">rotationValue</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">!=</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_controlType</span> <span class="cm-operator">=</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_SPEED</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">default</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"gimbal rotation mode invalid: %d."</span>, <span class="cm-variable">rotationMode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_NONSUPPORT</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out1</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_commonMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"mutex unlock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out2</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">MutexUnlock</span>(<span class="cm-variable">s_attitudeMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"mutex unlock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 4261px;"></div><div class="CodeMirror-gutters" style="display: none; height: 4261px;"></div></div></div></pre><h5 id='5-控制云台转动'><span>5. 控制云台转动</span></h5><p><span>负载设备根据云台的姿态和转动速度，将相对角度控制量、绝对角度控制量或速度控制量转换为控制云台转动的速度，根据该速度控制云台转动，如 图3.云台控制 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">nextAttitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">+</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_speed</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">/</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">PAYLOAD_GIMBAL_TASK_FREQ</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">roll</span> <span class="cm-operator">+</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_speed</span>.<span class="cm-variable">roll</span> <span class="cm-operator">/</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">PAYLOAD_GIMBAL_TASK_FREQ</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_speed</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">/</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">PAYLOAD_GIMBAL_TASK_FREQ</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_controlType</span> <span class="cm-operator">==</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">-</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">pitch</span>) <span class="cm-operator">*</span> <span class="cm-variable">s_speed</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">pitch</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> (<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">-</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">roll</span>) <span class="cm-operator">*</span> <span class="cm-variable">s_speed</span>.<span class="cm-variable">roll</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">roll</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  : <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">nextAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">yaw</span>) <span class="cm-operator">*</span> <span class="cm-variable">s_speed</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">yaw</span> : <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_GimbalAngleLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">nextAttitude</span>, <span class="cm-variable">s_aircraftAttitude</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">reachLimitFlag</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">nextAttitude</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_controlType</span> <span class="cm-operator">==</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">memcmp</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_targetAttitude</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduAttitude3d</span>)) <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_controlType</span> <span class="cm-operator">==</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_SPEED</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> ((<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">reachLimitFlag</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">||</span> <span class="cm-variable">s_speed</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">reachLimitFlag</span>.<span class="cm-variable">roll</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">||</span> <span class="cm-variable">s_speed</span>.<span class="cm-variable">roll</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">reachLimitFlag</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">||</span> <span class="cm-variable">s_speed</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1106px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1106px;"></div></div></div></pre><p>&nbsp;</p><h4 id='调整云台处于不同模式时的参数'><span>调整云台处于不同模式时的参数</span></h4><p><span>开发者能够根据</span><strong><span>实际的使用需求</span></strong><span>调整云台处于不同模式时的姿态、目标角度和到达限位标志。</span></p><ul><li><p><span>在FPV 模式下：</span></p><ul><li><span>调整云台姿态：将无人机姿态的变化量叠加到云台的横滚轴和航向轴上；</span></li><li><span>调整云台转动的目标角度：云台旋转时，将无人机的姿态变化量叠加到云台的横滚轴和航向轴上。</span></li></ul></li><li><p><span>在YAW 模式下：</span></p><ul><li><span>调整云台姿态：将无人机姿态的变化量叠加到云台的航向轴上；</span></li><li><span>调整云台转动的目标角度：云台旋转时，将无人机的姿态变化量叠加到云台的航向轴上。</span></li></ul></li><li><p><span>调整云台姿态与目标角度的转动范围，负载设备能够计算出云台的达到限位标志。</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">switch</span> (<span class="cm-variable">s_systemState</span>.<span class="cm-variable">gimbalMode</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">PSDK_GIMBAL_MODE_FREE</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">PSDK_GIMBAL_MODE_FPV</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">+=</span> (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">roll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+=</span> (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">roll</span> <span class="cm-operator">+=</span> (<span class="cm-variable-3">float</span>) (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">roll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+=</span> (<span class="cm-variable-3">float</span>) (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">s_controlType</span> <span class="cm-operator">==</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">+=</span> (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">roll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+=</span> (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">PSDK_GIMBAL_MODE_YAW_FOLLOW</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+=</span> (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_attitudeHighPrecision</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+=</span> (<span class="cm-variable-3">float</span>) (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_rotatingFlag</span> <span class="cm-operator">==</span> <span class="cm-atom">true</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">s_controlType</span> <span class="cm-operator">==</span> <span class="cm-variable">TEST_GIMBAL_CONTROL_TYPE_ANGLE</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">+=</span> (<span class="cm-variable">s_aircraftAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">-</span> <span class="cm-variable">s_lastAircraftAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">default</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">PsdkLogger_UserLogError</span>(<span class="cm-string">"gimbal mode invalid: %d."</span>, <span class="cm-variable">s_systemState</span>.<span class="cm-variable">gimbalMode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_lastAircraftAttitude</span> <span class="cm-operator">=</span> <span class="cm-variable">s_aircraftAttitude</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PsdkTest_GimbalAngleLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">attitudeFTemp</span>, <span class="cm-variable">s_aircraftAttitude</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">reachLimitFlag</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_attitudeInformation</span>.<span class="cm-variable">attitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PsdkTest_GimbalAngleLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_attitudeHighPrecision</span>, <span class="cm-variable">s_aircraftAttitude</span>, <span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">yaw</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PsdkTest_GimbalAngleLegalization</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">attitudeFTemp</span>, <span class="cm-variable">s_aircraftAttitude</span>, <span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">pitch</span> <span class="cm-operator">=</span> <span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">pitch</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">roll</span> <span class="cm-operator">=</span> <span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">roll</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_targetAttitude</span>.<span class="cm-variable">yaw</span> <span class="cm-operator">=</span> <span class="cm-variable">attitudeFTemp</span>.<span class="cm-variable">yaw</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1290px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1290px;"></div></div></div></pre><h4 id='使用云台校准功能'><span>使用云台校准功能</span></h4><p><span>为方便用户更加精准地控制云台，</span><strong><span>建议</span></strong><span>开发者在开发具有云台功能的负载设备时实现云台校准功能。</span></p><h5 id='1-使用云台校准功能'><span>1. 使用云台校准功能</span></h5><p><span>如需使用云台校准功能，请先实现云台校准功能，并将云台校准功能的函数，注册到指定的接口中，方便用户使用GDU Flight 或基于MSDK 开发的移动端App 校准具有云台功能的负载设备。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_PsdkReturnCode</span> <span class="cm-def">StartCalibrate</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_PsdkReturnCode</span> <span class="cm-variable">psdkStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">PsdkLogger_UserLogDebug</span>(<span class="cm-string">"start calibrate gimbal."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">psdkStat</span> <span class="cm-operator">=</span> <span class="cm-variable">PsdkOsal_GetTimeMs</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_calibrationStartTime</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">psdkStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">PSDK_RETURN_CODE_OK</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">PsdkLogger_UserLogError</span>(<span class="cm-string">"get start time error: %lld."</span>, <span class="cm-variable">psdkStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">PsdkOsal_MutexLock</span>(<span class="cm-variable">s_calibrationMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PSDK_RETURN_CODE_OK</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">PsdkLogger_UserLogError</span>(<span class="cm-string">"mutex lock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">PSDK_RETURN_CODE_ERR_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">calibratingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">progress</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">stage</span> <span class="cm-operator">=</span> <span class="cm-variable">PSDK_GIMBAL_CALIBRATION_STAGE_PROCRESSING</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">PsdkOsal_MutexUnlock</span>(<span class="cm-variable">s_calibrationMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PSDK_RETURN_CODE_OK</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">PsdkLogger_UserLogError</span>(<span class="cm-string">"mutex unlock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">PSDK_RETURN_CODE_ERR_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">PSDK_RETURN_CODE_OK</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 622px;"></div><div class="CodeMirror-gutters" style="display: none; height: 622px;"></div></div></div></pre><h5 id='2-云台校准状态更新'><span>2. 云台校准状态更新</span></h5><p><span>负载设备执行云台校准功能后，将记录云台的校准状态，基于MSDK 开发的移动端App 能够获取云台的校准状态。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">// calibration</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">calibratingFlag</span> <span class="cm-operator">!=</span> <span class="cm-atom">true</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">unlockCalibrationMutex</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">progressTemp</span> <span class="cm-operator">=</span> (<span class="cm-variable">currentTime</span> <span class="cm-operator">-</span> <span class="cm-variable">s_calibrationStartTime</span>) <span class="cm-operator">*</span> <span class="cm-number">100</span> <span class="cm-operator">/</span> <span class="cm-variable">PAYLOAD_GIMBAL_CALIBRATION_TIME_MS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">progressTemp</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">100</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">calibratingFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">currentCalibrationProgress</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_calibrationState</span>.<span class="cm-variable">currentCalibrationStage</span> <span class="cm-operator">=</span> <span class="cm-variable">PSDK_GIMBAL_CALIBRATION_STAGE_COMPLETE</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">unlockCalibrationMutex</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">PsdkOsal_MutexUnlock</span>(<span class="cm-variable">s_calibrationMutex</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PSDK_RETURN_CODE_OK</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">PsdkLogger_UserLogError</span>(<span class="cm-string">"mutex unlock error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 415px;"></div><div class="CodeMirror-gutters" style="display: none; height: 415px;"></div></div></div></pre><p><span>在GDU Flight 以及基于MSDK 开发的移动端App 中使用“云台自动校准”功能后，使用PSDK 开发的负载设备将接收到云台校准命令并校准云台。</span></p><p>&nbsp;</p><h3 id='电源管理-2'><span>电源管理</span></h3><h2 id='概述-6'><span>概述</span></h2><p><span>将基于PSDK 开发的负载设备安装在无人机的云台上后，负载设备通过功率申请能获得较高的功率，因此，使用高功率的负载设备必须同时支持使用低功率；为防止负载设备未执行关机准备而丢失数据或意外损毁，PSDK 还提供了下发关机通知的功能。</span></p><h2 id='使用电源管理功能'><span>使用电源管理功能</span></h2><h4 id='1-引脚初始化'><span>1. 引脚初始化</span></h4><p><span>需要使用高功率的负载设备在申请高功率前，需要先初始化负载设备上用于申请高功率的引脚。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_PsdkReturnCode</span> <span class="cm-def">PsdkTest_HighPowerApplyPinInit</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitTypeDef</span> <span class="cm-variable">GPIO_InitStructure</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">RCC_AHB1PeriphClockCmd</span>(<span class="cm-variable">HIGH_POWER_APPLY_RCC</span>, <span class="cm-variable">ENABLE</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">GPIO_Mode</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_Mode_OUT</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">GPIO_PuPd</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_PuPd_DOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">GPIO_Speed</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_Speed_100MHz</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">GPIO_Pin</span> <span class="cm-operator">=</span> <span class="cm-variable">HIGH_POWER_APPLY_PIN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_Init</span>(<span class="cm-variable">HIGH_POWER_APPLY_Port</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">GPIO_InitStructure</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">PSDK_RETURN_CODE_OK</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><blockquote><p><strong><span>说明：</span></strong><span> 请根据所选用的开发平台支持的库，实现初始化申请高功率引脚的功能。</span></p></blockquote><h4 id='2-开发并注册改变负载设备引脚电平状态的函数'><span>2. 开发并注册改变负载设备引脚电平状态的函数</span></h4><p><span>1.开发改变负载设备引脚电平状态的函数</span>
<span>开发者开发出负载设备改变引脚电平状态的功能后，需要将改变负载设备引脚电平状态的函数注册到指定的接口中。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_WriteHighPowerApplyPin</span>(<span class="cm-variable">E_GduPowerManagementPinState</span> <span class="cm-variable">pinState</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_PinState</span> <span class="cm-variable">state</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">switch</span> (<span class="cm-variable">pinState</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">GDU_POWER_MANAGEMENT_PIN_STATE_RESET</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_PIN_RESET</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">GDU_POWER_MANAGEMENT_PIN_STATE_SET</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_PIN_SET</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">default</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"pin state unknown: %d."</span>, <span class="cm-variable">pinState</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">HAL_GPIO_WritePin</span>(<span class="cm-variable">HIGH_POWER_APPLY_PORT</span>, <span class="cm-variable">HIGH_POWER_APPLY_PIN</span>, <span class="cm-variable">state</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 461px;"></div><div class="CodeMirror-gutters" style="display: none; height: 461px;"></div></div></div></pre><p><span>2.注册改变引脚电平状态的函数</span>
<span>注册改变负载设备引脚电平状态的函数后，用户能够控制负载设备改变引脚的电平状态。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42383px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPowerManagement_RegWriteHighPowerApplyPinCallback</span>(<span class="cm-variable">s_applyHighPowerHandler</span>.<span class="cm-variable">pinWrite</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"register WriteHighPowerApplyPinCallback error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><h4 id='3申请高功率'><span>3.申请高功率</span></h4><p><span>负载设备调用</span><code>GduPowerManagement_ApplyHighPowerSync()</code><span>接口后，负载设备能够向无人机申请高功率，高功率申请完成后，可使用电压表等仪器测量AirPort指定接口的电压。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPowerManagement_ApplyHighPowerSync</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"apply high power error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h2 id='使用关机通知功能'><span>使用关机通知功能</span></h2><p><span>无人机下发关机通知的流程如下所示：</span></p><ul><li><span>当无人机获取到用户发送的关机通知时，无人机将向使用PSDK 开发的负载设备发送关机通知；</span></li><li><span>当负载设备接收到无人机发送的关机通知后，负载设备将完成关机前需执行的操作，并更改关机准备状态；</span></li><li><span>当无人机下发关机通知之后3s，无人机将会关机。</span></li></ul><h4 id='1构造关机状态回调函数'><span>1.构造关机状态回调函数</span></h4><p><span>开发者开发出负载设备执行关机准备的功能后，需要将负载设备执行关机准备功能的函数注册到指定的接口中。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42578px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_PowerOffNotificationCallback</span>(<span class="cm-variable-3">bool</span> <span class="cm-variable-3">*</span><span class="cm-variable">powerOffPreparationFlag</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"aircraft will power off soon."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">powerOffPreparationFlag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><h4 id='2注册回调函数'><span>2.注册回调函数</span></h4><p><span>注册负载设备关机准备功能的函数后，负载设备在接收到关机通知后，将执行关机准备动作，并更改负载设备的关机准备状态，如 图1. 关机信息 所示。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// register power off notification callback function</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPowerManagement_RegPowerOffNotificationCallback</span>(<span class="cm-variable">GduTest_PowerOffNotificationCallback</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"register power off notification callback function error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><h3 id='飞行控制-2'><span>飞行控制</span></h3><h2 id='概述-7'><span>概述</span></h2><p><span>使用PSDK 的无人机飞行控制功能，能够设置并获取无人机各项基础参数，控制无人机执行基础飞行动作</span></p><h2 id='基础概念-5'><span>基础概念</span></h2><h4 id='无人机基础信息'><span>无人机基础信息</span></h4><p><span>PSDK 开放了设置无人机基础参数的接口，开发者通过设置并获取无人机的基础参数，能够实现对无人机的精准控制：</span></p><ul><li><span>开启或关闭避障功能（水平避障和顶部避障）</span></li><li><span>设置无人机的返航点和返航高度</span></li></ul><p><span>具有信息管理功能的应用程序，能够方便用户获取无人机基础参数的信息：</span></p><ul><li><span>获取避障功能的状态（水平避障和顶部避障）</span></li><li><span>获取无人机返航点和返航高度</span></li></ul><h4 id='无人机基础飞行动作'><span>无人机基础飞行动作</span></h4><p><span>无人机的基础飞行动作主要包含无人机锁定、无人机起飞降落和无人机返航三类，开发者使用PSDK 提供的接口，即可根据实际的控制需求，控制无人机执行指定的飞行动作。</span></p><p><span>表1. 基础飞行动作</span></p><figure><table><thead><tr><th><span>功能类型</span></th><th><span>基本功能</span></th><th><span>功能说明</span></th></tr></thead><tbody><tr><td><span>起飞和降落</span></td><td><span>自动起飞</span></td><td><span>使用该功能时，无人机会自动起飞2 米（该高度不可调整）</span></td></tr><tr><td><span>自动降落</span></td><td><span>使用该功能时，无人机会自动降落</span></td><td>&nbsp;</td></tr><tr><td><span>取消自动降落</span></td><td><span>使用该功能时，无人机在下降多过程中会停止降落，并悬停在空中</span></td><td>&nbsp;</td></tr><tr><td><span>强制降落</span></td><td><span>同自动降落</span></td><td>&nbsp;</td></tr><tr><td><span>无人机返航</span></td><td><span>返航</span></td><td><span>使用该功能时，无人机会自动返航</span></td></tr><tr><td><span>取消返航</span></td><td><span>使用该功能时，无人机会悬停在空中</span></td><td>&nbsp;</td></tr></tbody></table></figure><h3 id='自定义控件-2'><span>自定义控件</span></h3><h4 id='概述-8'><span>概述</span></h4><p><span>“自定义控件”是一个将“负载设备的功能”封装为按钮、开关以及范围条等控件的功能。使用GDU Flight 或基于MSDK 开发的移动端App 能够识别负载设备中控件的配置信息并生成UI 控件，方便用户快速设置负载设备的参数并控制负载设备执行指定的动作。同时，GDU Flight 或基于MSDK 开发的移动端App 还能以浮窗的形式显示负载设备的状态信息。此外，用户还能根据使用需求，将负载设备的功能映射到遥控器上的预留按键上，通过使用遥控器上的预留按键，以更便捷的方式控制负载设备。</span></p><h2 id='基础概念-6'><span>基础概念</span></h2><h4 id='控件'><span>控件</span></h4><h5 id='主界面的控件'><span>主界面的控件</span></h5><ul><li><span>动作栏控件：动作栏支持按钮、开关、范围条和选择列表四个控件类型，最多支持设置8个自定义控件。</span></li><li><span>浮窗：实时显示负载设备的状态信息。</span></li></ul><p><img src="https://terra-1-g.gdu.com/71a7d383e71a4fb8887a310eb746b47f/psdk/V3.3/custom-widget-main-screen.png" referrerpolicy="no-referrer" alt="img"></p><h5 id='配置界面的控件'><span>配置界面的控件</span></h5><p><span>用户在配置界面能够操作配置界面中的控件，如按钮、开关、范围条、选择列表、文本输入框、整型值输入框，如 图2. 配置界面 所示。</span></p><p><span>图2. 配置界面</span></p><p>&nbsp;</p><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>配置界面仅支持显示一个“文本输入框”控件，该文本框最多支持输入128个字节的字符。</span></li><li><span>使用PSDK 开发的负载设备通过</span><code>GduLowSpeedDataChannel_RegRecvDataCallback(ReceiveDataFromMobile)</code><span>函数能够获取用户在GDU Flight </span><strong><span>文本输入框控件</span></strong><span>中向负载设备发送的信息（编码格式为UTF-8）。</span></li><li><span>受日志长度的影响，用户所输入的字符可能不会被全部显示出来。</span></li></ul></blockquote><h4 id='控件配置文件'><span>控件配置文件</span></h4><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>控件配置文件的路径：</span><code>sample/sample_c/module_sample/widget/widget_file</code></li><li><span>GDU Flight系统语言为中文时，控件配置文件为</span><code>cn_big_screen</code></li><li><span>GDU Flight系统语言为英文时，控件配置文件为</span><code>en_big_screen</code></li><li><span>不同语言下的配置信息如控件编号、数量与类型等需要保持一致。</span></li></ul></blockquote><blockquote><p><strong><span>注意：</span></strong><span> 控件配置文件包含</span><strong><span>静态配置文件</span></strong><span>和</span><strong><span>控件UI 图标</span></strong><span>，建议先在</span><strong><span>静态配置文件</span></strong><span>中配置控件属性，再设计控件图标。</span></p></blockquote><h5 id='配置控件属性'><span>配置控件属性</span></h5><p><code>widget_config.json</code><span>是一个用于配置控件静态属性的文件，修改</span><code>widget_config.json</code><span>文件时，请务必严格遵守</span><a href='https://www.json.org/'><span>JSONopen in new window</span></a><span>的语法规则，否则配置文件将无法使用。</span></p><blockquote><p><strong><span>提示：</span></strong></p><ul><li><span>JSON文件中的配置项被包裹在一个{}中，通过key-value的方式表达数据；</span></li><li><span>JSON的Key 必须包裹在一个双引号中，请勿丢失Key 值的双引号；</span></li><li><span>JSON的值只支持数字（含浮点数和整数）、字符串、Bool值（如true 和 false)、数组（需要包裹在[]中)和对象（需要包裹在{}中 ）</span></li></ul></blockquote><blockquote><p><strong><span>注意：</span></strong><span> 下述代码中 “//” 后的内容为代码注释，在实际的JSON配置文件请勿添加该内容。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"version"</span>:  { <span class="cm-comment">// 自定义控件配置文件版本,用户不可更改此版本号</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"major"</span> : &nbsp;<span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"minor"</span> : &nbsp;<span class="cm-number">0</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"main_interface"</span>: { <span class="cm-comment">// GDU Flight 主界面控件设置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"floating_window"</span>: {<span class="cm-comment">// 浮窗配置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"is_enable"</span>: <span class="cm-atom">true</span> <span class="cm-comment">// 浮窗是否显示，true ：显示，false ：隐藏</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_list"</span>: [ <span class="cm-comment">// 主界面动作栏控件列表</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">0</span>, <span class="cm-comment">// 控件编号</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"button"</span>, <span class="cm-comment">// 控件类型，主界面Action控件支持 "button" : 按钮，"switch" : 开关，"range" : 范围条，"list" : 选择列表</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Button_1"</span>, <span class="cm-comment">// 控件名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_set"</span>:  { <span class="cm-comment">// 控件图标文件集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_selected"</span> : &nbsp;<span class="cm-string">"icon_button1.png"</span>, <span class="cm-comment">// 选中状态下控件图标文件名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_unselected"</span> : &nbsp;<span class="cm-string">"icon_button1.png"</span> <span class="cm-comment">// 未选中状态下控件图标文件名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"button"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Button_2"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_set"</span>:  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_selected"</span> : &nbsp;<span class="cm-string">"icon_button2.png"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_unselected"</span> : &nbsp;<span class="cm-string">"icon_button2.png"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">2</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"list"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"List"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"list_item"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"item_name"</span>: <span class="cm-string">"Item_1"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_set"</span>:  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_selected"</span> : &nbsp;<span class="cm-string">"icon_list_item1.png"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_unselected"</span> : &nbsp;<span class="cm-string">"icon_list_item1.png"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"item_name"</span>: <span class="cm-string">"Item_2"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_set"</span>:  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_selected"</span> : &nbsp;<span class="cm-string">"icon_list_item2.png"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_unselected"</span> : &nbsp;<span class="cm-string">"icon_list_item2.png"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">3</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"switch"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Switch"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_set"</span>:  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_selected"</span> : &nbsp;<span class="cm-string">"icon_switch_select.png"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_unselected"</span> : &nbsp;<span class="cm-string">"icon_switch_unselect.png"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">4</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"scale"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Scale"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_set"</span>:  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_selected"</span> : &nbsp;<span class="cm-string">"icon_scale.png"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"icon_file_name_unselected"</span> : &nbsp;<span class="cm-string">"icon_scale.png"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"config_interface"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"text_input_box"</span>: { <span class="cm-comment">// 文本输入框</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>:<span class="cm-string">"TextInputBox"</span>, <span class="cm-comment">//文本输入框名称</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"placeholder_text"</span>:<span class="cm-string">"Please input message"</span>, <span class="cm-comment">//文本输入框占位符文本</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"is_enable"</span>:<span class="cm-atom">false</span> <span class="cm-comment">// 文本输入框是否显示，false : 不显示，true ： 显示</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_list"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">5</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"button"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Button 5"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">6</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"scale"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Scale 6"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">7</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"int_input_box"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Integer Input Box 7"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"int_input_box_hint"</span>: <span class="cm-string">"unit:s"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">8</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"switch"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"Switch 8"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_index"</span>: <span class="cm-number">9</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_type"</span>: <span class="cm-string">"list"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"widget_name"</span>: <span class="cm-string">"List 9"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"list_item"</span>: [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"item_name"</span>: <span class="cm-string">"Item 1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"item_name"</span>: <span class="cm-string">"Item 2"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"item_name"</span>: <span class="cm-string">"Item 3"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"item_name"</span>: <span class="cm-string">"Item 4"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 2787px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2787px;"></div></div></div></pre><h5 id='设计控件图标'><span>设计控件图标</span></h5><p><span>为提高用户自定义控件与GDU Flight 控件的适配性，请遵守以下规范设计控件的图标。</span></p><ul><li><p><span>图标尺寸</span></p><ul><li><span>标准尺寸：96px</span></li><li><span>底框：80px（色值：#000000；透明度：0.6 Alapha；Blur = 4）</span></li><li><span>圆⻆：4px</span></li></ul></li><li><p><span>颜色</span></p></li></ul><p><span>图3. 控件颜色</span></p><p><img src="https://terra-1-g.gdu.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/1bc5ce3a-a436-4f33-8a3e-5369b4fbad98.png" referrerpolicy="no-referrer" alt="img"></p><ul><li><span>图标格式：PNG</span></li><li><span>视觉修正：</span></li></ul><p><span>图4. 视觉修正</span></p><p><img src="https://terra-1-g.gdu.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/f897b480-2ae6-433b-bf3c-68687ab261ab.png" referrerpolicy="no-referrer" alt="img"></p><p>&nbsp;</p><h5 id='rtos-配置文件转换'><span>RTOS 配置文件转换</span></h5><p><span>RTOS 系统不支持文件系统，请按如下步骤将配置文件转换为</span><code>.h</code><span>类型的文件：</span></p><ul><li><span>使用</span><code>tools/file2c</code><span>目录下的工具</span><code>file2c</code><span>，将</span><strong><span>所有的</span></strong><span>自定义控件配置文件生成 </span><code>.h</code><span> 头文件，详细说明请参见目录下 </span><code>Readme.txt</code><span> 文件；</span></li><li><code>.h</code><span>头文件在</span><code>sample/api_sample/widget/widget_file_c</code><span>目录下；</span></li><li><span>调用接口</span><code>GduWidget_RegDefaultUiConfigByBinaryArray</code><span>和</span><code>GduWidget_RegUiConfigByBinaryArray</code><span>调用控件配置文件。</span></li></ul><blockquote><p><span>配置参考文件</span></p><ul><li><span>中文配置文件：</span><code>file_binary_array_list_cn.h</code><span> 和</span><code>file_binary_array_list_cn.c</code></li><li><span>英文配置文件：</span><code>file_binary_array_list_en.h</code><span> 和</span><code>file_binary_array_list_en.c</code></li></ul></blockquote><h2 id='使用自定义控件功能'><span>使用自定义控件功能</span></h2><p><span>开发负载设备的自定义控件功能，需要先完成自定义控件的初始化，获取控件配置文件所在的目录，配置控件在不同系统语言下显示的配置文件，通过设置控件处理函数列表，应用自定义控件功能，最终实现自定义控件功能。</span></p><h4 id='1-控件初始化'><span>1. 控件初始化</span></h4><p><span>使用“自定义控件”功能前，需要使用如下代码初始化负载设备的控件。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gduStat = GduWidget_Init();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  USER_LOG_ERROR("Gdu test widget init error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h4 id='2-设置控件配置信息'><span>2. 设置控件配置信息</span></h4><p><span>在Linux 和RTOS 系统上开发负载设备时，需要设置控件的配置信息，如控件默认的配置文件和不同系统语言对应的控件配置文件。确保GDU Flight 能够获取控件的配置信息并正确地显示在GDU Flight上。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 不同系统语言下的控件配置文件中的配置项如控件编号、控件数量与控件类型等需要保持一致。</span></p></blockquote><h5 id='设置负载设备的控件参数linux）'><span>设置负载设备的控件参数（Linux）</span></h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  //Step 2 : Set UI Config (Linux environment)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  char curFileDirPath[WIDGET_DIR_PATH_LEN_MAX];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  char tempPath[WIDGET_DIR_PATH_LEN_MAX];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  gduStat = GduUserUtil_GetCurrentFileDirPath(__FILE__, WIDGET_DIR_PATH_LEN_MAX, curFileDirPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  USER_LOG_ERROR("Get file current path error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (s_isWidgetFileDirPathConfigured == true) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  snprintf(tempPath, WIDGET_DIR_PATH_LEN_MAX, "%swidget_file/en_big_screen", s_widgetFileDirPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } else {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  snprintf(tempPath, WIDGET_DIR_PATH_LEN_MAX, "%swidget_file/en_big_screen", curFileDirPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  //set default ui config path</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  gduStat = GduWidget_RegDefaultUiConfigByDirPath(tempPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  USER_LOG_ERROR("Add default widget ui config error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  //set ui config for English language</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  gduStat = GduWidget_RegUiConfigByDirPath(GDU_MOBILE_APP_LANGUAGE_ENGLISH,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GDU_MOBILE_APP_SCREEN_TYPE_BIG_SCREEN,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tempPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  USER_LOG_ERROR("Add widget ui config error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  //set ui config for Chinese language</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (s_isWidgetFileDirPathConfigured == true) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  snprintf(tempPath, WIDGET_DIR_PATH_LEN_MAX, "%swidget_file/cn_big_screen", s_widgetFileDirPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  } else {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  snprintf(tempPath, WIDGET_DIR_PATH_LEN_MAX, "%swidget_file/cn_big_screen", curFileDirPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  gduStat = GduWidget_RegUiConfigByDirPath(GDU_MOBILE_APP_LANGUAGE_CHINESE,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GDU_MOBILE_APP_SCREEN_TYPE_BIG_SCREEN,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tempPath);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  USER_LOG_ERROR("Add widget ui config error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1152px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1152px;"></div></div></div></pre><h5 id='设置负载设备的控件参数rtos）'><span>设置负载设备的控件参数（RTOS）</span></h5><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">//Step 2 : Set UI Config (RTOS environment)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  T_GduWidgetBinaryArrayConfig enWidgetBinaryArrayConfig = {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .binaryArrayCount = g_EnBinaryArrayCount,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .fileBinaryArrayList = g_EnFileBinaryArrayList</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  };</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  //set default ui config</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  gduStat = GduWidget_RegDefaultUiConfigByBinaryArray(&amp;enWidgetBinaryArrayConfig);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  USER_LOG_ERROR("Add default widget ui config error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><h4 id='3注册控件处理函数列表'><span>3.注册控件处理函数列表</span></h4><p><span>通过</span><code>GduWidget_RegHandlerList</code><span>接口注册负载设备的某项功能和对应的控件参数，将负载设备的功能绑定到指定的控件上。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="text"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="text"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  gduStat = GduWidget_RegHandlerList(s_widgetHandlerList, s_widgetHandlerListCount);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  if (gduStat != GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  USER_LOG_ERROR("Set widget handler list error, stat = 0x%08llX", gduStat);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  return gduStat;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p>&nbsp;</p><h3 id='hms-功能'><span>HMS 功能</span></h3><h2 id='概述-9'><span>概述</span></h2><p><span>HMS（健康管理系统）是对飞机各模块的运行健康状态的一个监控系统。在GDU Flight上已经提供了交互界面查看各模块的工作状态是否有异常。PSDK则提供了基本接口来获取各模块异常的错误信息，便于PSDK程序获知飞机各模块的工作状态。</span></p><h2 id='基本概念'><span>基本概念</span></h2><h3 id='hms错误信息'><span>HMS错误信息</span></h3><p><span>单条HMS的错误信息包括一个错误ID，错误的Index和一个错误的等级，在订阅HMS信息后，这些错误信息将会打包发送给PSDK。PSDK根据这些错误信息的数据解析成字符串，并从终端打印出来。</span></p><p><span>HMS 多国语言数据库可查询：</span><a href='https://terra-1-g.gducdn.com/84f990b0bbd145e6a3930de0c55d3b2b/apicloud/hms.json'><span>hms.jsonopen in new window</span></a><span>。</span></p><h2 id='使用hms功能'><span>使用HMS功能</span></h2><h3 id='1-初始化hms功能模块'><span>1. 初始化HMS功能模块</span></h3><p><span>在使用HMS功能的相关接口之前，需要先调用</span><code>GduTest_HmsInit</code><span> 接口初始化HMS功能模块。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_HmsInit</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Hms sample init error, error code:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h3 id='2-订阅飞行状态信息'><span>2. 订阅飞行状态信息</span></h3><p><span>在HMS模块内会根据TOPIC_STATUS_FLIGHT的订阅数据来判断飞机是否在空中，从而区分HMS信息是在飞行过程中接收到的还是在地上接收到的。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_Init</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Hms sample init data subscription module failed, error code:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*! subscribe fc data */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFcSubscription_SubscribeTopic</span>(<span class="cm-variable">GDU_FC_SUBSCRIPTION_TOPIC_STATUS_FLIGHT</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GDU_DATA_SUBSCRIPTION_TOPIC_10_HZ</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"HMS sample subscribe topic flight status error, error code:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 438px;"></div><div class="CodeMirror-gutters" style="display: none; height: 438px;"></div></div></div></pre><h3 id='3-注册hms信息回调'><span>3. 注册HMS信息回调</span></h3><p><span>开发者可通过调用</span><code>GduHms_RegHmsInfoCallback</code><span> 接口注册HMS信息回调的方式获取到实时的HMS错误信息推送，当HMS错误发生时，用户可以在</span><code>GduTest_HmsInfoCallback</code><span>回调函数中获取到具体的HMS信息。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c++"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"--&gt; Step 2: Register callback function of push HMS information"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">GduTest_WidgetLogAppend</span>(<span class="cm-string">"--&gt; Step 2: Register callback function of push HMS information"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduHms_RegHmsInfoCallback</span>(<span class="cm-variable">GduTest_HmsInfoCallback</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Register callback function of push HMS information failed, error code:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">TaskSleepMs</span>(<span class="cm-number">30000</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><h3 id='4-解析hms信息'><span>4. 解析HMS信息</span></h3><p><span>当用户收到HMS信息的错误码之后，需要通过查表的方式获取，通过错误码以及区分飞机是否在空中，来获取到对应的错误字符串信息，结合对应的错误码可以采取相应的措施，保障飞行器的飞行安全。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">char</span> <span class="cm-variable">alarmIdStr</span>[<span class="cm-number">20</span>] <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">char</span> <span class="cm-variable">sensorIdStr</span>[<span class="cm-number">20</span>] <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">char</span> <span class="cm-variable">componentIdStr</span>[<span class="cm-number">20</span>] <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">char</span> <span class="cm-variable">printBuff</span>[<span class="cm-number">256</span>] <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">originalAlarmInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">uint8_t</span> <span class="cm-variable">hmsCodeMatchFlag</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Hms info table is null"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfoNum</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">hmsCodeMatchFlag</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">j</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">sizeof</span>(<span class="cm-variable">hmsErrCodeInfoTbl</span>) <span class="cm-operator">/</span> <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_GduHmsErrCodeInfo</span>); <span class="cm-variable">j</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorCode</span> <span class="cm-operator">==</span> <span class="cm-variable">hmsErrCodeInfoTbl</span>[<span class="cm-variable">j</span>].<span class="cm-variable">alarmId</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hmsCodeMatchFlag</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">alarmIdStr</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">alarmIdStr</span>), <span class="cm-string">"%u"</span>, <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//note:sensor_idx:[0,5].In order to be consistent with the display of pilot, add one.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">sensorIdStr</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">sensorIdStr</span>), <span class="cm-string">"%d"</span>, <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">componentIndex</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">componentIdStr</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">componentIdStr</span>), <span class="cm-string">"0x%02X"</span>, <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">componentIndex</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">GduTest_GetValueOfFlightStatus</span>() <span class="cm-operator">==</span> <span class="cm-variable">GDU_FC_SUBSCRIPTION_FLIGHT_STATUS_IN_AIR</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">originalAlarmInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">hmsErrCodeInfoTbl</span>[<span class="cm-variable">j</span>].<span class="cm-variable">flyAlarmInfo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">originalAlarmInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">hmsErrCodeInfoTbl</span>[<span class="cm-variable">j</span>].<span class="cm-variable">groundAlarmInfo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">originalAlarmInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">hmsErrCodeInfoTbl</span>[<span class="cm-variable">j</span>].<span class="cm-variable">groundAlarmInfo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">strlen</span>(<span class="cm-variable">originalAlarmInfo</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">printBuff</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">printBuff</span>), <span class="cm-string">"%s"</span>, <span class="cm-variable">originalAlarmInfo</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_ReplaceStr</span>(<span class="cm-variable">printBuff</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">printBuff</span>), <span class="cm-variable">oldReplaceAlarmIdStr</span>, <span class="cm-variable">alarmIdStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_ReplaceStr</span>(<span class="cm-variable">printBuff</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">printBuff</span>), <span class="cm-variable">oldReplaceIndexStr</span>, <span class="cm-variable">sensorIdStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GduTest_ReplaceStr</span>(<span class="cm-variable">printBuff</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">printBuff</span>), <span class="cm-variable">oldReplaceComponentIndexStr</span>, <span class="cm-variable">componentIdStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorLevel</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">MIN_HMS_ERROR_LEVEL</span> <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorLevel</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">MID_HMS_ERROR_LEVEL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"[ErrorCode:0x%2x] %s"</span>, <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorCode</span>, <span class="cm-variable">printBuff</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorLevel</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">MID_HMS_ERROR_LEVEL</span> <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorLevel</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">MAX_HMS_ERROR_LEVEL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"[ErrorCode:0x%2x] %s"</span>, <span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorCode</span>, <span class="cm-variable">printBuff</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">hmsCodeMatchFlag</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"[ErrorCode:0x%2x] There are no matching documents in the current hmsErrCodeInfoTbl for now."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">hmsInfoTable</span>.<span class="cm-variable">hmsInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">errorCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1382px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1382px;"></div></div></div></pre><h3 id='时间同步-2'><span>时间同步</span></h3><h4 id='概述-10'><span>概述</span></h4><p><span>时间同步是一个用于同步负载设备时间和无人机时间的功能，PSDK 通过PPS 信号（周期性的脉冲）同步负载设备和</span><strong><span>具有RTK 功能的无人机</span></strong><span>的时间。具有“时间同步”功能的负载设备，能够方便用户顺利地使用日志排查无人机飞行过程中的各类故障、分析传感器采样的数据以及获取精准的定位信息等功能。</span></p><blockquote><p><strong><span>本文所指</span></strong></p><ul><li><span>无人机时间：无人机系统的时间。</span></li><li><span>本地时间：负载设备上的时间。</span></li></ul></blockquote><h4 id='时间同步-3'><span>时间同步</span></h4><p><span>安装在无人机上的使用PSDK 开发的负载设备在上电后，将初始化时间同步功能模块，消除负载设备和无人机的时钟差，同步负载设备和无人机的时间。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 使用时间同步功能前，请通过移动端App 确认无人机与RTK 卫星间保持良好的通信状态；该移动端App 可为GDU 发布的App，如GDU Flight，也可为基于MSDK 开发的移动端App.</span></p></blockquote><ol start='' ><li><p><span>将负载设备安装在无人机的云台上，在无人机上电后，使用PSDK 开发的负载设备将接收到无人机发送的PPS 硬件脉冲信号；</span></p></li><li><p><span>当负载设备检测到PPS 信号的上升沿时，负载设备需要记录负载设备上的本地时间；</span></p></li><li><p><span>PSDK 的底层处理程序将获取与PPS 信号同步的无人机系统上的时间。</span></p><blockquote><p><strong><span>注意</span></strong></p><ul><li><span>请确保PPS 信号上升沿到达负载至负载记录本地时间之间的延迟低于1ms。</span></li><li><span>请使用硬件中断的形式实现 PPS 信号的响应。</span></li></ul></blockquote></li><li><p><span>PSDK 的底层处理程序将计算负载设备本地的时间与无人机系统时间的时钟差，实现负载设备与无人机系统时间的同步。</span></p></li><li><p><span>负载设备通过</span><code>GduTimeSync_TransferToAircraftTime</code><span>接口将负载设备本地的时间转换为无人机系统上的时间。</span></p></li></ol><h4 id='使用时间同步功能'><span>使用时间同步功能</span></h4><h4 id='1-配置pps-引脚参数'><span>1. 配置PPS 引脚参数</span></h4><p><span>为了使PPS 引脚能够正确接收PPS 信号，需要设置PPS 引脚的各项参数，并开启PPS 硬件引脚的功能，接收PPS 时间同步信号。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_PpsSignalResponseInit</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitTypeDef</span> <span class="cm-variable">GPIO_InitStructure</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/* Enable GPIOD clock */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">__HAL_RCC_GPIOD_CLK_ENABLE</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/* Configure pin as input floating */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">Mode</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_MODE_IT_RISING</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">Pull</span> <span class="cm-operator">=</span> <span class="cm-variable">GPIO_NOPULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GPIO_InitStructure</span>.<span class="cm-variable">Pin</span> <span class="cm-operator">=</span> <span class="cm-variable">PPS_PIN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">HAL_GPIO_Init</span>(<span class="cm-variable">PPS_PORT</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">GPIO_InitStructure</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/* Enable and set EXTI Line Interrupt to the lowest priority */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">HAL_NVIC_SetPriority</span>(<span class="cm-variable">PPS_IRQn</span>, <span class="cm-variable">PPS_IRQ_PRIO_PRE</span>, <span class="cm-variable">PPS_IRQ_PRIO_SUB</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">HAL_NVIC_EnableIRQ</span>(<span class="cm-variable">PPS_IRQn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 438px;"></div><div class="CodeMirror-gutters" style="display: none; height: 438px;"></div></div></div></pre><h4 id='2-时间同步功能模块初始化'><span>2. 时间同步功能模块初始化</span></h4><p><span>使用时间同步功能，需要初始化时间同步模块。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTimeSync_Init</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"time synchronization module init error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h4 id='3-开发并注册获取负载设备上本地时间的函数'><span>3. 开发并注册获取负载设备上本地时间的函数</span></h4><p><span>基于PSDK 开发的负载设备在使用时间同步功能时，需要以硬件中断的方式响应无人机推送的PPS 时间同步信号；当最新的PPS 信号被触发时，基于PSDK 开发的负载设备控制程序，需要获取到负载设备本地的时间。</span></p><ol start='' ><li><span>开发并注册硬件中断处理函数</span>
<span>开发者需要实现硬件中断处理功能，并将处理硬件中断的函数注册到指定的接口中，当负载设备接收到PPS 信号的上升沿时，硬件中断处理函数能够处理PPS 时间同步信号。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">GduTest_PpsIrqHandler</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">psdkStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">uint32_t</span> <span class="cm-variable">timeMs</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/* EXTI line interrupt detected */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">__HAL_GPIO_EXTI_GET_IT</span>(<span class="cm-variable">PPS_PIN</span>) <span class="cm-operator">!=</span> <span class="cm-variable">RESET</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">__HAL_GPIO_EXTI_CLEAR_IT</span>(<span class="cm-variable">PPS_PIN</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">psdkStat</span> <span class="cm-operator">=</span> <span class="cm-variable">Osal_GetTimeMs</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">timeMs</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">psdkStat</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s_ppsNewestTriggerLocalTimeMs</span> <span class="cm-operator">=</span> <span class="cm-variable">timeMs</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><ol start='' ><li><span>获取PPS 信号被触发时负载设备的本地时间</span>
<span>开发者需要实现获取PPS 信号被触发时负载设备上本地时间的功能，并将该功能的函数注册到指定的接口中。当负载设备接收到PPS 信号的上升沿时，基于PSDK 开发的负载设备控制程序能够记录PPS 信号被触发时负载设备上的本地时间。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_GetNewestPpsTriggerLocalTimeUs</span>(<span class="cm-variable-3">uint64_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">localTimeUs</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">localTimeUs</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"input pointer is null."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_ppsNewestTriggerLocalTimeMs</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_WARN</span>(<span class="cm-string">"pps have not been triggered."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_BUSY</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">*</span><span class="cm-variable">localTimeUs</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">uint64_t</span>) (<span class="cm-variable">s_ppsNewestTriggerLocalTimeMs</span> <span class="cm-operator">*</span> <span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 369px;"></div><div class="CodeMirror-gutters" style="display: none; height: 369px;"></div></div></div></pre><ol start='' ><li><span>注册获取PPS 信号被触发时负载设备本地时间的函数</span>
<span>注册获取PPS 信号被触发时负载设备本地时间功能的函数后，需要将该函数注册到负载设备控制程序中，当负载设备接收到PPS 信号的上升沿时，基于PSDK 开发的负载设备控制程序，能够记录PPS 信号被触发时负载设备的本地时间。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// users must register getNewestPpsTriggerTime callback function</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTimeSync_RegGetNewestPpsTriggerTimeCallback</span>(<span class="cm-variable">s_timeSyncHandler</span>.<span class="cm-variable">GetNewestPpsTriggerLocalTimeUs</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"register GetNewestPpsTriggerLocalTimeUsCallback error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><h4 id='4-时间同步'><span>4. 时间同步</span></h4><p><span>使用PSDK 开发的负载设备控制程序通过</span><code>PsdkOsal_GetTimeMs</code><span>获取负载设备上的本地时间并将负载设备上的时间转换为无人机系统的时间。</span></p><ul><li><span>获取负载设备本地的时间</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">GetTimeMs</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">currentTimeMs</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get current time error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li><span>时间转换</span>
<span>将负载设备本地的时间转换为无人机系统上的时间。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTimeSync_TransferToAircraftTime</span>(<span class="cm-variable">currentTimeMs</span> <span class="cm-operator">*</span> <span class="cm-number">1000</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">aircraftTime</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"transfer to aircraft time error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"current aircraft time is %d.%d.%d %d:%d %d %d."</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">year</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">month</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">day</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">hour</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">minute</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">second</span>, <span class="cm-variable">aircraftTime</span>.<span class="cm-variable">microsecond</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><h4 id='适配产品-1'><span>适配产品</span></h4><p><span>S400 RTK（PPS 信号频率：1Hz）</span></p><h3 id='数据传输-2'><span>数据传输</span></h3><h4 id='概述-11'><span>概述</span></h4><p><span>负载设备和无人机使用数据传输模块，在控制命令传输通道上以透传的方式在PSDK和MSDK间传输控制指令</span></p><blockquote><p><strong><span>说明:</span></strong><span> PSDK 的数据传输模块以透传的方式在负载设备、机载计算机和无人机间传输数据，支持用户根据实际的使用需求设计数据传输协议，使基于PSDK 开发的负载设备能够与移动端App 或机载计算机间实现复杂通信。</span></p></blockquote><h4 id='基础概念-7'><span>基础概念</span></h4><h4 id='通道的分类'><span>通道的分类</span></h4><p><span>目前GDU PSDK 的数据传输通道支持命令信号传输通道。命令信号传输通道：可靠性强，专用于传输对可靠性要求较高的信号，如控制指令和状态信息等。</span></p><h4 id='通道的带宽'><span>通道的带宽</span></h4><ul><li><span>通道带宽：数据通道在</span><strong><span>理论状态下</span></strong><span>可传输的数据量</span></li><li><span>实时带宽：数据通道在</span><strong><span>工作状态下理论上</span></strong><span>可传输的数据量</span></li><li><span>实际带宽：数据通道实际传输的数据量</span></li></ul><h4 id='通道带宽限制'><span>通道带宽限制</span></h4><p><span>数据传输通道的带宽限制，是指在单位时间内，通道</span><strong><span>最大</span></strong><span>能够传输的数据量（byte/s）。</span>
<span>受制于接口部件的物理特性和实际的使用环境，命令信号传输通道带宽为</span><strong><span>静态带宽限制</span></strong><span>。</span></p><h4 id='静态带宽限制'><span>静态带宽限制</span></h4><p><span>静态带宽限制是指命令信号传输通道</span><strong><span>固定的</span></strong><span>带宽大小，受制于材料的物理特性和固有的电气特性而</span><strong><span>无法被改变</span></strong><span>，有关数据传输通道静态带宽的详细参数，请参见 表1 静态带宽。</span></p><h4 id='流量控制'><span>流量控制</span></h4><p><span>PSDK 的数据传输模块通过使用流量阈值和缓冲区，限制负载设备向移动端App 或机载计算机发送的数据量，实现流量控制功能，如 图2.流量控制 所示。</span></p><p><span>PSDK 的流量控制过程如下所示：</span></p><ol start='' ><li><span>负载设备通过数据通道向机载计算机或移动端App 传输数据信息；</span></li><li><span>将负载设备发送的数据暂存入缓冲区中；</span></li><li><span>当缓冲区数据超过了</span><strong><span>流量阈值</span></strong><span>时，负载设备发送的数据将被丢弃；</span></li></ol><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>数据传输模块的流量控制周期为 1s，在每个控制周期内，负载设备传输的数据量应小于用户设置的</span><strong><span>流量阈值</span></strong><span>。</span></li><li><span>流量阈值决定当前数据传输通道最大可传输的数据，该阈值由静态带宽限制因素决定。</span></li></ul></blockquote><h4 id='通道状态'><span>通道状态</span></h4><p><span>使用PSDK 开发的负载设备能够获取到通道的繁忙状态：当对应通道的数据被存入缓冲区或被丢弃时，数据传输模块的通道状态为“繁忙”。</span></p><h4 id='使用数据传输功能'><span>使用数据传输功能</span></h4><p><span>使用PSDK 的数据传输功能，需要在创建工程文件并完成PSDK 的初始化后，初始化数据传输模块再实现数据传输功能和监控数据通道状态的功能。</span></p><h5 id='1-数据传输功能模块初始化'><span>1. 数据传输功能模块初始化</span></h5><p><span>使用“数据传输”功能前，需要使用如下代码初始化数据传输功能模块，确保负载设备能够正常传输数据。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLowSpeedDataChannel_Init</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"init data transmission module error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h5 id='2-实现数据发送功能'><span>2. 实现数据发送功能</span></h5><p><span>使用PSDK 开发的负载设备通过命令信号传输通道向移动端App 或机载计算机发送测试数据。</span></p><ul><li><span>向移动端App 发送控制命令</span>
<span>使用PSDK 开发的负载设备在命令信号传输通道上向移动端App 发送</span><strong><span>控制命令</span></strong><span>。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">channelAddress</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CHANNEL_ADDRESS_MASTER_RC_APP</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLowSpeedDataChannel_SendData</span>(<span class="cm-variable">channelAddress</span>, <span class="cm-variable">dataToBeSent</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">dataToBeSent</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"send data to mobile error."</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h5 id='4-实现数据接收功能'><span>4. 实现数据接收功能</span></h5><p><span>构造并注册数据接收函数后，使用PSDK 开发的负载设备能够通过命令信号传输通道接收从移动端设备和机载计算机发送的控制命令。</span></p><h6 id='41-构造回调函数'><span>4.1 构造回调函数</span></h6><p><span>构造回调函数获取并打印从移动端App 和机载计算机上发送的控制命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">ReceiveDataFromMobile</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>, <span class="cm-variable-3">uint16_t</span> <span class="cm-variable">len</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">printData</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printData</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Malloc</span>(<span class="cm-variable">len</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">printData</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc memory for printData fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_MEMORY_ALLOC_FAILED</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">strncpy</span>(<span class="cm-variable">printData</span>, (<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span>) <span class="cm-variable">data</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printData</span>[<span class="cm-variable">len</span>] <span class="cm-operator">=</span> <span class="cm-string">'\0'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"receive data from mobile: %s, len:%d."</span>, <span class="cm-variable">printData</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GduTest_WidgetLogAppend</span>(<span class="cm-string">"receive data: %s, len:%d."</span>, <span class="cm-variable">printData</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Free</span>(<span class="cm-variable">printData</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">ReceiveDataFromOnboardComputer</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>, <span class="cm-variable-3">uint16_t</span> <span class="cm-variable">len</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">printData</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduOsalHandler</span> <span class="cm-operator">*</span><span class="cm-variable">osalHandler</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_GetOsalHandler</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printData</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Malloc</span>(<span class="cm-variable">len</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">printData</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc memory for printData fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_MEMORY_ALLOC_FAILED</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">strncpy</span>(<span class="cm-variable">printData</span>, (<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span>) <span class="cm-variable">data</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printData</span>[<span class="cm-variable">len</span>] <span class="cm-operator">=</span> <span class="cm-string">'\0'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"receive data from onboard computer: %s, len:%d."</span>, <span class="cm-variable">printData</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GduTest_WidgetLogAppend</span>(<span class="cm-string">"receive data: %s, len:%d."</span>, <span class="cm-variable">printData</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Free</span>(<span class="cm-variable">printData</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 944px;"></div><div class="CodeMirror-gutters" style="display: none; height: 944px;"></div></div></div></pre><h6 id='42-注册回调函数'><span>4.2 注册回调函数</span></h6><p><span>通过注册回调函数，负载设备能够接收从移动端App 和机载计算机发送的控制命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">channelAddress</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CHANNEL_ADDRESS_MASTER_RC_APP</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLowSpeedDataChannel_RegRecvDataCallback</span>(<span class="cm-variable">channelAddress</span>, <span class="cm-variable">ReceiveDataFromMobile</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"register receive data from mobile error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">s_aircraftInfoBaseInfo</span>.<span class="cm-variable">mountPosition</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_MOUNT_POSITION_PAYLOAD_PORT_NO1</span> <span class="cm-operator">||</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_aircraftInfoBaseInfo</span>.<span class="cm-variable">mountPosition</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_MOUNT_POSITION_PAYLOAD_PORT_NO2</span> <span class="cm-operator">||</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_aircraftInfoBaseInfo</span>.<span class="cm-variable">mountPosition</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_MOUNT_POSITION_PAYLOAD_PORT_NO3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">channelAddress</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CHANNEL_ADDRESS_EXTENSION_PORT</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLowSpeedDataChannel_RegRecvDataCallback</span>(<span class="cm-variable">channelAddress</span>, <span class="cm-variable">ReceiveDataFromOnboardComputer</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"register receive data from onboard coputer error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">s_aircraftInfoBaseInfo</span>.<span class="cm-variable">mountPosition</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_MOUNT_POSITION_EXTENSION_PORT</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">channelAddress</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_CHANNEL_ADDRESS_PAYLOAD_PORT_NO1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLowSpeedDataChannel_RegRecvDataCallback</span>(<span class="cm-variable">channelAddress</span>, <span class="cm-variable">ReceiveDataFromPayload</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"register receive data from payload NO1 error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_UNKNOWN</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_NONSUPPORT</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 691px;"></div></div></div></pre><h5 id='5-监控数据传输通道的状态'><span>5. 监控数据传输通道的状态</span></h5><p><span>在数据传输线程中获取数据通道的状态并打印到终端。</span></p><ul><li><span>获取命令信号传输通道的状态信息</span>
<span>获取负载设备向移动端App 和机载计算机发送控制命令的命令信号传输通道的状态。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduLowSpeedDataChannel_GetSendDataState</span>(<span class="cm-variable">channelAddress</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">state</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string">"send to onboard computer state: realtimeBandwidthBeforeFlowController: %d, realtimeBandwidthAfterFlowController: %d, busyState: %d."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">state</span>.<span class="cm-variable">realtimeBandwidthBeforeFlowController</span>, <span class="cm-variable">state</span>.<span class="cm-variable">realtimeBandwidthAfterFlowController</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">state</span>.<span class="cm-variable">busyState</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get send to onboard computer channel state error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 253px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><h3 id='视频流传输'><span>视频流传输</span></h3><h4 id='概述-12'><span>概述</span></h4><p><span>使用PSDK 提供的视频流传输控制功能，开发者</span><strong><span>需要先实现</span></strong><span>获取视频流文件码流的功能。</span></p><p><span>对视频流编码，并结合视频的帧率等参数，调用指定的接口发送视频流数据。用户通过使用GDU Flight 以及基于MSDK 开发的移动端App，能够获取相机类负载设备上实时的视频数据。</span></p><blockquote><p><strong><span>相关参考</span></strong></p><ul><li><span>仅基于Linux 开发的相机类负载设备支持视频流传输功能。</span></li></ul></blockquote><h4 id='使用视频流传输功能'><span>使用视频流传输功能</span></h4><h4 id='1-配置网络参数'><span>1. 配置网络参数</span></h4><ul><li><span>以自动的方式设置网络参数</span>
<span>为方便开发者使用</span><strong><span>具有网口的开发平台</span></strong><span>实现更广泛的应用，PSDK 推荐开发者使用</span><code>GduPlatform_RegHalNetworkHandler()</code><span>接口注册设置负载设备网络参数的回调函数，以自动的方式设置网络参数;</span></li></ul><p><span>设置网络参数时，开发者须使用</span><code>GduPlatform_RegHalNetworkHandler()</code><span>接口注册设置负载设备网络参数的回调函数。</span></p><ul><li><span>构造回调函数 构造设置网络参数的回调函数</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42578px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">HalNetWork_Init</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">ipAddr</span>, <span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">netMask</span>, <span class="cm-variable">T_GduNetworkHandle</span> <span class="cm-operator">*</span><span class="cm-variable">halObj</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int32_t</span> <span class="cm-variable">ret</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">cmdStr</span>[<span class="cm-variable">LINUX_CMD_STR_MAX_SIZE</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">ipAddr</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span> <span class="cm-operator">||</span> <span class="cm-variable">netMask</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"hal network config param error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//Attention: need root permission to config ip addr and netmask.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memset</span>(<span class="cm-variable">cmdStr</span>, <span class="cm-number">0</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">cmdStr</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">cmdStr</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">cmdStr</span>), <span class="cm-string">"ifconfig %s up"</span>, <span class="cm-variable">LINUX_NETWORK_DEV</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">system</span>(<span class="cm-variable">cmdStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">ret</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Can't open the network."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"Probably the program not execute with root permission."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"Please use the root permission to execute the program."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">cmdStr</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">cmdStr</span>), <span class="cm-string">"ifconfig %s %s netmask %s"</span>, <span class="cm-variable">LINUX_NETWORK_DEV</span>, <span class="cm-variable">ipAddr</span>, <span class="cm-variable">netMask</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">system</span>(<span class="cm-variable">cmdStr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">ret</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Can't config the ip address of network."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"Probably the program not execute with root permission."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"Please use the root permission to execute the program."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 806px;"></div><div class="CodeMirror-gutters" style="display: none; height: 806px;"></div></div></div></pre><ul><li><span>注册回调函数</span>
<span>注册</span><code>GduPlatform_RegHalNetworkHandler()</code><span>回调函数后，用户使用</span><code>sudo</code><span>命令（管理员权限）执行负载设备的程序，通过获取无人机和负载设备协商后的网络配置信息，实现负载设备网络参数的自动配置。</span></li></ul><blockquote><p><strong><span>说明：</span></strong><span> 具有</span><code>network-manager</code><span> 服务的Linux 系统，需要删除</span><code>network-manager</code><span>服务所有的配置信息，否则无法成功配置网络参数。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlatform_RegHalNetworkHandler</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">networkHandler</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printf</span>(<span class="cm-string">"register hal network handler error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SYSTEM_ERROR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h4 id='2-创建视频流处理线程'><span>2. 创建视频流处理线程</span></h4><ul><li><span>创建视频流处理线程</span>
<span>为避免因其他任务阻塞视频流处理线程，导致视频流传输时出现花屏和绿屏的问题，请在使用PSDK 开发相机类负载设备时，单独创建视频流处理线程。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42383px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">TaskCreate</span>(<span class="cm-string">"user_camera_media_task"</span>, <span class="cm-variable">UserCameraMedia_SendVideoTask</span>, <span class="cm-number">2048</span>, <span class="cm-variable">NULL</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_userSendVideoThread</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"user send video task create error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><ul><li><span>视频流处理线程初始化</span>
<span>使用PSDK 开发的相机类负载设备在创建视频流处理线程后，需要先初始化线程状态并向相机类负载设备申请用于缓存视频流文件的内存空间。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">videoFilePath</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Malloc</span>(<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">videoFilePath</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc memory for video file path fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exit</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">transcodedFilePath</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Malloc</span>(<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">transcodedFilePath</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc memory for transcoded file path fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exit</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">frameInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Malloc</span>(<span class="cm-variable">VIDEO_FRAME_MAX_COUNT</span> <span class="cm-operator">*</span> <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_TestPayloadCameraVideoFrameInfo</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">frameInfo</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc memory for frame info fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">exit</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">memset</span>(<span class="cm-variable">frameInfo</span>, <span class="cm-number">0</span>, <span class="cm-variable">VIDEO_FRAME_MAX_COUNT</span> <span class="cm-operator">*</span> <span class="cm-keyword">sizeof</span>(<span class="cm-variable">T_TestPayloadCameraVideoFrameInfo</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 461px;"></div><div class="CodeMirror-gutters" style="display: none; height: 461px;"></div></div></div></pre><h4 id='3-获取视频流文件信息'><span>3. 获取视频流文件信息</span></h4><p><span>使用PSDK 开发的相机类负载设备在发送视频流文件前，须读取相机类负载设备本地的H.264 文件，获取视频流文件的信息。</span></p><ul><li><span>读取相机类负载设备本地的H.264 文件</span>
<span>用户指定负载设备上</span><strong><span>准确的</span></strong><span>H.264 文件所在的路径后，基于PSDK 开发的相机类负载设备通过系统接口，打开用户指定的视频流文件。</span></li></ul><blockquote><p><strong><span>说明：</span></strong><span> PSDK 的视频流传输功能仅支持传输H.264 格式的视频流文件。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42383px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduUserUtil_GetCurrentFileDirPath</span>(<span class="cm-variable">__FILE__</span>, <span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>, <span class="cm-variable">curFileDirPath</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Get file current path error, stat = 0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">exit</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">snprintf</span>(<span class="cm-variable">tempPath</span>, <span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>, <span class="cm-string">"%smedia_file/PSDK_0005.h264"</span>, <span class="cm-variable">curFileDirPath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">videoFilePath</span> <span class="cm-operator">=</span> <span class="cm-variable">osalHandler</span><span class="cm-operator">-&gt;</span><span class="cm-variable">Malloc</span>(<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">videoFilePath</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc memory for video file path fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">exit</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fpFile</span> <span class="cm-operator">=</span> <span class="cm-variable">fopen</span>(<span class="cm-variable">transcodedFilePath</span>, <span class="cm-string">"rb+"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">fpFile</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"open video file fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 461px;"></div><div class="CodeMirror-gutters" style="display: none; height: 461px;"></div></div></div></pre><ul><li><p><span>获取H.264 文件的信息</span></p><p><span>基于PSDK 开发的相机类负载设备使用ffmpeg 读取指定的H.264 文件的帧率、帧信息和总帧数。 </span></p><ul><li><span>帧率：相机类负载设备在1s 内可发送的帧的数量</span></li><li><span>帧信息：H.264 视频流文件内一帧的起始位置和该帧的长度</span></li></ul></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// video send preprocess</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_VideoFileTranscode</span>(<span class="cm-variable">videoFilePath</span>, <span class="cm-string">"h264"</span>, <span class="cm-variable">transcodedFilePath</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"transcode video file error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetFrameRateOfVideoFile</span>(<span class="cm-variable">transcodedFilePath</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">frameRate</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get frame rate of video error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetFrameInfoOfVideoFile</span>(<span class="cm-variable">transcodedFilePath</span>, <span class="cm-variable">frameInfo</span>, <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">VIDEO_FRAME_MAX_COUNT</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">frameCount</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get frame info of video error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetFrameNumberByTime</span>(<span class="cm-variable">frameInfo</span>, <span class="cm-variable">frameCount</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">frameNumber</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">startTimeMs</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get start frame number error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">fpFile</span> <span class="cm-operator">!=</span> <span class="cm-variable">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">fclose</span>(<span class="cm-variable">fpFile</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 691px;"></div></div></div></pre><h4 id='4-视频流文件解析'><span>4. 视频流文件解析</span></h4><p><span>基于PSDK 开发的相机类负载设备获取视频流文件的信息后，将解析视频流文件的内容，识别视频流文件的帧头。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataBuffer</span> <span class="cm-operator">=</span> <span class="cm-variable">calloc</span>(<span class="cm-variable">frameBufSize</span>, <span class="cm-number">1</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">dataBuffer</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"malloc fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">free</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">fseek</span>(<span class="cm-variable">fpFile</span>, <span class="cm-variable">frameInfo</span>[<span class="cm-variable">frameNumber</span>].<span class="cm-variable">positionInFile</span>, <span class="cm-variable">SEEK_SET</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">ret</span> <span class="cm-operator">!=</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"fseek fail."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">free</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dataLength</span> <span class="cm-operator">=</span> <span class="cm-variable">fread</span>(<span class="cm-variable">dataBuffer</span>, <span class="cm-number">1</span>, <span class="cm-variable">frameInfo</span>[<span class="cm-variable">frameNumber</span>].<span class="cm-variable">size</span>, <span class="cm-variable">fpFile</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">dataLength</span> <span class="cm-operator">!=</span> <span class="cm-variable">frameInfo</span>[<span class="cm-variable">frameNumber</span>].<span class="cm-variable">size</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"read data from video file error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"read data from video file success, len = %d B\r\n"</span>, <span class="cm-variable">dataLength</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 415px;"></div><div class="CodeMirror-gutters" style="display: none; height: 415px;"></div></div></div></pre><h4 id='5-发送视频流文件'><span>5. 发送视频流文件</span></h4><p><span>基于PSDK 开发的相机类负载设备在解析视频流文件并识别视频流文件的帧头后，将以逐帧的方式发送视频流文件。</span></p><blockquote><p><strong><span>注意:</span></strong><span> 基于PSDK 开发的相机类负载设备最长可发送的帧为65K，若帧的长度超过65k，则需拆解该帧发送。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">lengthOfDataHaveBeenSent</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span> (<span class="cm-variable">dataLength</span> <span class="cm-operator">-</span> <span class="cm-variable">lengthOfDataHaveBeenSent</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">lengthOfDataToBeSent</span> <span class="cm-operator">=</span> <span class="cm-variable">USER_UTIL_MIN</span>(<span class="cm-variable">DATA_SEND_FROM_VIDEO_STREAM_MAX_LEN</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dataLength</span> <span class="cm-operator">-</span> <span class="cm-variable">lengthOfDataHaveBeenSent</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_SendVideoStream</span>((<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span>) <span class="cm-variable">dataBuffer</span> <span class="cm-operator">+</span> <span class="cm-variable">lengthOfDataHaveBeenSent</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lengthOfDataToBeSent</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"send video stream error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">lengthOfDataHaveBeenSent</span> <span class="cm-operator">+=</span> <span class="cm-variable">lengthOfDataToBeSent</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p><span>使用GDU Flight 或基于MSDK 开发的移动端App 向相机类负载设备发送视频流传输命令后，移动端App 将能接收并循环播放相机类负载设备中的媒体文件。</span></p><h4 id='6调整帧速率'><span>6.调整帧速率</span></h4><p><span>使用PSDK 开发的相机类负载设备能够更新视频流发送的状态，方便用户调整视频流传输模块传输视频的帧速率。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_GetVideoStreamState</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">videoStreamState</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">==</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"video stream state: realtimeBandwidthLimit: %d, realtimeBandwidthBeforeFlowController: %d, realtimeBandwidthAfterFlowController:%d busyState: %d."</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">videoStreamState</span>.<span class="cm-variable">realtimeBandwidthLimit</span>, <span class="cm-variable">videoStreamState</span>.<span class="cm-variable">realtimeBandwidthBeforeFlowController</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">videoStreamState</span>.<span class="cm-variable">realtimeBandwidthAfterFlowController</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">videoStreamState</span>.<span class="cm-variable">busyState</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get video stream state error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><h3 id='回放下载'><span>回放下载</span></h3><h4 id='实现回放下载功能'><span>实现回放下载功能</span></h4><p><span>请开发者根据选用的</span><strong><span>开发平台</span></strong><span>以及行业应用实际的使用需求，按照</span><code>T_GduCameraMediaDownloadPlaybackHandler</code><span>结构体构造实现</span><strong><span>下载媒体文件原始数据</span></strong><span>、</span><strong><span>创建/销毁缩略图</span></strong><span>、</span><strong><span>创建/下载缩略图</span></strong><span>等回访下载功能的函数，并将函数注册到PSDK 中指定的接口后，用户通过使用GDU Flight 或基于MSDK 开发的移动端App 能够从基于PSDK 开发的相机类负载设备上下载媒体文件或实现视频流回放功能。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现获取媒体文件信息的功能</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileDir</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileDir</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileOriginInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileOriginInfo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileOriginData</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileOriginData</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现获取媒体文件缩略图的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">CreateMediaFileThumbNail</span> <span class="cm-operator">=</span> <span class="cm-variable">CreateMediaFileThumbNail</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileThumbNailInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileThumbNailInfo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileThumbNailData</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileThumbNailData</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">DestroyMediaFileThumbNail</span> <span class="cm-operator">=</span> <span class="cm-variable">DestroyMediaFileThumbNail</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现获取媒体文件截屏图的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">CreateMediaFileScreenNail</span> <span class="cm-operator">=</span> <span class="cm-variable">CreateMediaFileScreenNail</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileScreenNailInfo</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileScreenNailInfo</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaFileScreenNailData</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaFileScreenNailData</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">DestroyMediaFileScreenNail</span> <span class="cm-operator">=</span> <span class="cm-variable">DestroyMediaFileScreenNail</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现删除媒体文件的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">DeleteMediaFile</span> <span class="cm-operator">=</span> <span class="cm-variable">DeleteMediaFile</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现控制媒体文件回放的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">SetMediaPlaybackFile</span> <span class="cm-operator">=</span> <span class="cm-variable">SetMediaPlaybackFile</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">StartMediaPlayback</span> <span class="cm-operator">=</span> <span class="cm-variable">StartMediaPlayback</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">StopMediaPlayback</span> <span class="cm-operator">=</span> <span class="cm-variable">StopMediaPlayback</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">PauseMediaPlayback</span> <span class="cm-operator">=</span> <span class="cm-variable">PauseMediaPlayback</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">SeekMediaPlayback</span> <span class="cm-operator">=</span> <span class="cm-variable">SeekMediaPlayback</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">GetMediaPlaybackStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">GetMediaPlaybackStatus</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 实现下载媒体文件的功能</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">StartDownloadNotification</span> <span class="cm-operator">=</span> <span class="cm-variable">StartDownloadNotification</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">s_psdkCameraMedia</span>.<span class="cm-variable">StopDownloadNotification</span> <span class="cm-operator">=</span> <span class="cm-variable">StopDownloadNotification</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 599px;"></div><div class="CodeMirror-gutters" style="display: none; height: 599px;"></div></div></div></pre><h4 id='使用回放下载功能'><span>使用回放下载功能</span></h4><blockquote><p><strong><span>注意</span></strong></p><ul><li><span>请使用编解码工具</span><a href='https://trac.ffmpeg.org/'><span>FFmpeg 2.8.15</span></a></li></ul></blockquote><blockquote><ul><li><span>操作相机类负载设备中的文件并执行相应的编解码功能。使用</span><code>ffmpeg -v</code><span>可查看当前FFmpeg 的版本信息。</span></li><li><span>仅基于Linux 开发的负载设备支持使用回放下载功能。</span></li></ul></blockquote><h5 id='2-注册回放下载中的功能'><span>2. 注册回放下载中的功能</span></h5><blockquote><p><strong><span>说明：</span></strong><span> 用户可根据实际的使用需要注册视频回放下载功能。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StartMediaPlayback</span>(<span class="cm-variable-3">void</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"start media playback"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_StartPlay</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"start media playback status error, stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">StopMediaPlayback</span>(<span class="cm-variable-3">void</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"stop media playback"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_StopPlay</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"stop media playback error, stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">PauseMediaPlayback</span>(<span class="cm-variable-3">void</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"pause media playback"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_PausePlay</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"pause media playback error, stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SeekMediaPlayback</span>(<span class="cm-variable-3">uint32_t</span> <span class="cm-variable">playbackPosition</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"seek media playback:%d"</span>, <span class="cm-variable">playbackPosition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_SeekPlay</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>, <span class="cm-variable">playbackPosition</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"seek media playback error, stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1267px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1267px;"></div></div></div></pre><h4 id='获取文件列表'><span>获取文件列表</span></h4><h5 id='1-获取媒体文件的路径'><span>1. 获取媒体文件的路径</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaFileDir</code><span>接口获取用户指定的文件的地址，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够获取指定的媒体文件所在的路径。</span></p><blockquote><p><strong><span>说明：</span></strong><span> 媒体文件的默认路径为</span><code>camera_media_emu/media_file</code><span>，用户可根据实际的使用需要，更改媒体文件所在的路径。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaFileDir</span>(<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">dirPath</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">curFileDirPath</span>[<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">tempPath</span>[<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduUserUtil_GetCurrentFileDirPath</span>(<span class="cm-variable">__FILE__</span>, <span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>, <span class="cm-variable">curFileDirPath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Get file current path error, stat = 0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">snprintf</span>(<span class="cm-variable">dirPath</span>, <span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>, <span class="cm-string">"%smedia_file"</span>, <span class="cm-variable">curFileDirPath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 392px;"></div><div class="CodeMirror-gutters" style="display: none; height: 392px;"></div></div></div></pre><h5 id='2-获取媒体文件的列表'><span>2. 获取媒体文件的列表</span></h5><p><span>指定媒体文件所在的路径后，基于MSDK 开发的移动端App 将向相机类负载设备发送获取文件信息的命令。</span></p><ul><li><span>基于PSDK 开发的负载设备通过调用PSDK 中获取媒体文件信息的接口，能够获取负载设备中媒体文件的信息，如文件的名称、路径和大小等。</span></li><li><span>相机类负载设备通过FFmpeg 命令，能够获取媒体文件的长度、帧率和分辨率。</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42383px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_CameraMediaGetFileInfo</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>, <span class="cm-variable">T_GduCameraMediaFileInfo</span> <span class="cm-operator">*</span><span class="cm-variable">fileInfo</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduMediaFileHandle</span> <span class="cm-variable">mediaFileHandle</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_CreateHandle</span>(<span class="cm-variable">filePath</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">mediaFileHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file create handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetMediaFileType</span>(<span class="cm-variable">mediaFileHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get type error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetMediaFileAttr</span>(<span class="cm-variable">mediaFileHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mediaFileAttr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get attr error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetFileSizeOrg</span>(<span class="cm-variable">mediaFileHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">fileSize</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get size error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_DestroyHandle</span>(<span class="cm-variable">mediaFileHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file destroy handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 921px;"></div><div class="CodeMirror-gutters" style="display: none; height: 921px;"></div></div></div></pre><h5 id='3-获取媒体文件的原始数据'><span>3. 获取媒体文件的原始数据</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaFileOriginData</code><span>接口，获取负载设备上的媒体文件的原始数据，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够获取指定的媒体文件所在的路径。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42578px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaFileOriginData</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">offset</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">length</span>, <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">uint16_t</span> <span class="cm-variable">realLen</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduMediaFileHandle</span> <span class="cm-variable">mediaFileHandle</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_CreateHandle</span>(<span class="cm-variable">filePath</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">mediaFileHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file create handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetDataOrg</span>(<span class="cm-variable">mediaFileHandle</span>, <span class="cm-variable">offset</span>, <span class="cm-variable">length</span>, <span class="cm-variable">data</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">realLen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get data error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_DestroyHandle</span>(<span class="cm-variable">mediaFileHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file destroy handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 645px;"></div><div class="CodeMirror-gutters" style="display: none; height: 645px;"></div></div></div></pre><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>获取媒体文件列表的功能只能获取到媒体文件的原始文件和缩略图。</span></li><li><span>实现获取媒体文件列表的功能后，用户能够获得指定文件的截屏图。</span></li><li><span>用户通过下载功能能够得到指定媒体文件的原始文件。</span></li></ul></blockquote><h4 id='创建缩略图'><span>创建缩略图</span></h4><h5 id='1-获取指定对象的路径并创建缩略图'><span>1. 获取指定对象的路径并创建缩略图</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>CreateMediaFileThumbNail</code><span>接口，获取用户指定媒体文件的路径并创建缩略图，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送创建指定媒体文件的缩略图的命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">CreateMediaFileThumbNail</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_CreateHandle</span>(<span class="cm-variable">filePath</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_mediaFileThumbNailHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file create handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_CreateThm</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file create thumb nail error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 415px;"></div><div class="CodeMirror-gutters" style="display: none; height: 415px;"></div></div></div></pre><h5 id='2-获取缩略图的信息'><span>2. 获取缩略图的信息</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaFileThumbNailInfo</code><span>接口，获取指定媒体文件的缩略图信息，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送获取指定媒体文件缩略图信息的命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42578px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaFileThumbNailInfo</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>, <span class="cm-variable">T_GduCameraMediaFileInfo</span> <span class="cm-operator">*</span><span class="cm-variable">fileInfo</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_UTIL_UNUSED</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_mediaFileThumbNailHandle</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file thumb nail handle null error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetMediaFileType</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get type error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetMediaFileAttr</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mediaFileAttr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get attr error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetFileSizeThm</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">fileSize</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get size error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}<span class="cm-number">0</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 806px;"></div><div class="CodeMirror-gutters" style="display: none; height: 806px;"></div></div></div></pre><h5 id='3-获取缩略图'><span>3. 获取缩略图</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaFileThumbNailData</code><span>接口，获取指定媒体文件的缩略图，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送获取指定媒体文件缩略图的命令，并获得指定的缩略图。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42383px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaFileThumbNailData</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">offset</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">length</span>, <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">uint16_t</span> <span class="cm-variable">realLen</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_UTIL_UNUSED</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_mediaFileThumbNailHandle</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file thumb nail handle null error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetDataThm</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>, <span class="cm-variable">offset</span>, <span class="cm-variable">length</span>, <span class="cm-variable">data</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">realLen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get data error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 507px;"></div><div class="CodeMirror-gutters" style="display: none; height: 507px;"></div></div></div></pre><h5 id='4-销毁缩略图'><span>4. 销毁缩略图</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>DestroyMediaFileThumbNail</code><span>接口，销毁负载设备上生成的缩略图，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送删除指定媒体文件缩略图的命令。</span></p><blockquote><p><strong><span>说明：</span></strong><span> GDU Flight 及基于MSDK 开发的移动端App 接收到相机类负载设备上的缩略图后，将缓存在APP 本地。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">DestroyMediaFileThumbNail</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_UTIL_UNUSED</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_mediaFileThumbNailHandle</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file thumb nail handle null error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_DestoryThm</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file destroy thumb nail error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_DestroyHandle</span>(<span class="cm-variable">s_mediaFileThumbNailHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file destroy handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 576px;"></div><div class="CodeMirror-gutters" style="display: none; height: 576px;"></div></div></div></pre><h4 id='创建截屏图'><span>创建截屏图</span></h4><h5 id='1-获取指定对象的路径并创建截屏图'><span>1. 获取指定对象的路径并创建截屏图</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>CreateMediaFileScreenNail</code><span>接口，获取用户指定媒体文件的路径并创建截屏图，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送创建指定媒体文件的截屏图的命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">CreateMediaFileScreenNail</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_CreateHandle</span>(<span class="cm-variable">filePath</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">s_mediaFileScreenNailHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file create handle error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_CreateScr</span>(<span class="cm-variable">s_mediaFileScreenNailHandle</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file create screen nail error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 415px;"></div><div class="CodeMirror-gutters" style="display: none; height: 415px;"></div></div></div></pre><h5 id='2-获取截屏图的信息'><span>2. 获取截屏图的信息</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaFileScreenNailInfo</code><span>接口，获取指定媒体文件的截屏图信息，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送获取指定媒体文件截屏图信息的命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42383px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaFileScreenNailInfo</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>, <span class="cm-variable">T_GduCameraMediaFileInfo</span> <span class="cm-operator">*</span><span class="cm-variable">fileInfo</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_UTIL_UNUSED</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_mediaFileScreenNailHandle</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file screen nail handle null error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetMediaFileType</span>(<span class="cm-variable">s_mediaFileScreenNailHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get type error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetMediaFileAttr</span>(<span class="cm-variable">s_mediaFileScreenNailHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mediaFileAttr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get attr error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetFileSizeScr</span>(<span class="cm-variable">s_mediaFileScreenNailHandle</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">fileInfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">fileSize</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get size error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 806px;"></div><div class="CodeMirror-gutters" style="display: none; height: 806px;"></div></div></div></pre><h5 id='3-获取截屏图'><span>3. 获取截屏图</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaFileScreenNailData</code><span>接口，获取指定媒体文件的截屏图，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送获取指定媒体文件截屏图的命令，并获得指定的截屏图。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42578px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaFileScreenNailData</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">offset</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">length</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">uint16_t</span> <span class="cm-variable">realLen</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_UTIL_UNUSED</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">s_mediaFileScreenNailHandle</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file screen nail handle null error"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_INVALID_PARAMETER</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduMediaFile_GetDataScr</span>(<span class="cm-variable">s_mediaFileScreenNailHandle</span>, <span class="cm-variable">offset</span>, <span class="cm-variable">length</span>, <span class="cm-variable">data</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">realLen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file get size error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 530px;"></div><div class="CodeMirror-gutters" style="display: none; height: 530px;"></div></div></div></pre><p><span>使用GDU Flight 或基于MSDK 开发的移动端App 能够自动拉取相机类负载设备中</span><code>/media_file</code><span>目录下的媒体文件，显示媒体文件的名称和截屏图，点击后即可显示媒体文件的截屏图。</span></p><h4 id='删除媒体文件'><span>删除媒体文件</span></h4><p><span>使用PSDK 开发的相机类负载设备通过</span><code>DeleteMediaFile</code><span>接口，删除负载设备上的媒体文件，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送删除媒体文件的命令。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">DeleteMediaFile</span>(<span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"delete media file:%s"</span>, <span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduFile_Delete</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Media file delete error stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><p><span>在媒体列表界面，选中需要删除的文件，点击删除按钮，可删除相机类负载设备中的媒体文件。</span></p><h4 id='实现媒体文件回放功能'><span>实现媒体文件回放功能</span></h4><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>使用PSDK 开发相机类负载设备控制程序的回放功能前，需要先实现获取负载设备文件列表的功能。</span></li><li><span>使用PSDK 开发相机类负载设备的回放功能时，需要先获取媒体文件的路径，将指定的媒体文件转换为H.264 格式。</span></li></ul></blockquote><h5 id='1-指定媒体文件的路径'><span>1. 指定媒体文件的路径</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>SetMediaPlaybackFile</code><span>接口，获取用户指定的媒体文件的路径，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送媒体文件所在的路径。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">SetMediaPlaybackFile</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">filePath</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"set media playback file:%s"</span>, <span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_StopPlay</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_SetPlayFile</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>, <span class="cm-variable">filePath</span>, <span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_StartPlay</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 507px;"></div><div class="CodeMirror-gutters" style="display: none; height: 507px;"></div></div></div></pre><h5 id='2-格式转换'><span>2. 格式转换</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GduPlayback_VideoFileTranscode</code><span>接口，将用户指定的媒体文件转换为H，264 格式的文件，用户使用GDU Flight 以及基于MSDK 开发的移动端App 能够向负载设备发送转换媒体文件格式的指令，将指定的文件转为H.264 格式，同时获取转换后媒体文件的帧率、帧信息、总帧数等信息。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// video send preprocess</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_VideoFileTranscode</span>(<span class="cm-variable">videoFilePath</span>, <span class="cm-string">"h264"</span>, <span class="cm-variable">transcodedFilePath</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">GDU_FILE_PATH_SIZE_MAX</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"transcode video file error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetFrameRateOfVideoFile</span>(<span class="cm-variable">transcodedFilePath</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">frameRate</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get frame rate of video error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetFrameInfoOfVideoFile</span>(<span class="cm-variable">transcodedFilePath</span>, <span class="cm-variable">frameInfo</span>, <span class="cm-variable">VIDEO_FRAME_MAX_COUNT</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">&amp;</span><span class="cm-variable">frameCount</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get frame info of video error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetFrameNumberByTime</span>(<span class="cm-variable">frameInfo</span>, <span class="cm-variable">frameCount</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">frameNumber</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">startTimeMs</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get start frame number error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 691px;"></div><div class="CodeMirror-gutters" style="display: none; height: 691px;"></div></div></div></pre><h5 id='3-发送媒体文件'><span>3. 发送媒体文件</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GduPayloadCamera_SendVideoStream</code><span>接口，将根据格式转换后的媒体文件的帧率、帧信息、总帧数等信息找到媒体文件的帧头，并按照指定的码率向GDU Flight 或基于MSDK 开发的APP 发送媒体文件，用户使用GDU Flight 以及基于MSDK 开发的移动端App  能够接收到负载设备发送的媒体文件。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lengthOfDataHaveBeenSent</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">dataLength</span> <span class="cm-operator">-</span> <span class="cm-variable">lengthOfDataHaveBeenSent</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lengthOfDataToBeSent</span> <span class="cm-operator">=</span> <span class="cm-variable">USER_UTIL_MIN</span>(<span class="cm-variable">DATA_SEND_FROM_VIDEO_STREAM_MAX_LEN</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">dataLength</span> <span class="cm-operator">-</span> <span class="cm-variable">lengthOfDataHaveBeenSent</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPayloadCamera_SendVideoStream</span>((<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span>) <span class="cm-variable">dataBuffer</span> <span class="cm-operator">+</span> <span class="cm-variable">lengthOfDataHaveBeenSent</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lengthOfDataToBeSent</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"send video stream error: 0x%08llX."</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lengthOfDataHaveBeenSent</span> <span class="cm-operator">+=</span> <span class="cm-variable">lengthOfDataToBeSent</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><h5 id='4-获取媒体文件的传输状态'><span>4. 获取媒体文件的传输状态</span></h5><p><span>使用PSDK 开发的相机类负载设备通过</span><code>GetMediaPlaybackStatus</code><span>接口，能够获取当前媒体文件的传输状态，用户使用GDU Flight 或基于MSDK 开发的移动端App 能够获取到当前传输的媒体文件的状态信息。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GetMediaPlaybackStatus</span>(<span class="cm-variable">T_GduCameraPlaybackStatus</span> <span class="cm-operator">*</span><span class="cm-variable">status</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduReturnCode</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPlayback_GetPlaybackStatus</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">s_playbackInfo</span>, <span class="cm-variable">status</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get playback status error, stat:0x%08llX"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">status</span><span class="cm-operator">-&gt;</span><span class="cm-variable">videoPlayProcess</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">uint8_t</span>) (((<span class="cm-variable-3">float</span>) <span class="cm-variable">s_playbackInfo</span>.<span class="cm-variable">playPosMs</span> <span class="cm-operator">/</span> (<span class="cm-variable-3">float</span>) <span class="cm-variable">s_playbackInfo</span>.<span class="cm-variable">videoLengthMs</span>) <span class="cm-operator">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-number">100</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"get media playback status %d %d %d %d"</span>, <span class="cm-variable">status</span><span class="cm-operator">-&gt;</span><span class="cm-variable">videoPlayProcess</span>, <span class="cm-variable">status</span><span class="cm-operator">-&gt;</span><span class="cm-variable">playPosMs</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">status</span><span class="cm-operator">-&gt;</span><span class="cm-variable">videoLengthMs</span>, <span class="cm-variable">status</span><span class="cm-operator">-&gt;</span><span class="cm-variable">playbackMode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 461px;"></div><div class="CodeMirror-gutters" style="display: none; height: 461px;"></div></div></div></pre><p><span>使用GDU Flight 或基于MSDK 开发的移动端App  在媒体列表界面，点击所需播放的视频文件，即可进入播放界面，通过按钮和进度条控件，播放视频或调整视频播放进度，如 图3.播放视频文件  所示；在媒体列表界面，选中指定的文件，点击下载按钮，即可下载相机类负载设备中的媒体文件。</span></p><h3 id='本地升级-2'><span>本地升级</span></h3><h4 id='概述-13'><span>概述</span></h4><p><span>本地升级是一个用于升级负载设备固件的功能，开发者使用本地升级功能，能够方便用户通过GDU Flight 2 选择本地固件文件更新负载设备的固件。</span></p><h4 id='固件传输协议'><span>固件传输协议</span></h4><p><span>开发在开发本地升级功能时，可调用接口</span><code>GduUpgrade_Init</code><span>指定传输协议并配置传输设置信息。</span></p><h4 id='实现本地升级功能'><span>实现本地升级功能</span></h4><h5 id='1-本地升级模块初始化'><span>1. 本地升级模块初始化</span></h5><p><span>在使用本地升级功能前，请先初始化升级模块，并指定升级固件时所使用的传输协议。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduUpgrade_Init</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">upgradeConfig</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"GduUpgrade_Init error, return code = %d"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h5 id='2-开启本地升级功能'><span>2. 开启本地升级功能</span></h5><p><span>用户在使用本地升级功能前，需是使能本地升级功能，使能本地升级功能后，GDU Assistant 2 将会显示负载设备的升级界面，用户可选择所需的固件文件升级负载设备。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduUpgrade_EnableLocalUpgrade</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"GduUpgrade_EnableLocalUpgrade error, return code = %d"</span>, <span class="cm-variable">returnCode</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h5 id='3-升级流程'><span>3. 升级流程</span></h5><p><span>开发者根据结构体</span><code>T_GduUpgradeHandler</code><span>实现负载设备本地升级的函数，并通过</span><code>GduUpgrade_RegHandler()</code><span>接口注册负载设备本地升级的回调函数；通过函数</span><code>GduUpgrade_PushUpgradeState()</code><span>推送负载设备升级状态。</span></p><h4 id='使用本地升级功能'><span>使用本地升级功能</span></h4><h6 id='linux-平台运行环境调整'><span>Linux 平台运行环境调整</span></h6><p><span>为使用升级功能，需要将程序设置为默认启动，请参考如下步骤：</span></p><ol start='' ><li><p><span>将编译生成的应用程序拷贝到</span><code>/usr/local/bin/</code><span>目录下；</span></p></li><li><p><span>在</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/etc/rc.local</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>中的增加以下配置项：</span></p><ul><li><code>chmod 666 /dev/ttyUSB0</code></li><li><code>chmod 755 /usr/local/bin/gdu_sdk_demo_linux</code></li><li><code>/usr/local/bin/gdu_sdk_demo_linux&amp;</code></li></ul><blockquote><p><strong><span>说明：</span></strong><span> ttyUSB0 为连接负载设备的串口设备，开发者可根据实际的情况修改该名称</span></p></blockquote></li><li><p><span>重启负载设备，通过终端命令</span><code>ps aux | grep gdu_sdk_demo_linux</code><span> 检查程序是否正常运行</span></p></li></ol><h6 id='stm32f4-平台运行环境调整'><span>STM32F4 平台运行环境调整</span></h6><p><span>如需在STM32F4 平台上使用本地升级功能，开发者需先将Bootloader 烧录到开发平台中，再烧录负载设备的固件，如下目录中的</span><code>STM32F4Platform</code><span>可为</span><code>psdk_development_board_1.0</code><span>（使用负载设备开发板）或</span><code>stm32f4_eval</code><span>（使用STM32 开发板）。</span></p><ol start='' ><li><span>将Bootloader 烧录到单片机中,Bootloader工程目录为：</span></li></ol><ul><li><span>samples/sample_c/platform/rtos_freertos/stm32f4_discovery/project/mdk_bootloader</span></li></ul><ol start='' ><li><span>将应用固件烧录到单片机中，应用固件目录为：</span></li></ol><ul><li><span>samples/sample_c/platform/rtos_freertos/stm32f4_discovery/project/mdk</span></li></ul><blockquote><p><strong><span>说明</span></strong></p><ul><li><span>Bootloader 是MCU 上电运行的程序，用于更新应用固件并执行应用固件。</span></li><li><span>应用固件：实现负载设备的软件功能，编译Payload SDK Lib。</span></li></ul></blockquote><h5 id='编译固件'><span>编译固件</span></h5><ol start='' ><li><span>修改固件版本号</span>
<span>在</span><code>T_GduTestUpgradeConfig</code><span>结构定义中修改固件的版本号。</span></li></ol><blockquote><p><strong><span>说明：</span></strong><span> 修改版本号时，版本号不可低于当前版本，即负载设备当前使用的固件版本号为V02.01.00.03 时，请将版本号改为V02.01.00.04，如下示例所示。</span></p></blockquote><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">T_GduTestUpgradeConfig</span> <span class="cm-variable">testUpgradeConfig</span> <span class="cm-operator">=</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">firmwareVersion</span> <span class="cm-operator">=</span> {<span class="cm-number">1</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>},</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">transferType</span> <span class="cm-operator">=</span> <span class="cm-variable">GDU_FIRMWARE_TRANSFER_TYPE_DCFTP</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .<span class="cm-variable">needReplaceProgramBeforeReboot</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  };</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ol start='' ><li><span>编译文件 编译负载设备所需升级的固件文件:</span></li></ol><ul><li><span>STM32：负载设备的固件为STM32F4 工程目录下的</span><code>gdu_sdk_demo_linux.bin</code><span>文件</span></li><li><span>Linux: 负载设备的固件为编译后的</span><code>gdu_sdk_demo_linux</code><span>程序文件</span></li></ul><ol start='' ><li><span>修改固件文件名</span>
<span>重新编译固件文件后，需修改编译后的固件的名称，如</span><code>PSDK_APPALIAS_V02.01.00.04.bin</code><span>。 文件名称格式：</span><code>Product Name_Vaa.bb.cc.dd.bin</code></li></ol><ul><li><span>Product Name：负载产品名（若开发者设置了负载别名，该名称则为负载别名）</span></li><li><span>Vaa.bb.cc.dd：为负载四位版本号</span></li></ul><blockquote><p><strong><span>说明：</span></strong><span> 固件文件名称中的版本号需和代码中定义版本号一致，否则负载设备可能会升级失败。</span></p></blockquote><h5 id='使用gdu-assistant-2-升级固件'><span>使用GDU Assistant 2 升级固件</span></h5><p><span>打开GDU Assistant 2选择编译生成的固件升级文件（PSDK_APPALIAS_V02.01.00.04.bin），进行固件升级。</span></p><h4 id='sample-升级原理介绍'><span>Sample 升级原理介绍</span></h4><h5 id='linux-程序文件升级原理'><span>Linux 程序文件升级原理</span></h5><p><span>利用升级功能可以获取到需要更新的固件文件，将固件文件替换掉原先运行的程序文件，系统重启后完成固件升级。</span></p><blockquote><p><span>相关参考</span></p><ul><li><span>负载设备升级流程：</span><code>module_sample/upgrade/</code></li><li><span>使用本地升级功能：</span><code>platform/linux/manifold2/application/main.c</code></li><li><span>为在Linux 平台上开发的负载设备升级固件：</span><code>platform/linux/common/upgrade_platform_opt</code></li></ul></blockquote><h4 id='stm32f4单片机程序升级原理'><span>STM32F4单片机程序升级原理</span></h4><p><span>使用STM32F4 开发的负载设备从Flash 中直接读取固件文件并运行负载设备程序，因此开发者需先烧录Bootloader 再烧录应用固件.</span></p><h5 id='stm32f4-固件升级流程'><span>STM32F4 固件升级流程</span></h5><ol start='' ><li><p><span>STM32F4 平台上电后，将启动MCU</span></p></li><li><p><span>运行Bootloader 并判断升级状态：</span></p><ul><li><span>若无需升级固件，Bootloader 将跳转至应用固件区，并运行应用固件</span></li><li><span>若需升级负载设备的固件，Bootloader 将在替换固件文件后，跳转至应用固件区，并运行应用固件</span></li></ul></li></ol><blockquote><p><strong><span>相关参考</span></strong></p><ul><li><span>实现Bootloader：</span><code>platform/rtos_freertos/stm32f4_discovery/bootloader</code></li><li><span>Bootloader工程目录：</span><code>platform/rtos_freertos/stm32f4_discovery/project/mdk_bootloader</code></li><li><span>实现升级功能：</span><code>api_sample/upgrade/</code></li><li><span>STM32F4 升级：</span><code>platform/rtos_freertos/stm32f4_discovery/drivers/upgrade_platform_opt_stm32</code></li><li><span>初始化升级功能：</span><code>platform/rtos_freertos/stm32f4_discovery/application/application.c</code></li></ul></blockquote><blockquote><p><strong><span>说明：</span></strong><span> 如上目录中的</span><code>stm32f4_discovery</code><span>可为</span><code>psdk_development_board_1.0</code><span>或</span><code>stm32f4_eval</code><span>。</span></p></blockquote><h5 id='修改flash-地址空间可选）'><span>修改Flash 地址空间（可选）</span></h5><ol start='' ><li><span>修改地址定义： 修改</span><code>platform/rtos_freertos/STM32F4Platform/drivers/BSP/flash_if.h</code><span> 文件中的地址定义</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* End of the Flash address */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define FLASH_END_ADDRESS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x080FFFFF</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* Define the address from where user application will be loaded.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">NOTE the 1st sector 0x08000000-0x08007FFF is reserved for the IAP code */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_ADDRESS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR_FLASH_SECTOR_4</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_ADDRESS_END &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (ADDR_FLASH_SECTOR_8 - 1)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* Define the user application size */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_FLASH_SIZE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (APPLICATION_ADDRESS_END - APPLICATION_ADDRESS + 1)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* Define the address from where user application will be stored in upgrade mode */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_STORE_ADDRESS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ADDR_FLASH_SECTOR_8</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_STORE_ADDRESS_END &nbsp; &nbsp; &nbsp; (FLASH_END_ADDRESS)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* Define the address for param store */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_PARAM_STORE_ADDRESS &nbsp; &nbsp; ADDR_FLASH_SECTOR_2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define APPLICATION_PARAM_STORE_ADDRESS_END (ADDR_FLASH_SECTOR_4 - 1)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 438px;"></div><div class="CodeMirror-gutters" style="display: none; height: 438px;"></div></div></div></pre><p><span>地址分配声明：</span></p><ul><li><span>bootloader：0x08000000～0x08007FFF</span></li><li><span>Parameter Store Area：0x08008000～0x0800FFFF</span></li><li><span>Application Firmware：0x08010000～0x0807FFFF</span></li><li><span>Upgrade Firmware Store Area：0x08080000～0x080FFFFF</span></li></ul><ol start='' ><li><span>配置中断向量 在</span><code>platform/rtos_freertos/STM32F4Platform/drivers/CMSIS/Device/Source/system_stm32f4xx.c</code><span> 文件中，填写应用固件的偏移地址</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*!&lt; Uncomment the following line if you need to relocate your vector Table in</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">Internal SRAM. */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* #define VECT_TAB_SRAM */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#ifdef USE_BOOTLOADER</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//attention : this value is equal ( application address - 0x08000000 )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define VECT_TAB_OFFSET  0x10000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define VECT_TAB_OFFSET  0x00</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><ol start='' ><li><span>修改工程配置信息 修改Bootloader 和应用固件中的工程配置信息，并填写正确的Flash 地址。</span></li></ol><ul><li><span>Bootloader工程目录：</span><code>platform/rtos_freertos/stm32f4_discovery/project/mdk_bootloader</code></li><li><span>应用固件工程目录：</span><code>platform/rtos_freertos/stm32f4_discovery/project/mdk</code></li></ul><h3 id='精准定位'><span>精准定位</span></h3><blockquote><p><strong><span>提示：</span></strong><span> 在运行“精准定位”示例代码前，请使用GDU Flight 或MSDK开发的APP 查看无人机与RTK 卫星间保持良好的通信状态，确保负载设备可获取精准的定位结果.</span></p></blockquote><h4 id='概述-14'><span>概述</span></h4><p><span>为满足使用PSDK 开发的负载设备对厘米级精度的定位需求，GDU 支持开发者使用基准站（如D-RTK 2）和移动站（S400 RTK），借助RTK（Real Time Kinematic，实时动态载波相位差分技术）获取无人机飞行姿态和高精度的定位信息。</span></p><h4 id='基础概念-8'><span>基础概念</span></h4><h5 id='术语解释'><span>术语解释</span></h5><ul><li><span>目标点：实际获取到定位信息的位置，如云台口中心点。</span></li><li><span>兴趣点：由用户任意指定的负载设备上某一器件的位置，如相机图像传感器的中心点，该目标点也可以为兴趣点。</span></li><li><span>任务：多个连续的飞行动作集合称为一个任务，如对某个区域执行一次测绘任务。根据实际使用需要，用户可创建多个任务。</span></li><li><span>定位事件：触发定位请求的事件，如相机曝光时触发定位请求，则&quot;相机曝光&quot;是一个定位事件；多个事件的集合为事件集合，使用PSDK 开发的负载设备可同时请求多个定位事件发生时的位置信息，如相机协同曝光。</span></li></ul><h5 id='获取精准定位'><span>获取精准定位</span></h5><blockquote><p><strong><span>说明：</span></strong><span> 获取精准定位时，需使用时间同步功能将负载设备的本地时间同步为无人机时间。</span></p></blockquote><ol start='' ><li><span>定位事件发生时，负载设备需要会记录本地时间（该时间为负载设备上的时间）；</span></li><li><span>负载设备通过时间转换功能，将负载设备上的时间转换为无人机上的时间；</span></li><li><span>负载设备使用定位事件发生时的无人机时间（无人机系统的时间）请求位置。</span></li></ol><blockquote><p><strong><span>说明:</span></strong><span> 定位事件发生时的无人机时间（无人机系统的时间）应早于最新的PPS 信号上升沿时间，且时间间隔须在1～2s内。</span></p></blockquote><p><span>获取目标点的位置后，根据目标点的位置，使用目标点与无人机RTK 主天线位置的偏移量、无人机的姿态、负载设备的结构等信息，能够计算兴趣点的位置。</span></p><h4 id='使用精准定位功能'><span>使用精准定位功能</span></h4><h5 id='1-定位功能模块初始化'><span>1. 定位功能模块初始化</span></h5><p><span>使用“精准定位”功能前，需要先初始化精准定位功能模块，确保精准定位功能可正常运行。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPositioning_Init</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"positioning module init error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">gduStat</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h5 id='2-请求并打印位置信息'><span>2. 请求并打印位置信息</span></h5><p><span>用户触发精准定位功能后，负载设备将根据定位事件发生时的时间获取精准的定位信息。</span></p><ol start='' ><li><span>获取本地时间</span>
<span>用户触发精准定位功能后，负载设备获取PPS 信号触发时负载设备上的本地时间。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTest_TimeSyncGetNewestPpsTriggerLocalTimeUs</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">ppsNewestTriggerTimeUs</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get newest pps trigger time error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ol start='' ><li><span>时间转换</span>
<span>将指定的定位事件发生时的负载设备上的本地时间转换为无人机系统的时间。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">GDU_TEST_POSITIONING_EVENT_COUNT</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eventInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">eventSetIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">s_eventIndex</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eventInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduTimeSync_TransferToAircraftTime</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ppsNewestTriggerTimeUs</span> <span class="cm-operator">-</span> <span class="cm-number">1000000</span> <span class="cm-operator">-</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">GDU_TEST_TIME_INTERVAL_AMONG_EVENTS_US</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">aircraftTime</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"transfer to aircraft time error: 0x%08llX."</span>, <span class="cm-variable">gduStat</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">eventInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">eventTime</span> <span class="cm-operator">=</span> <span class="cm-variable">aircraftTime</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 322px;"></div><div class="CodeMirror-gutters" style="display: none; height: 322px;"></div></div></div></pre><ol start='' ><li><span>获取精准的定位信息</span>
<span>完成时间同步后，用户即可获取并打印负载设备在某一时刻的精准位置，负载设备详细的位置信息如 图3. 定位详情 所示。</span></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.42578px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gduStat</span> <span class="cm-operator">=</span> <span class="cm-variable">GduPositioning_GetPositionInformationSync</span>(<span class="cm-variable">GDU_TEST_POSITIONING_EVENT_COUNT</span>, <span class="cm-variable">eventInfo</span>, <span class="cm-variable">positionInfo</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">gduStat</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"get position information error."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"request position of target points success."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"detail position information:"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">GDU_TEST_POSITIONING_EVENT_COUNT</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"position solution property: %d."</span>, <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">positionSolutionProperty</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"pitchAttitudeAngle: %d\trollAttitudeAngle: %d\tyawAttitudeAngle: %d"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">uavAttitude</span>.<span class="cm-variable">pitch</span>, <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">uavAttitude</span>.<span class="cm-variable">roll</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">uavAttitude</span>.<span class="cm-variable">yaw</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"northPositionOffset: %d\tearthPositionOffset: %d\tdownPositionOffset: %d"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">offsetBetweenMainAntennaAndTargetPoint</span>.<span class="cm-variable">x</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">offsetBetweenMainAntennaAndTargetPoint</span>.<span class="cm-variable">y</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">offsetBetweenMainAntennaAndTargetPoint</span>.<span class="cm-variable">z</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(<span class="cm-string">"longitude: %.8f\tlatitude: %.8f\theight: %.8f"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointPosition</span>.<span class="cm-variable">longitude</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointPosition</span>.<span class="cm-variable">latitude</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointPosition</span>.<span class="cm-variable">height</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_DEBUG</span>(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"longStandardDeviation: %.8f\tlatStandardDeviation: %.8f\thgtStandardDeviation: %.8f"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointPositionStandardDeviation</span>.<span class="cm-variable">longitude</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointPositionStandardDeviation</span>.<span class="cm-variable">latitude</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">positionInfo</span>[<span class="cm-variable">i</span>].<span class="cm-variable">targetPointPositionStandardDeviation</span>.<span class="cm-variable">height</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s_eventIndex</span><span class="cm-operator">++</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 760px;"></div><div class="CodeMirror-gutters" style="display: none; height: 760px;"></div></div></div></pre><h4 id='适配产品-2'><span>适配产品</span></h4><p><span>S400 RTK</span></p><h3 id='运动规划-2'><span>运动规划</span></h3><h2 id='概述-15'><span>概述</span></h2><p><span>GDU PSDK 为满足用户对控制无人机飞行自动化的需求，提供了运动规划功能；开发者使用运动规划功能，可根据实际的使用需求设计相应的航点任务和热点任务，制定控制无人机自动化飞行的控制逻辑。</span></p><h2 id='航点任务'><span>航点任务</span></h2><p><span>航点规划是一个控制无人机按照指定的航线飞行，实现无人机飞行自动化的控制功能。开发者通过调用GDU PSDK 的接口，能够控制无人机以</span><strong><span>指定的高度</span></strong><span>飞往</span><strong><span>指定位置</span></strong><span>并执行相应动作，根据实际的使用需求，还可控制无人机重复多次执行指定的任务，实现自动化巡航等功能。</span></p><h2 id='使用航点任务---waypoint-30'><span>使用航点任务 - Waypoint 3.0</span></h2><p><span>Waypoint 3.0功能提供了上传航线任务、监控航线状态和控制航线执行动作等功能。</span></p><h4 id='1-航点任务初始化'><span>1. 航点任务初始化</span></h4><p><span>在使用航线任务-Waypoint 3.0功能之前，需要先调用接口</span><code>GduWaypointV3_Init</code><span> 接口进行初始化操作。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduWaypointV3_Init</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Waypoint v3 init failed."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">returnCode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h4 id='2-上传航点任务'><span>2. 上传航点任务</span></h4><p><span>用户可以通过调用</span><code>GduWaypointV3_UploadXmlFile</code><span> 直接传入xml文件数据，执行航线任务。xml文件可以在GDU Flight提前规划好航线导出。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduWaypointV3_UploadXmlFile</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">uint8_t</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>, <span class="cm-variable-3">uint32_t</span> <span class="cm-variable">dataLen</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h4 id='3-控制无人机执行航点任务'><span>3. 控制无人机执行航点任务</span></h4><p><span>当航线上传完成之后，即可调用</span><code>GduWaypointV3_Action</code><span> 执行航线任务，包括开始、停止、暂停和继续执行航线任务。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduWaypointV3_Action</span>(<span class="cm-variable">E_GduWaypointV3Action</span> <span class="cm-variable">action</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h4 id='4-监测航线状态'><span>4. 监测航线状态</span></h4><p><span>在用户开始执行航线任务之前，建议注册航线状态回调接口，在执行航线过程中，可以通过注册的回调函数实时接收航线状态信息，保证飞行安全。</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.51562px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">returnCode</span> <span class="cm-operator">=</span> <span class="cm-variable">GduWaypointV3_RegMissionStateCallback</span>(<span class="cm-variable">GduTest_WaypointV3StateCallback</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">returnCode</span> <span class="cm-operator">!=</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_ERROR</span>(<span class="cm-string">"Register waypoint v3 state callback failed."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">goto</span> <span class="cm-variable">out</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">T_GduReturnCode</span> <span class="cm-def">GduTest_WaypointV3StateCallback</span>(<span class="cm-variable">T_GduWaypointV3MissionState</span> <span class="cm-variable">missionState</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">USER_LOG_INFO</span>(<span class="cm-string">"Waypoint v3 mission state: %d"</span>, <span class="cm-variable">missionState</span>.<span class="cm-variable">state</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">GDU_ERROR_SYSTEM_MODULE_CODE_SUCCESS</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><p>&nbsp;</p></div></div>
</body>
</html>